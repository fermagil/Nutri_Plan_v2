<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:wght@400;700&display=swap" rel="stylesheet">
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
 <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>	
	
	
    <title>Valoración Antropométrica con Resultados</title>
    <style>
        body {
            font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #212529;
            line-height: 1.6;
            font-size: 16px;
            padding-bottom: 80px;
        }

        header {
            background-color: #ffffff;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-bottom: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-sizing: border-box;
        }

        .logo a {
            color: #4CAF50;
            text-decoration: none;
            font-size: 1.75em;
            font-weight: 600;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }

        nav ul li {
            margin-left: 25px;
        }

        nav ul li a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }

        nav ul li a:hover,
        nav ul li a.active {
            background-color: #e9f5e9;
            color: #388e3c;
        }

        nav ul li a.active {
            background-color: #c8e6c9;
            color: #2e7d32;
            font-weight: 600;
        }

        #auth-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        #user-info {
            font-size: 16px;
            color: #333;
        }

        #login-btn,
        #logout-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        main {
            padding: 30px 15px;
            max-width: 900px;
            margin: 20px auto;
            padding-top: 40px;
            padding-bottom: 40px;
            box-sizing: border-box;
        }

        h1,
        h2,
        h3 {
            color: #388E3C;
            margin-bottom: 20px;
            font-weight: 600;
        }

        h1 {
            font-size: 2.2em;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 1.8em;
            border-bottom: 2px solid #a5d6a7;
            padding-bottom: 8px;
        }

        h3 {
            font-size: 1.5em;
            margin-top: 25px;
        }
	     h4 {
            font-size: 1.1em;
            margin-top: 20px;
	    color:#388E3C;
        }
	 h5 {
            font-size: 1em;
            margin-top: 20px;
	    color:#24272b
        }

        section.data-section {
            background-color: #ffffff;
            padding: 25px 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
            border: 1px solid #e0e0e0;
            box-sizing: border-box;
        }

        p {
            color: #495057;
            margin-bottom: 15px;
        }

        ul {
            padding-left: 25px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 10px;
            color: #333;
        }

        a {
            color: #0275d8;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #343a40;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 18px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input:focus,
        select:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        input.optional-input {
            border-left: 3px solid #ffc107;
        }

        input.optional-input:focus {
            border-color: #80bdff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            border-left: 3px solid #ffc107;
        }

        .form-grid,
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px 25px;
        }

        .form-group,
        .result-item {
            margin-bottom: 5px;
        }

        .result-item label {
            font-weight: 600;
            color: #495057;
        }

        .result-item span {
            font-weight: 500;
            color: #212529;
            display: inline-block;
            min-width: 50px;
            margin-left: 5px;
        }

        .result-item .unit {
            font-size: 0.9em;
            color: #6c757d;
            margin-left: 3px;
        }

        .result-item small {
            display: block;
            font-size: 0.8em;
            color: #6c757d;
            margin-top: -2px;
        }

      

        footer {
            background-color: #e9ecef;
            text-align: center;
            padding: 25px 20px;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
            margin-top: 40px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            header {
                padding: 10px 15px;
                flex-direction: column;
                align-items: flex-start;
                position: static;
            }

            .logo a {
                font-size: 1.5em;
                margin-bottom: 10px;
            }

            nav ul {
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            nav ul li {
                margin: 5px 10px 5px 0;
            }

            main {
                padding-top: 20px;
                max-width: 95%;
            }

            .form-grid,
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8em;
            }

            h2 {
                font-size: 1.5em;
            }

            h3 {
                font-size: 1.3em;
            }

            input[type="text"],
            input[type="number"],
            input[type="date"],
            select {
                padding: 10px 12px;
            }
        }
	 

        section.data-section.anthropometric-section {
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        section.data-section.anthropometric-section h2 {
            font-size: 1.6em;
            margin-bottom: 12px;
        }

        section.data-section.anthropometric-section h3 {
            font-size: 1.3em;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        section.data-section.anthropometric-section small {
            margin-bottom: 8px;
            font-size: 0.75em;
        }

        section.data-section.anthropometric-section .form-grid {
            gap: 10px 15px;
        }

        section.data-section.anthropometric-section .form-group {
            margin-bottom: 2px;
        }

        section.data-section.anthropometric-section label {
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        section.data-section.anthropometric-section input[type="number"] {
            padding: 8px 10px;
            margin-bottom: 10px;
            font-size: 0.9em;
            border-radius: 4px;
        }
	 

        @media (max-width: 768px) {
            section.data-section.anthropometric-section {
                padding: 10px 15px;
            }

            section.data-section.anthropometric-section .form-grid {
                gap: 8px 10px;
            }

            section.data-section.anthropometric-section input[type="number"] {
                padding: 6px 8px;
            }
        }

        .login-container {
            max-width: 400px;
            margin: 20px auto;
            padding: 25px 30px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
            border: 1px solid #e0e0e0;
            box-sizing: border-box;
        }

        .login-container input[type="email"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 18px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .login-container input:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .login-container button {
            width: 100%;
            padding: 12px 20px;
            margin-top: 10px;
        }

        .login-container #login-btn {
            background-color: #4285f4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-container #login-btn img {
            height: 20px;
        }

        .login-container .divider {
            text-align: center;
            margin: 20px 0;
            color: #6c757d;
            font-size: 0.9em;
        }

        .dropdown {
            display: none;
            position: absolute;
            top: 60px;
            left: 30px;
            background-color: #ffffff;
            border: 1px solid #ced4da;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
            z-index: 1000;
        }

        .dropdown a {
            display: block;
            padding: 10px 15px;
            color: #343a40;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
        }

        .dropdown a:hover {
            background-color: #e9f5e9;
            color: #388e3c;
        }

        .anthropometric-section {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            background-color: #5cb85c;
            color: white;
            cursor: pointer;
            font-weight: 500;
            border: none;
            transition: background-color 0.3s ease, transform 0.1s ease;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 1em;
        }

        .button {
            min-width: 150px;
        }

        button:hover {
            background-color: #4cae4c;
            transform: translateY(-1px);
        }

        @media (max-width: 600px) {
            .button {
                padding: 10px 16px;
                min-width: 120px;
            }
        }
	#personal-data-section .personal-data-header {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    width: 100%;
	    margin-bottom: 20px;
	}
	#personal-data-section .personal-data-header h2 {
	    margin: 0;
	    padding: 0;
	    font-size: 1.8em; /* Match global h2 */
	    color: #388E3C; /* Match global h2 */
	    font-weight: 600;
	    border-bottom: none; /* Remove default border */
	    position: relative; /* For pseudo-element */
	   
	  width: 500px;
	}
	#personal-data-section .personal-data-header h2::after {
	    content: '';
	    display: block;
	    position: absolute;
	    bottom: -4px; /* Position below h2 */
	    left: 0;
	    width: 85%; /* Extend toward buttons */
	    height: 2px;
	    background-color: #a5d6a7; /* Match global h2 border */
	}
	#personal-data-section .button-container {
	    display: flex;
	    gap: 10px;
	}
	    #personal-data-section .button-container button {
	    font-size: 14px;       /* Tamaño de fuente más pequeño */
	    padding: 8px 10px;     /* Botón más pequeño */
	    height: auto;          /* Ajuste automático de altura */
	}
        #results-section .result-item label {
            color: #367839;
            font-weight: bold;
        }

        #results-section .result-item span {
            font-weight: bold;
        }

        #results-section .result-item small {
            font-style: italic;
            font-size: 0.80em;
            color: #666;
        }

        #results-section .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }

        #results-section {
            padding: 0.8rem;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
            margin: 0.8rem auto;
            max-width: 900px;
            overflow: hidden;
        }

       
	

        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 1.1rem;
            line-height: 1.3;
            letter-spacing: 0.02em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .results-table thead {
            background-color: #3b9c40;
            color: #fff;
        }

        .results-table th {
            padding: 0.4rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .results-table tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }

        .results-table tbody tr:hover {
            background-color: #edf0f2;
            transition: background-color 0.3s ease-in-out;
        }

        .results-table .section-header {
            background-color: #f1f3f5;
            font-weight: 600;
            font-size: 1rem;
            border-top: 1.5px solid #e2e6ea;
            border-bottom: 1.5px solid #e2e6ea;
        }

        .results-table .section-header th {
            padding: 0.9rem;
            color: #121212;
        }

        .results-table th[scope="row"] label {
            color: #388E3C;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .results-table td {
            padding: 0.4rem;
            border-bottom: 1px solid #e2e6ea;
            vertical-align: middle;
        }

        .results-table span {
            font-weight: 600;
            font-size: 0.95rem;
	    color: #1a1919;
        }

        .results-table .unit {
            font-weight: 400;
            color: #666;
            font-size: 0.8rem;
        }

        .results-table small {
            font-style: italic;
            font-weight: 400;
            font-size: 0.8rem;
            color: #666;
            line-height: 1.2;
            opacity: 0.9;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        @media (max-width: 600px) {
            #results-section {
                padding: 0.6rem;
            }
            .results-table {
                font-size: 0.7rem;
            }
            .results-table th, .results-table td {
                padding: 0.3rem;
            }
            .results-table th[scope="row"] label {
                font-size: 0.7rem;
            }
            .results-table span {
                font-size: 0.7rem;
            }
            .results-table .unit {
                font-size: 0.65rem;
            }
            .results-table small {
                font-size: 0.6rem;
            }
            .results-table .section-header {
                font-size: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            #charts-container section div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
            .chart-container canvas {
                max-height: 200px !important;
            }
        }

        .data-section#results-section h2 {
            font-size: 1.6rem;
            font-weight: 600;
            color: #2e7d32;
            //letter-spacing: 0.05em;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f7f2f2 0%, #f5f7f6 100%);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            //text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            margin: 0 0 16px 0;
            transition: transform 0.2s ease, background 0.3s ease;
        }

        .data-section#results-section h2:hover {
            background: linear-gradient(135deg, #f5f7f6 0%, #f7f2f2 100%);
            transform: translateY(-2px);
        }

        .accordion-section .accordion-content {
            display: table-row;
        }

        .accordion-section.collapsed .accordion-content {
            display: none !important;
        }

        .accordion-section .section-header[data-accordion] {
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s ease;
            background-color: #f5f5f5;
        }

        .accordion-section .section-header[data-accordion]:hover {
            background-color: #f0f0f0;
        }

        .accordion-section .accordion-icon {
            position: absolute;
            right: 10px;
            transition: transform 0.3s ease;
        }

        .accordion-section.collapsed .accordion-icon {
            transform: rotate(-90deg);
        }

        .results-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            table-layout: auto;
        }

        .results-table th,
        .results-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .results-table th:nth-child(2),
        .results-table td:nth-child(2) {
            min-width: 150px;
            white-space: nowrap;
        }

        .results-table thead th {
            background: linear-gradient(135deg, #3b9c40 0%, #2e7d32 100%);
            color: #ffffff;
            font-weight: 600;
            font-size: 1.15rem;
            padding: 12px 10px;
            border: 1px solid #2e7d32;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .results-table thead th:hover {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            transform: translateY(-1px);
        }

        .results-table thead th:nth-child(2) {
            min-width: 150px;
        }

        .results-table thead th:first-child {
            border-top-left-radius: 8px;
        }

        .results-table thead th:last-child {
            border-top-right-radius: 8px;
        }

        #result-analisis {
            font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        #result-analisis h2 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        #result-analisis strong {
            color: #2e7d32;
        }

        #result-analisis .affected-value strong {
            color: #d32f2f;
            font-family: -apple-system, Roboto, Helvetica, Arial, sans-serif;
            font-style: italic;
            font-weight: 600;
        }
	#results-section .results-header {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    width: 100%;
	    margin-bottom: 20px;
	}
	#results-section .results-header h2 {
	    margin: 0; /* Override padding and margins */
	    padding: 0;
	    font-size: 1.6rem; /* Match .data-section#results-section h2 */
	    color: #2e7d32;
	    font-weight: 600;
	    background: none; /* Remove gradient background */
	    box-shadow: none;
	    border-radius: 0;
	    border-bottom: 2px solid #a5d6a7;
            padding-bottom: 8px;
	  width: 450px;
	}
	#results-section .button-container {
	    display: flex;
	    gap: 10px;
	}
	    #results-section .button-container button {
	    font-size: 14px;       /* Tamaño de fuente más pequeño */
	    padding: 8px 12px;     /* Botón un poco más pequeño */
	    height: auto;          /* Ajusta la altura automáticamente */
	}
	    
	    /*Explanation Section and Charts */
	    #explanation-section { 
            background-color: #f1f8f1;
            padding: 25px 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            border: 1px solid #c8e6c9;
            box-sizing: border-box;
        }

        #explanation-section p {
            margin: 10px 0;
            color: #343a40;
        }

        #explanation-section ul {
            margin: 10px 0;
            padding-left: 20px;
	    color: #333;
        }

        #explanation-section ul li {
            margin-bottom: 8px;
	    color: #333;
        }

        #explanation-section strong {
            color: #2e7d32;
        }
        #explanation-section canvas {
            max-width: 100%;
            margin: 10px auto;
            display: block;
        }
	#personal-data-section .button-container,
	#explanation-section .button-container {
	  display: flex;
	  gap: 10px;
	  /*  padding: 5px;opcional */
	}
	
	/* Estilo común para todos los botones */
	#personal-data-section .button-container button,
	#explanation-section .button-container button {
	  font-size: 14px;       /* Tamaño de fuente más pequeño */
	  padding: 8px 12px;     /* Botón más pequeño */
	  height: auto;          /* Ajuste automático de altura */
	}

        .chart-container {
            max-width: 6000px;
            width: 100%;
            margin: 20px auto;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            box-sizing: border-box;
            transition: transform 0.2s ease;
        }

        .chart-container:hover {
            transform: translateY(-3px);
        }

        .chart-container canvas {
            width: 100% !important;
            height: 400px !important;
        }

        .chart-container:has(#weight-chart),
        .chart-container:has(#imc-chart),
        .chart-container:has(#icc-chart),
        .chart-container:has(#bodyfat-chart),
        .chart-container:has(#somatotype-chart),
        .chart-container:has(#typology-chart) {
            max-width: 800px;
        }

        #explanation-section {
            max-width: 900px;
            margin: 0 auto;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #c8e6c9;
        }

        .chart-container:has(#somatotype-image) {
	    max-width: 800px;
	    max-height: 500px;
	    position: relative;
	    aspect-ratio: 1 / 1; /* Mantener proporciones cuadradas */
	}
	
	.chart-container img#somatotype-image {
	    display: block;
	    width: 100%;
	    height: auto;
	}
	
	.chart-container canvas#somatotype-point-canvas {
	    position: absolute;
	    top: 0;
	    left: 0;
	    width: 100% !important;
	    height: 100% !important; /* Ajustar altura al contenedor */
	    pointer-events: none;
	}

        #typology-chart-wrapper {
            border: 2px solid white;
            padding: 10px;
            background-color: #f8f9fa;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        #typology-chart {
            width: 100%;
            height: 400px;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            color: #212529;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.85em;
            line-height: 1.4;
            pointer-events: none;
            display: none;
            z-index: 10;
            white-space: nowrap;
            border: 1px solid #ced4da;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .legend-container {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            padding: 10px;
            background-color: #f1f8f1;
            border-radius: 8px;
            border: 1px solid #c8e6c9;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9em;
            color: #343a40;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            margin-right: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
	    #explanation-section .explanation-header {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    width: 100%;
	    margin-bottom: 20px;
	}
	#explanation-section .explanation-header h2 {
	    margin: 0;
	    padding: 0;
	    font-size: 1.8em; /* Match global h2 */
	    color: #388E3C; /* Match global h2 */
	    font-weight: 600;
	    border-bottom: none; /* Remove default border */
	    position: relative; /* For pseudo-element */
	    width: 700px;
	}
	#explanation-section .explanation-header h2::after {
	    content: '';
	    display: block;
	    position: absolute;
	    bottom: -4px; /* Position below h2 */
	    left: 0;
	    width: 90%; /* Extend toward button */
	    height: 2px;
	    background-color: #a5d6a7; /* Match global h2 border */
	}
	#explanation-section .button-container {
	    display: flex;
	    gap: 10px;
	}
	    
        /* Tab Navigation Styles */
        .tabs {
            max-width: 900px;
            margin: 20px auto;
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
            border: 1px solid #e0e0e0;
            box-sizing: border-box;
        }

        .tabs input[name="tab-control"] {
            display: none;
        }

        .tabs ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            flex-direction: row;
            margin-bottom: -15px;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .tabs ul li {
            flex: 1;
            text-align: center;
            padding: 0 10px;
        }

        .tabs ul li label {
            font-family: "Atkinson Hyperlegible", sans-serif;
            font-weight: 600;
            font-size: 1.1em;
            color: #495057;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: block;
            border-radius: 18px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .tabs ul li label:hover,
        .tabs ul li label:focus,
        .tabs ul li label:active {
            color: #388e3c;
            background-color: #e9f5e9;
        }

        .tabs input[name="tab-control"]:checked + ul > li label {
            color: #2e7d32;
            background-color: #c8e6c9;
        }

        .tabs .slider {
            position: relative;
            width: 25%;
            transition: all 0.33s cubic-bezier(0.38, 0.8, 0.32, 1.07);
        }

        .tabs .slider .indicator {
            width: 50px;
            max-width: 100%;
            margin: 0 auto;
            height: 4px;
            background: #4CAF50;
            border-radius: 1px;
        }

        .tabs .content {
            margin-top: 15px;
        }

        .tabs .content section {
            display: none;
            animation: content 0.3s ease-in-out;
        }

        .tabs input[name="tab-control"]:nth-of-type(1):checked ~ .slider {
            transform: translateX(0%);
        }

        .tabs input[name="tab-control"]:nth-of-type(2):checked ~ .slider {
            transform: translateX(100%);
        }

        .tabs input[name="tab-control"]:nth-of-type(3):checked ~ .slider {
            transform: translateX(200%);
        }

        .tabs input[name="tab-control"]:nth-of-type(4):checked ~ .slider {
            transform: translateX(300%);
        }

        .tabs input[name="tab-control"]:nth-of-type(1):checked ~ .content > section:nth-child(1),
        .tabs input[name="tab-control"]:nth-of-type(2):checked ~ .content > section:nth-child(2),
        .tabs input[name="tab-control"]:nth-of-type(3):checked ~ .content > section:nth-child(3),
        .tabs input[name="tab-control"]:nth-of-type(4):checked ~ .content > section:nth-child(4) {
            display: block;
        }

        @keyframes content {
            from {
                opacity: 0;
                transform: translateY(5%);
            }
            to {
                opacity: 1;
                transform: translateY(0%);
            }
        }

        @media (max-width: 768px) {
            .tabs ul li label {
                padding: 8px;
                font-size: 0.9em;
            }

            .tabs .slider {
                display: none;
            }

            .tabs .content {
                margin-top: 10px;
            }
        }
	    .spinner {
	    display: none;
	    border: 4px solid #f3f3f3;
	    border-top: 4px solid #388e3c; /* Color verde */
	    border-radius: 50%;
	    width: 20px;
	    height: 20px;
	    animation: spin 1s linear infinite;
	    margin-right: 10px;
	    vertical-align: middle;
	}
	
	@keyframes spin {
	    0% { transform: rotate(0deg); }
	    100% { transform: rotate(360deg); }
	}
	    
/* Estilos generales del cuerpo */
body {
    text-align: left;
  background-color: #f8f9fa;
  font-family: Roboto, sans-serif;
  color: #eee;
  margin: 0; /* Elimina márgenes automáticos del navegador */
}

.animated-title {
  position: relative;
  display: block;
  text-align: center;
  margin: 10px auto 20px auto;
  font-size: 2em;
  font-family: Roboto, sans-serif;
  font-weight: bold;
  white-space: pre;
  color: transparent;
  letter-spacing: 0px;
  transition: opacity 0.5s ease;
  background-color: #f8f9fa; /* Cubre todo el contenedor (texto + glitch) */
 
  border-radius: 4px; /* Opcional */
	z-index: 1; /* Opcional, si hay superposición con otros elementos */
}

.animated-title.fade-out {
  opacity: 0;
}

.animated-title.fade-in {
  opacity: 1;
  color: #388E3C;
}

.letter {
  display: inline-block;
  position: relative;
  overflow: hidden;
  vertical-align: top;
  font-family: Roboto, sans-serif;
  height: 30px;
  width: 18px; /* Ajustado para mejor alineación */
  min-width: 6px;
  margin-right: -6px; /* Reducido para evitar espacios */
  padding-right: -6px;
  font-size: 30px;
  line-height: 30px;
  
  background-color: transparent;
  color: #388E3C;
}

.letter::before {
  content: attr(data-characters);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  font-size: 30px; /* Asegura consistencia */
  word-break: break-all;
  background-color: transparent;
  color: #388E3C;
  animation-fill-mode: forwards;
  text-align: center; /* Centra los números */
  font-feature-settings: "tnum"; /* Usa números tabulares (mismo ancho) */
  font-variant-numeric: tabular-nums; /* Alternativa para navegadores modernos */
}

/* Animaciones (sin cambios) */
@keyframes letter1 { from { margin-top: 0px; } to { margin-top: 40px; } }
@keyframes letter2 { from { margin-top: 0px; } to { margin-top: 40px; } }
@keyframes letter3 { from { margin-top: -80px; } to { margin-top: 40px; } }
@keyframes letter4 { from { margin-top: -120px; } to { margin-top: 40px; } }
@keyframes letter5 { from { margin-top: -80px; } to { margin-top: 40px; } }
@keyframes letter6 { from { margin-top: -40px; } to { margin-top: 40px; } }
@keyframes letter7 { from { margin-top: -160px; } to { margin-top: 40px; } }
@keyframes letter8 { from { margin-top: -120px; } to { margin-top: 40px; } }
@keyframes letter9 { from { margin-top: -120px; } to { margin-top: 40px; } }
@keyframes letter10 { from { margin-top: -160px; } to { margin-top: 40px; } }
@keyframes letter11 { from { margin-top: -120px; } to { margin-top: 40px; } }
@keyframes letter12 { from { margin-top: -120px; } to { margin-top: 40px; } }
@keyframes letter13 { from { margin-top: -200px; } to { margin-top: 40px; } }
@keyframes letter14 { from { margin-top: -80px; } to { margin-top: 40px; } }
@keyframes letter15 { from { margin-top: -40px; } to { margin-top: 40px; } }
@keyframes letter16 { from { margin-top: -120px; } to { margin-top: 40px; } }

/* Asignamos animaciones a cada "letra" (ahora números) */
.letter:nth-child(1):before {
  content: "98765432100123456789987654321";
  animation-name: letter1;
  animation-duration: 1.5s;
  animation-delay: 0.05s;
  animation-fill-mode: forwards;
}
.letter:nth-child(2):before {
  content: "12345678900987654321123456789";
  animation-name: letter2;
  animation-duration: 1.5s;
  animation-delay: 0.1s;
  animation-fill-mode: forwards;
}
.letter:nth-child(3):before {
  content: "01234567899876543210012345678";
  animation-name: letter3;
  animation-duration: 1.76s;
  animation-delay: 0.15s;
  animation-fill-mode: forwards;
}
.letter:nth-child(4):before {
  content: "98765432101234567890098765432";
  animation-name: letter4;
  animation-duration: 2.784s;
  animation-delay: 0.2s;
  animation-fill-mode: forwards;
}
.letter:nth-child(5):before {
  content: "11223344556677889900112233445";
  animation-name: letter5;
  animation-duration: 1.333s;
  animation-delay: 0.25s;
  animation-fill-mode: forwards;
}
.letter:nth-child(6):before {
  content: "56789012345678901234567890123";
  animation-name: letter6;
  animation-duration: 1.54s;
  animation-delay: 0.3s;
  animation-fill-mode: forwards;
}
.letter:nth-child(7):before {
  content: "98765432109876543210987654321";
  animation-name: letter7;
  animation-duration: 1.68s;
  animation-delay: 0.35s;
  animation-fill-mode: forwards;
}
.letter:nth-child(8):before {
  content: "24680135792468013579246801357";
  animation-name: letter8;
  animation-duration: 0.57s;
  animation-delay: 0.4s;
  animation-fill-mode: forwards;
}
.letter:nth-child(9):before {
  content: "13579246801357924680135792468";
  animation-name: letter9;
  animation-duration: 0.06s;
  animation-delay: 0.45s;
  animation-fill-mode: forwards;
}
.letter:nth-child(10):before {
  content: "00001111222233334444555566667";
  animation-name: letter10;
  animation-duration: 2.845s;
  animation-delay: 0.5s;
  animation-fill-mode: forwards;
}
.letter:nth-child(11):before {
  content: " ";
  animation-name: letter11;
  animation-duration: 0.72s;
  animation-delay: 0.55s;
  animation-fill-mode: forwards;
}
.letter:nth-child(12):before {
  content: "99998888777766665555444433332";
  animation-name: letter12;
  animation-duration: 1.26s;
  animation-delay: 0.6s;
  animation-fill-mode: forwards;
}
.letter:nth-child(13):before {
  content: "10293847561029384756102938475";
  animation-name: letter13;
  animation-duration: 1.366s;
  animation-delay: 0.65s;
  animation-fill-mode: forwards;
}
.letter:nth-child(14):before {
  content: "01010101010101010101010101010";
  animation-name: letter14;
  animation-duration: 2.506s;
  animation-delay: 0.7s;
  animation-fill-mode: forwards;
}
.letter:nth-child(15):before {
  content: "12312312312312312312312312312";
  animation-name: letter15;
  animation-duration: 0.7s;
  animation-delay: 0.75s;
  animation-fill-mode: forwards;
}
.letter:nth-child(16):before {
  content: "45645645645645645645645645645";
  animation-name: letter16;
  animation-duration: 1.76s;
  animation-delay: 0.8s;
  animation-fill-mode: forwards;
}
/* Continuamos con el resto de las "letras" (ahora números) */
.letter:nth-child(17):before {
  content: "78978978978978978978978978978";
  animation-name: letter1;
  animation-duration: 0.85s;
  animation-delay: 0.85s;
  animation-fill-mode: forwards;
}
.letter:nth-child(18):before {
  content: "01230123012301230123012301230";
  animation-name: letter2;
  animation-duration: 0.9s;
  animation-delay: 0.9s;
  animation-fill-mode: forwards;
}
.letter:nth-child(19):before {
  content: "98769876987698769876987698769";
  animation-name: letter3;
  animation-duration: 0.95s;
  animation-delay: 0.95s;
  animation-fill-mode: forwards;
}
.letter:nth-child(20):before {
  content: "54321543215432154321543215432";
  animation-name: letter4;
  animation-duration: 1s;
  animation-delay: 1s;
  animation-fill-mode: forwards;
}
.letter:nth-child(21):before {
  content: "67896789678967896789678967896";
  animation-name: letter5;
  animation-duration: 1.05s;
  animation-delay: 1.05s;
  animation-fill-mode: forwards;
}
.letter:nth-child(22):before {
  content: "32103210321032103210321032103";
  animation-name: letter6;
  animation-duration: 1.1s;
  animation-delay: 1.1s;
  animation-fill-mode: forwards;
}
.letter:nth-child(23):before {
  content: "65436543654365436543654365436";
  animation-name: letter7;
  animation-duration: 1.15s;
  animation-delay: 1.15s;
  animation-fill-mode: forwards;
}
.letter:nth-child(24):before {
  content: "98769876987698769876987698769";
  animation-name: letter8;
  animation-duration: 1.2s;
  animation-delay: 1.2s;
  animation-fill-mode: forwards;
}
.letter:nth-child(25):before {
  content: "00000000000000000000000000000";
  animation-name: letter9;
  animation-duration: 1.25s;
  animation-delay: 1.25s;
  animation-fill-mode: forwards;
}
.letter:nth-child(26):before {
  content: " ";
  animation-name: letter10;
  animation-duration: 1.3s;
  animation-delay: 1.3s;
  animation-fill-mode: forwards;
}
.letter:nth-child(27):before {
  content: "11111111111111111111111111111";
  animation-name: letter11;
  animation-duration: 1.35s;
  animation-delay: 1.35s;
  animation-fill-mode: forwards;
}
.letter:nth-child(28):before {
  content: "22222222222222222222222222222";
  animation-name: letter12;
  animation-duration: 1.4s;
  animation-delay: 1.4s;
  animation-fill-mode: forwards;
}
.letter:nth-child(29):before {
  content: "33333333333333333333333333333";
  animation-name: letter13;
  animation-duration: 1.45s;
  animation-delay: 1.45s;
  animation-fill-mode: forwards;
}
.letter-static {
  display: inline-block;
  font-size: 40px;
  color: #388E3C;
  margin-right: 1px;
}
	    body {
    text-align: left;
  background-color: #f8f9fa;
  font-family: Roboto, sans-serif;
  color: #323233;
	
}
	    h4 {
            font-size: 1em;
            margin-top: 20px;
	    color:#388E3C;
        }
	 h5 {
            font-size: 1em;
            margin-top: 20px;
	    color:#24272b
        }
	#explanation-section ul {
            margin: 10px 0;
            padding-left: 20px;
	    color: #323233;
        }

        #explanation-section ul li {
            margin-bottom: 8px;
	    color: #323233;
        }
/*Estilios para el Container*/
	      /* Modal Styles */
        .modal-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            overflow: auto;
	      
		transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
        }
	



/* Estilos extra para cerrar al hacer clic fuera del contenido */
.modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
        .modal-content {
            background-color: #f8f9fa;
            border-radius: 10px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }

        /* Estilo General del Container */
        .container-wrapper {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: #f8f9fa;
            color: #212529;
            line-height: 1;
            font-size: 14px;
            padding: 5px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 10px 0;
            border: 5px solid #e0e0e0;
	   transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .container-wrapper h1, 
        .container-wrapper h2, 
        .container-wrapper h3, 
        .container-wrapper h4 {
            color: #388E3C;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .container-wrapper h1 {
            font-size: 2em;
            text-align: center;
            margin-bottom: 10px;
        }

        .container-wrapper h2 {
            font-size: 1.4em;
            border-bottom: 2px solid #a5d6a7;
            padding-bottom: 6px;
        }

        /* Formulario de Entrada */
        .container-wrapper .input-form {
            background-color: #ffffff;
            padding: 10px 10px;
            margin: 10px 0;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.07);
            border: 1px solid #e0e0e0;
            box-sizing: border-box;
        }

        .container-wrapper .input-form .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px 10px;
        }

        .container-wrapper .input-form .form-group {
            margin-bottom: 5px;
        }

        .container-wrapper .input-form label {
            display: block;
            margin-bottom: 4px;
            font-weight: 500;
            color: #343a40;
            font-size: 0.90em;
        }

        .container-wrapper .input-form input[type="number"],
        .container-wrapper .input-form select {
            width: 85%;
            padding: 5px 6px;
            margin-bottom: 5px;
            border: 1px solid #ced4da;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 0.8em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .container-wrapper .input-form input[type="number"]#edadInput {
            width: 85%;
        }

        .container-wrapper .input-form input:focus,
        .container-wrapper .input-form select:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .container-wrapper .input-form button,
        .container-wrapper .download-button {
            background-color: #5cb85c;
            color: white;
            cursor: pointer;
            font-weight: 500;
            border: none;
            transition: background-color 0.3s ease, transform 0.1s ease;
            border-radius: 10px;
            padding: 5px 5px;
            font-size: 0.95em;
            margin-top: 5px;
        }

        .container-wrapper .input-form button:hover,
        .container-wrapper .download-button:hover {
            background-color: #4cae4c;
            transform: translateY(-1px);
        }

        .container-wrapper .warning-message {
            color: #dc3545;
            font-size: 0.65em;
            margin-top: -4px;
            margin-bottom: 0px;
            display: none;
        }

        /* Leyenda */
        .container-wrapper .legend-container {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            padding: 10px;
            background-color: #f1f8f1;
            border-radius: 16px;
            border: 1px solid #c8e6c9;
        }

        .container-wrapper .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9em;
            color: #343a40;
        }

        .container-wrapper .legend-color {
            width: 18px;
            height: 18px;
            margin-right: 6px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        /* Contenedor del Gráfico */
        .container-wrapper .chart-container {
            max-width: 700px;
            width: 100%;
            margin: 20px auto;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
            box-sizing: border-box;
            transition: transform 0.2s ease;
            position: relative;
        }

        .container-wrapper .chart-container:hover {
            transform: translateY(-3px);
        }

        .container-wrapper .chart-container canvas#somatotype-canvas {
            width: 100% !important;
            height: 350px !important;
        }

        /* Tooltip */
        .container-wrapper .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            color: #212529;
            padding: 8px 8px;
            border-radius: 8px;
            font-size: 0.85em;
            line-height: 1.4;
            pointer-events: none;
            display: none;
            z-index: 100;
            white-space: nowrap;
            border: 1px solid #ced4da;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Responsividad */
        @media (max-width: 768px) {
            .container-wrapper .input-form .form-grid {
                grid-template-columns: 1fr;
                gap: 5px 5px;
            }

            .container-wrapper .input-form {
                padding: 5px 5px;
            }

            .container-wrapper .chart-container {
                padding: 10px;
            }
        }

        @media (max-width: 480px) {
            .container-wrapper h1 {
                font-size: 1.8em;
            }

            .container-wrapper h2 {
                font-size: 1.5em;
            }

            .container-wrapper h3 {
                font-size: 1.3em;
            }

            .container-wrapper h4 {
                font-size: 1.1em;
            }

            .container-wrapper .input-form input[type="number"],
            .container-wrapper .input-form select {
                padding: 4px 5px;
                font-size: 0.9em;
            }

            .container-wrapper .input-form button,
            .container-wrapper .download-button {
                padding: 4px 7px;
                font-size: 0.9em;
            }
        }
	    .section-header .accordion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.section-header .accordion-toggle {
    flex-grow: 1;
    text-align: left;
}

.section-header .accordion-icon {
    margin-left: 10px;
}

.section-header .button-group {
    display: flex;
    gap: 10px; /* Space between buttons */
}

.section-header .button-group button {
    padding: 5px 10px;
    font-size: 14px;
    background-color: #5cb85c;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.section-header .button-group button:hover {
    background-color: #4cae4c;
}

	    /*Moda Somatotipo Container*/
/* Modal Somatotipo Container */
.modal-soma-container {
    display: none;
    opacity: 0;
    position: fixed; /* Cambiado a 'fixed' para cubrir toda la pantalla */
    top: 0;
    left: 10;
    width: 100%;
    height: 100%;
    /* background-color: rgba(0, 0, 0, 0.5); /* Fondo oscuro semi-transparente opcional */
    transition: opacity 0.3s ease-in-out;
    justify-content: center;
    align-items: center;
    overflow: auto;
    z-index: 1000; /* Asegura que esté por encima de otros elementos */
}

.modal-soma-container .modal-soma-content {
    background-color: white;
    border-radius: 10px;
    width: 95%;
    max-width: 1000px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    position: relative; /* For close button positioning */
    margin: 5px 5px 5px 5px; /* top right bottom left */
    padding: 0; /* Delegate padding to wrapper */
    display: flex;
    flex-direction: column;
}

/* Wrapper for modal content */
.container-soma-wrapper {
    width: 100%;
    max-width: 1200px;
    padding: 0.5rem;
    margin: 0 auto;
    box-sizing: border-box;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Content within wrapper */
.container-soma-content {
    width: 95%;
}

/* Close button */
.modal-soma-container .close-soma-modal {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    color: #333;
    transition: color 0.2s;
    z-index: 10;
}

.modal-soma-container .close-soma-modal:hover {
    color: #ff0000;
}

/* Modal title */
.modal-soma-container h1#modalTitle {  
    font-size: 28px;
    color: #388e3c;
    margin: 10px 0 5px 0;  /* top right bottom left */
    text-align: center;
    width: 100%;
}

/* Form grid */
.container-soma-wrapper .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.6rem;
    margin-bottom: 0.5rem;
}
.container-soma-wrapper .form-grid label {
  font-size: 14px;
  font-weight: 600;
  padding-top: 4px;
}
.container-soma-wrapper .input-form input[type="number"],
.container-soma-wrapper .input-form select {
    width: 80%;
    padding: 0.4rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 0.8rem;
	background: #f9f9f9;	
}

.container-soma-wrapper .input-form input[type="number"]:focus,
.container-soma-wrapper .input-form select:focus {
    border-color: #007bff;
    outline: none;
  
}

.container-soma-wrapper .input-form input.invalid,
.container-soma-wrapper .input-form select.invalid {
    border-color: #ff0000;
    background-color: #fff5f5;
}

.container-soma-wrapper .input-form input[readonly] {
    background: #f9f9f9;
    cursor: not-allowed;
}

/* Somatotipo display */
.container-soma-wrapper .somatotipo-display {
    margin: 0.6rem 0;
    padding: 0.5rem;
    background: #f5f5f5;
    border-radius: 10px;
    grid-column: 1 / -1;
    grid-column: span 4;
}

.container-soma-wrapper .somatotipo-display h3 {
    margin: 0 0 10px 0;
    font-size: 16px;
    color: #388e3c;
}

.container-soma-wrapper .somatotipo-values {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
    gap: 0.5rem;
}

.container-soma-wrapper .somatotipo-values div {
    display: flex;
    flex-direction: column;
}

.container-soma-wrapper .somatotipo-values label {
    font-size: 10px;
    margin-bottom: 5px;
}

.container-soma-wrapper .navigation .somatotipo-values input {
    padding: 4px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background-color: #f9f9f9;
    font-size: 14px;
}
/* Somatotipo display values */
.container-soma-wrapper .somatotipo-values {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Reduced min-width from 150px */
    gap: 0.2rem; /* Reduced from 0.5rem */
}

.container-soma-wrapper .somatotipo-values div {
    display: flex;
    flex-direction: column;
}

.container-soma-wrapper .somatotipo-values label {
    font-size: 12px; /* Reduced from 14px */
    margin-bottom: 3px; /* Reduced from 5px */
}

.container-soma-wrapper .somatotipo-values input {
    padding: 4px; /* Reduced from 4px */
    border: 1px solid #ccc;
    border-radius: 2px;
    background-color: #f9f9f9;
    font-size: 12px; /* Reduced from 14px */
}
/* Chart container */
.container-soma-wrapper .chart-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    min-height: 500px;
    max-height: 500px;
    margin: 1rem auto;
  
    
    border: 1px solid #e0e0e0; /* Borde sutil */
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  overflow: hidden; /* Prevent overflow issues */
}

.container-soma-wrapper .chart-container:has(#somatotype-image) {
    max-width: 800px;
    aspect-ratio: 1 / 1;
}

.container-soma-wrapper .chart-container img#somatotype-image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.container-soma-wrapper .chart-container canvas#somatotype-point-canvas2 {
    position: absolute;
    top: 0;
    left: 0;
    width: 100% !important;
    height: 100% !important;
    pointer-events: auto;
	
}
/* Ensure modal container is visible and sized */
#modalSomaContainer {
    display: none; /* Hidden by default */
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

#modalSomaContainer[style*="display: flex"] {
    opacity: 1;
    width: 100%;
    max-width: 900px; /* Ensure modal has enough space */
    margin: auto;
}

/* Prevent container collapse */
.container-soma-wrapper {
    width: 100%;
    min-height: 500px;
	box-sizing: border-box;
	padding: 1rem;
	background: white; /* Fondo sólido en lugar de semitransparente */
	border-radius: 8px;
}
/* Button container */
.container-soma-wrapper .button-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 1rem;
}

.container-soma-wrapper button {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background-color: #007bff;
    color: white;
    font-size: 14px;
}

.container-soma-wrapper button:hover {
    background-color: #0056b3;
}

.container-soma-wrapper .download-button {
    background-color: #28a745;
}

.container-soma-wrapper .download-button:hover {
    background-color: #218838;
}

.container-soma-wrapper .closesomaModal {
    background-color: #dc3545;
    color: white;
}

.container-soma-wrapper .closesomaModal:hover {
    background-color: #c82333;
}

/* Tooltip */
.container-soma-wrapper .tooltip {
    position: absolute;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    pointer-events: none;
    display: none;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .modal-soma-container .modal-soma-content {
        width: 98%;
        max-height: 95vh;
    }

    .container-soma-wrapper {
        padding: 1rem;
        max-width: 100%;
    }

    .modal-soma-container h1#modalTitle {
        font-size: 24px;
        margin-bottom: 10px;
    }

    .container-soma-wrapper .form-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }

    .container-soma-wrapper .chart-container {
        min-height: 300px;
        max-height: 300px;
    }

    .container-soma-wrapper .chart-container:has(#somatotype-image) {
        max-width: 100%;
        max-height: 250px;
    }

    .container-soma-wrapper .input-form input[type="number"],
    .container-soma-wrapper .input-form select {
        font-size: 14px;
        padding: 0.4rem;
    }

    .container-soma-wrapper .button-container {
        flex-direction: column;
        gap: 0.5rem;
    }

    .container-soma-wrapper button {
        width: 100%;
        padding: 8px;
    }
}
/* Estilos generales del modal container de Anamnesis */
.commit-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: -1;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.commit-modal.active {
  opacity: 1;
  z-index: 9999;
}

/* Contenido del modal */
.modal-content {
  background-color: #fff;
  color: #333;
  padding: 2rem;
  border-radius: 10px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  max-width: 900px;
  width: 90%;
  animation: fadeInUp 0.4s ease forwards;
}

/* Animación suave al aparecer */
@keyframes fadeInUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Encabezado del modal */
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  border-bottom: 1px solid #ddd;
  padding-bottom: 1rem;
}

.modal-title {
  font-size: 1.5rem;
  margin: 0;
  color: #2e7d32; /* Verde oscuro */
}

.modal-close {
  background: none;
  border: none;
  font-size: 1.8rem;
  cursor: pointer;
  color: #777;
  transition: color 0.2s ease;
}

.modal-close:hover {
  color: #2e7d32;
}

/* Cuerpo del modal */
.modal-body {
  margin-bottom: 1.5rem;
}

/* Tabla de datos */
.data-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 1rem;
}

.data-table th {
  background-color: #e8f5e9;
  color: #2e7d32;
  padding: 12px 16px;
  text-align: left;
  font-weight: bold;
  border-bottom: 2px solid #c8e6c9;
}

.data-table td {
  padding: 8px 0;
}

/* Campos de entrada */
.input-field,
select.input-field {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background-color: #fafafa;
  color: #333;
  font-size: 14px;
  transition: border-color 0.3s ease;
}

.input-field:focus,
select.input-field:focus {
  border-color: #4caf50;
  outline: none;
  background-color: #f0fff0;
}

.textarea-field {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background-color: #fafafa;
  color: #333;
  font-size: 14px;
  resize: vertical;
  min-height: 80px;
  transition: border-color 0.3s ease;
}

/* Opciones (radios y checkboxes) */
.options label {
  display: inline-block;
  margin-right: 1rem;
  font-size: 14px;
}

/* Pie de página */
.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.btn {
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.btn-primary {
  background-color: #4caf50;
  color: white;
}

.btn-primary:hover {
  background-color: #388e3c;
  transform: scale(1.03);
}

.btn-secondary {
  background-color: #e0e0e0;
  color: #333;
}

.btn-secondary:hover {
  background-color: #cccccc;
  transform: scale(1.03);
}
	    .notification {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #4caf50;
  color: white;
  padding: 12px 20px;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 10000;
  opacity: 1;
  transform: translateY(0);
  transition: opacity 0.4s ease, transform 0.4s ease;
}

.notification.hidden {
  opacity: 0;
  transform: translateY(20px);
}
</style>
</head>
<body>
<header>
    <div class="logo"><a href="#" id="logo">NutriPlan_v2</a></div>
    <div class="dropdown" id="dropdown">
        <a href="#" onclick="logout()">Cerrar Sesión</a>
    </div>
    <nav id="nav-menu">
        <ul>
            <li><a href="https://fermagil.github.io/Nutri_Plan_v2/Inicio_NutriPlan_v2.html">Inicio</a></li>
            <li><a href="#" class="active">Valoración Antropometrica</a></li>
            <li><a href="https://fermagil.github.io/Nutri_Plan_v2/Nutri_Plan_Advanced_v2.html">Planificación Avanzada</a></li>
            <li><a href="https://fermagil.github.io/Nutri_Plan_v2/Explicacion_Cientifica.html">Guía Usuario</a></li>
        </ul>
    </nav>
</header>
	<div id="progress-container" class="popup-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; justify-content: center; align-items: center;">
		    <div style="background: #ffffff; padding: 20px; border-radius: 8px; max-width: 1200px; width: 95%; max-height: 90%; overflow-y: auto; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);">
		        <h2 style="color: #388E3C; margin-bottom: 20px; text-align: center; font-size: 1.5em;">Progreso del Cliente</h2>
		        <div id="charts-container" style="display: flex; flex-direction: column; gap: 30px;">
		            <!-- Section 1: Evolución del Peso -->
		            <section style="border: 1px solid #dee2e6; border-radius: 5px; padding: 15px;">
		                <h3 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center;">Evolución del Peso</h3>
		                <div class="chart-container" style="padding: 10px;">
		                    <canvas id="peso-evolucion-chart" style="max-height: 250px;"></canvas>
		                </div>
		            </section>
		
		           <!-- Section 2: Evolución de Grasa y Músculo -->
				<section style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; background-color: #fff; margin-bottom: 20px;">
				    <h3 style="font-size: 1.5em; color: #388E3C; margin: 0 0 20px 0; text-align: center; font-weight: 600;">Evolución de Grasa y Músculo</h3>
				    <div class="chart-container" style="padding: 15px; margin-bottom: 20px;">
				        <h4 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center; font-weight: 500;">Grasa</h4>
				        <canvas id="grasa-evolucion-chart" style="max-height: 300px; width: 100%;"></canvas>
				    </div>
				    <div class="chart-container" style="padding: 15px; margin-bottom: 20px;">
				        <h4 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center; font-weight: 500;">Masa Muscular</h4>
				        <canvas id="musculo-evolucion-chart" style="max-height: 300px; width: 100%;"></canvas>
				    </div>
				</section>
		
		           <!-- Section 3: Distribución de Grasa -->
				<section style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; background-color: #fff; margin-bottom: 20px;">
				    <h3 style="font-size: 1.5em; color: #388E3C; margin: 0 0 20px 0; text-align: center; font-weight: 600;">Distribución de Grasa</h3>
				    <div class="chart-container" style="padding: 15px; margin-bottom: 20px;">
				        <h4 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center; font-weight: 500;">Pliegues (mm)</h4>
				        <canvas id="pliegues-chart" style="max-height: 300px; width: 100%;"></canvas>
				    </div>
				    <div class="chart-container" style="padding: 15px; margin-bottom: 20px;">
				        <h4 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center; font-weight: 500;">Circunferencias (cm)</h4>
				        <canvas id="circunferencias-chart" style="max-height: 300px; width: 100%;"></canvas>
				    </div>
				    <div class="chart-container" style="padding: 15px; margin-bottom: 20px;">
				        <h4 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center; font-weight: 500;">IMC e ICC</h4>
				        <canvas id="imc-icc-chart" style="max-height: 300px; width: 100%;"></canvas>
				    </div>
				</section>
		
		            <!-- Section 4: Reserva Proteica Energética -->
		            <section style="border: 1px solid #dee2e6; border-radius: 5px; padding: 15px;">
		                <h3 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center;">Reserva Proteica Energética</h3>
		                <div class="chart-container" style="padding: 10px;">
		                    <canvas id="reserva-proteica-chart" style="max-height: 250px;"></canvas>
		                </div>
		            </section>
		
		            <!-- Section 5: Gasto Energético y Edad Metabólica -->
		            <section style="border: 1px solid #dee2e6; border-radius: 5px; padding: 15px;">
		                <h3 style="font-size: 1.2em; color: #388E3C; margin: 0 0 15px 0; text-align: center;">Gasto Energético y Edad Metabólica</h3>
		                <div class="chart-container" style="padding: 10px;">
		                    <canvas id="gasto-energetico-chart" style="max-height: 250px;"></canvas>
		                </div>
		            </section>
		
		            <!-- Section 6: Datos No Numéricos -->
		            <!-- Section 6: Datos No Numéricos -->
				<section style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; background-color: #fff; margin-bottom: 20px;">
				    <h3 style="font-size: 1.5em; color: #388E3C; margin: 0 0 20px 0; text-align: center; font-weight: 600;">Datos No Numéricos</h3>
				    <div class="chart-container" style="padding: 15px;">
				        <table id="non-numerical-table" style="width: 100%; border-collapse: collapse;">
				            <thead>
				                <tr style="background-color: #e9f5e9; color: #388E3C;">
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">Fecha</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">Somatotipo</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">Tipología Actual</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">Tipología Metabólica</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMG Actual</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMG Actual Fuente</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMG Metabólica</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMG Metabólica Fuente</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMLG Actual</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMLG Actual Fuente</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMLG Metabólica</th>
				                    <th style="padding: 10px; border: 1px solid #dee2e6; font-size: 1em; font-weight: 500;">IMLG Metabólica Fuente</th>
				                </tr>
				            </thead>
				            <tbody id="non-numerical-table-body"></tbody>
				        </table>
				    </div>
				</section>
		        </div>
		        <div style="margin-top: 20px; text-align: center;">
		            <button onclick="document.getElementById('progress-container').style.display = 'none';" style="padding: 10px 20px; background-color: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Cerrar</button>
		            <button id="print-pdf-btn" style="padding: 10px 20px; background-color: #388E3C; color: white; border: none; border-radius: 5px; cursor: pointer;">Imprimir a PDF</button>
		        </div>
		    </div>
		</div>
        
		
		   <div id="bioquimicos-container" class="popup-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; justify-content: center; align-items: center;">
		    <div style="background: #ffffff; padding: 20px; border-radius: 8px; max-width: 600px; width: 30%; max-height: 70%; overflow-y: auto; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);">
		        <h2 style="color: #388E3C; margin-bottom: 20px; text-align: center; font-size: 1.5em;">Parámetros Bioquímicos</h2>
		        <form id="bioquimicos-form">
		            <!-- Nutrición -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Nutrición</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="albumina">Albúmina (g/dL):</label>
		                        <input type="number" id="albumina" name="albumina" step="0.1" min="0" placeholder="Ej: 4.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="prealbumina">Prealbúmina (mg/dL):</label>
		                        <input type="number" id="prealbumina" name="prealbumina" step="0.1" min="0" placeholder="Ej: 20.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="proteina-total">Proteína Total (g/dL):</label>
		                        <input type="number" id="proteina-total" name="proteina-total" step="0.1" min="0" placeholder="Ej: 6.5" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Lípidos -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Lípidos</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="colesterol-total">Colesterol Total (mg/dL):</label>
		                        <input type="number" id="colesterol-total" name="colesterol-total" step="0.1" min="0" placeholder="Ej: 200.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="hdl">HDL (mg/dL):</label>
		                        <input type="number" id="hdl" name="hdl" step="0.1" min="0" placeholder="Ej: 50.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="trigliceridos">Triglicéridos (mg/dL):</label>
		                        <input type="number" id="trigliceridos" name="trigliceridos" step="0.1" min="0" placeholder="Ej: 150.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Glucosa -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Glucosa</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="glucosa-ayunas">Glucosa en ayunas (mg/dL):</label>
		                        <input type="number" id="glucosa-ayunas" name="glucosa-ayunas" step="0.1" min="0" placeholder="Ej: 90.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="hba1c">HbA1c (%):</label>
		                        <input type="number" id="hba1c" name="hba1c" step="0.1" min="0" placeholder="Ej: 5.7" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="insulina">Insulina (µU/mL):</label>
		                        <input type="number" id="insulina" name="insulina" step="0.1" min="0" placeholder="Ej: 10.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Inflamación -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Inflamación</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="pcr-ultrasensible">PCR ultrasensible (mg/L):</label>
		                        <input type="number" id="pcr-ultrasensible" name="pcr-ultrasensible" step="0.1" min="0" placeholder="Ej: 1.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="leptina">Leptina (ng/mL):</label>
		                        <input type="number" id="leptina" name="leptina" step="0.1" min="0" placeholder="Ej: 5.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="adiponectina">Adiponectina (µg/mL):</label>
		                        <input type="number" id="adiponectina" name="adiponectina" step="0.1" min="0" placeholder="Ej: 10.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Hígado -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Hígado</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="alt">ALT (U/L):</label>
		                        <input type="number" id="alt" name="alt" step="0.1" min="0" placeholder="Ej: 30.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="ast">AST (U/L):</label>
		                        <input type="number" id="ast" name="ast" step="0.1" min="0" placeholder="Ej: 25.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="ggt">GGT (U/L):</label>
		                        <input type="number" id="ggt" name="ggt" step="0.1" min="0" placeholder="Ej: 25.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Hormonas -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Hormonas</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="tsh">TSH (µIU/mL):</label>
		                        <input type="number" id="tsh" name="tsh" step="0.1" min="0" placeholder="Ej: 2.5" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="testosterona">Testosterona (H) (ng/dL):</label>
		                        <input type="number" id="testosterona" name="testosterona" step="0.1" min="0" placeholder="Ej: 300.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="cortisol">Cortisol (µg/dL):</label>
		                        <input type="number" id="cortisol" name="cortisol" step="0.1" min="0" placeholder="Ej: 15.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Óseo -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Óseo</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="vitamina-d">Vitamina D (25-OH-D3) (ng/mL):</label>
		                        <input type="number" id="vitamina-d" name="vitamina-d" step="0.1" min="0" placeholder="Ej: 30.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="fosfatasa-alcalina">Fosfatasa Alcalina (U/L):</label>
		                        <input type="number" id="fosfatasa-alcalina" name="fosfatasa-alcalina" step="0.1" min="0" placeholder="Ej: 100.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <!-- Riñón -->
		            <fieldset style="margin-bottom: 15px; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
		                <legend style="font-weight: bold; color: #388E3C;">Riñón</legend>
		                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
		                    <div>
		                        <label for="creatinina">Creatinina (mg/dL):</label>
		                        <input type="number" id="creatinina" name="creatinina" step="0.1" min="0" placeholder="Ej: 1.0" style="width: 100%; padding: 5px;">
		                    </div>
		                    <div>
		                        <label for="bun">BUN (mg/dL):</label>
		                        <input type="number" id="bun" name="bun" step="0.1" min="0" placeholder="Ej: 15.0" style="width: 100%; padding: 5px;">
		                    </div>
		                </div>
		            </fieldset>
		            <div style="text-align: center; margin-top: 20px;">
		                <button type="button" id="save-bioquimicos" style="background: #388E3C; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Guardar</button>
		                <button type="button" id="cancel-bioquimicos" style="background: #ccc; color: #333; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button>
		            </div>
		        </form>
		    </div>
		</div>
    <main>
<h1 class="animated-title" id="title">>
   <span class="letter" data-characters="98765432100123456789987654321">V</span> <span class="letter" data-characters="12345678900987654321123456789">a</span> <span class="letter" data-characters="01234567899876543210012345678">l</span> <span class="letter" data-characters="98765432101234567890098765432">o</span> <span class="letter" data-characters="11223344556677889900112233445">r</span> <span class="letter" data-characters="56789012345678901234567890123">a</span> <span class="letter" data-characters="98765432109876543210987654321">c</span> <span class="letter" data-characters="24680135792468013579246801357">i</span> <span class="letter" data-characters="13579246801357924680135792468">ó</span> <span class="letter" data-characters="00001111222233334444555566667">n</span> <span class="letter" data-characters=" ">&nbsp;</span> <span class="letter" data-characters="99998888777766665555444433332">A</span> <span class="letter" data-characters="10293847561029384756102938475">n</span> <span class="letter" data-characters="01010101010101010101010101010">t</span> <span class="letter" data-characters="12312312312312312312312312312">r</span> <span class="letter" data-characters="45645645645645645645645645645">o</span> <span class="letter" data-characters="78978978978978978978978978978">p</span> <span class="letter" data-characters="01230123012301230123012301230">o</span> <span class="letter" data-characters="98769876987698769876987698769">m</span> <span class="letter" data-characters="54321543215432154321543215432">é</span> <span class="letter" data-characters="67896789678967896789678967896">t</span> <span class="letter" data-characters="32103210321032103210321032103">r</span> <span class="letter" data-characters="65436543654365436543654365436">i</span> <span class="letter" data-characters="98769876987698769876987698769">c</span> <span class="letter" data-characters="00000000000000000000000000000">a</span> <span class="letter" data-characters=" ">&nbsp;</span> <span class="letter" data-characters="11111111111111111111111111111">A</span> <span class="letter" data-characters="22222222222222222222222222222">p</span> <span class="letter" data-characters="33333333333333333333333333333">p</span>
</h1>


        <form id="anthropometry-form">
            <div class="tabs">
                <input type="radio" id="tab1" name="tab-control" checked>
                <input type="radio" id="tab2" name="tab-control">
                <input type="radio" id="tab3" name="tab-control">
                <input type="radio" id="tab4" name="tab-control">
                <ul>
                    <li><label for="tab1">Datos Personales</label></li>
                    <li><label for="tab2">Medidas</label></li>
                    <li><label for="tab3">Resultados</label></li>
                    <li><label for="tab4">Explicación</label></li>
                </ul>
                <div class="slider"><div class="indicator"></div></div>
                <div class="content">
                    <section class="data-section" id="personal-data-section">
			    <div class="personal-data-header">
			        <h2>Datos Personales</h2>
			        <div class="button-container">
			            <button type="button" id="nuevo_cliente" class="button">Nuevo Cliente</button>
			            <button type="button" id="ver-progreso-btn" style="display: none;" class="button">Ver Progreso</button>
			            <button type="button" id="mail-btn" style="display: none;" class="button">E-mail</button>
				    <button type="button" id="btn-abrir-data" class="btn btn-primary">Añadir data</button>
			        </div>
			    </div>
			    
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="buscar_cliente">Buscar Cliente:</label>
                                <input type="text" id="buscar_cliente" placeholder="Escribe el nombre del cliente">
                            </div>
                            <div class="form-group">
                                <label for="seleccionar_fecha">Fecha de Toma:</label>
                                <select id="seleccionar_fecha" name="seleccionar_fecha">
                                    <option value="">Seleccionar fecha...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="nombre">Nombre:</label>
                                <input type="text" id="nombre" name="nombre" placeholder="Nombre completo">
                            </div>
                            <div class="form-group">
                                <label for="e-mail">E-mail:</label>
                                <input type="text" id="e-mail" name="nombre" placeholder="Ingresa Email">
                            </div>
                            <div class="form-group">
                                <label for="fecha">Fecha:</label>
                                <input type="date" id="fecha" name="fecha">
                            </div>
                            <div class="form-group">
                                <label for="genero">Género:</label>
                                <select id="genero" name="genero" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="masculino">Masculino</option>
                                    <option value="femenino">Femenino</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edad">Edad (años):</label>
                                <input type="number" id="edad" name="edad" step="0.5" min="6" placeholder="Años cumplidos" required>
                            </div>
                            <div class="form-group">
                                <label for="peso">Peso Actual (kg):</label>
                                <input type="number" id="peso" name="peso" step="0.1" min="20" placeholder="Ej: 70.5" required>
                            </div>
                            <div class="form-group">
                                <label for="altura">Altura (cm):</label>
                                <input type="number" id="altura" name="altura" step="0.5" min="90" placeholder="Ej: 175.0" required>
                            </div>
                            <div class="form-group">
                                <label for="es_deportista">¿Eres deportista? <small>(3/5 veces/sem)</small></label>
                                <select id="es_deportista" name="es_deportista" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="si">Sí</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="grasa_actual_conocida">% Grasa Actual (Opcional):</label>
                                <input type="number" id="grasa_actual_conocida" name="grasa_actual_conocida" step="0.1" min="6" max="70" placeholder="Si lo conoce, ej: 15.5" class="optional-input">
                            </div>
                            <div class="form-group">
                                <label for="grasa_deseada">% Grasa Deseado (Opcional):</label>
                                <input type="number" id="grasa_deseada" name="grasa_deseada" step="0.1" min="6" max="35" placeholder="Objetivo, ej: 12.0" class="optional-input">
                            </div>
                            <div class="form-group">
                                <label for="grasa_visceral_conocida">% Grasa Visceral (Opcional):</label>
                                <input type="number" id="grasa_visceral_conocida" name="grasa_visceral_conocida" step="0.1" min="6" max="50" placeholder="Si lo conoce, ej: 15.5" class="optional-input">
                            </div>
                            <div class="form-group">
                                <label for="parametros-bioquimicos">Parámetros Bioquímicos (Op.):</label>
                                <input type="text" id="parametros-bioquimicos" name="parametros-bioquimicos" placeholder="Si lo conoce, enter..." class="optional-input">
                            </div>
                            <div class="form-group pliegue-abdominal-group" style="display: none">
                                <label for="pliegue_abdominal">P. Abdominal (Op.):</label>
                                <input type="number" id="pliegue_abdominal" name="pliegue_abdominal" step="0.1" min="1" max="70" placeholder="mm" class="optional-input">
                            </div>
                        </div>
                        
                    </section>
                    <section class="data-section anthropometric-section">
                        <h2>Medidas Antropométricas</h2>
                        <small style="display:block; margin-bottom: 15px; color: #6c757d;">Introduzca las medidas para calcular el % de grasa si no lo proporcionó. Los pliegues son opcionales si proporciona circunferencias.</small>
                        <h3>Pliegues (mm)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="pliegue_tricipital">P. tricipital:</label>
                                <input type="number" id="pliegue_tricipital" name="pliegue_tricipital" step="0.1" min="1" max="70" placeholder="mm">
                            </div>
                            <div class="form-group">
                                <label for="pliegue_subescapular">P. Subescapular:</label>
                                <input type="number" id="pliegue_subescapular" name="pliegue_subescapular" step="0.1" min="1" max="70" placeholder="mm">
                            </div>
                            <div class="form-group">
                                <label for="pliegue_suprailiaco">P. Suprailiaco:</label>
                                <input type="number" id="pliegue_suprailiaco" name="pliegue_suprailiaco" step="0.1" min="1" max="70" placeholder="mm">
                            </div>
                            <div class="form-group">
                                <label for="pliegue_bicipital">P. Bicipital:</label>
                                <input type="number" id="pliegue_bicipital" name="pliegue_bicipital" step="0.1" min="1" max="70" placeholder="mm">
                            </div>
                            <div class="form-group">
                                <label for="pliegue_pantorrilla">P. Pantorrilla:</label>
                                <input type="number" id="pliegue_pantorrilla" name="pliegue_pantorrilla" step="0.1" min="1" max="70" placeholder="mm">
                            </div>
                        </div>
                        <h3>Circunferencias (cm)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="circ_cintura">Cintura:</label>
                                <input type="number" id="circ_cintura" name="circ_cintura" step="0.1" min="20" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="circ_cadera">Cadera:</label>
                                <input type="number" id="circ_cadera" name="circ_cadera" step="0.1" min="20" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="circ_cuello">Cuello:</label>
                                <input type="number" id="circ_cuello" name="circ_cuello" step="0.1" min="15" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="circ_pantorrilla">Pantorrilla:</label>
                                <input type="number" id="circ_pantorrilla" name="circ_pantorrilla" step="0.1" min="10" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="circ_brazo">Brazo (relajado):</label>
                                <input type="number" id="circ_brazo" name="circ_brazo" step="0.1" min="10" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="circ_brazo_contraido">Brazo contraído:</label>
                                <input type="number" id="circ_brazo_contraido" name="circ_brazo_contraido" step="0.1" min="10" placeholder="cm">
                            </div>
                        </div>
                        <h3>Diámetros (cm)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="diam_humero">Húmero:</label>
                                <input type="number" id="diam_humero" name="diam_humero" step="0.1" min="1" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="diam_femur">Fémur:</label>
                                <input type="number" id="diam_femur" name="diam_femur" step="0.1" min="1" placeholder="cm">
                            </div>
                            <div class="form-group">
                                <label for="diam_muneca">Muñeca:</label>
                                <input type="number" id="diam_muneca" name="diam_muneca" step="0.1" min="1" placeholder="cm">
                            </div>
                        </div>
                       
                    </section>
                   <section class="data-section" id="results-section">
		    <div class="results-header">
		        <h2>Resultados</h2>
		        <div class="button-container">
		            <button type="submit" id="calcular_resultados" class="button">Calcular Resultados</button>
		            <button type="button" id="guardar_datos" class="button" style="display: none;">Guardar Datos</button>
		        </div>
		    </div>


                        <div class="table-wrapper">
                            <table class="results-table" aria-describedby="results-table-desc">
                                <caption id="results-table-desc" class="sr-only">Tabla de resultados antropométricos</caption>
				     
                                <thead>
                                    <tr>
                                        <th scope="col">Métrica</th>
                                        <th scope="col">Valor</th>
                                        <th scope="col">Nota</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tbody class="accordion-section">
                                        <tr class="section-header" data-accordion="composicion-corporal">
                                            <th colspan="3">
                                                <span class="accordion-toggle">Composición Corporal</span>
                                                <span class="accordion-icon">▼</span>
                                            </th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>IMC</label></th>
                                            <td><span id="result-imc">---</span> <span class="unit">kg/m²</span></td>
                                            <td><small id="imc-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>ICC</label></th>
                                            <td><span id="result-icc">---</span></td>
                                            <td><small id="icc-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Grasa Deseado</label></th>
                                            <td><span id="result-grasa-pct-deseado">---</span> <span class="unit">%</span></td>
                                            <td><small id="grasa-pct-deseado-source">(No estimado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Grasa Actual</label></th>
                                            <td><span id="result-grasa-pct-actual">---</span> <span class="unit">%</span></td>
                                            <td><small id="grasa-pct-actual-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Grasa Metabólico</label></th>
                                            <td><span id="result-grasa-pct-metabolic">---</span> <span class="unit">%</span></td>
                                            <td><small id="grasa-pct-metabolic-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Grasa Visceral</label></th>
                                            <td><span id="result-grasa-pct-visceral">---</span> <span class="unit">%</span></td>
                                            <td><small id="grasa-pct-visceral-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Grasa Actual (MGa)</label></th>
                                            <td><span id="result-masa-grasa-actual">---</span> <span class="unit">kg</span></td>
                                            <td><small id="masa-grasa-actual-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Grasa Metabólico (MG)</label></th>
                                            <td><span id="result-masa-grasa-metabolic">---</span> <span class="unit">kg</span></td>
                                            <td><small id="masa-grasa-metabolic-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Grasa (Deurenberg)</label></th>
                                            <td><span id="result-grasa-pct-Deurenberg">---</span> <span class="unit">%</span></td>
                                            <td><small id="grasa-pct-Deurenberg-source">(No estimado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Grasa (CUN-BAE)</label></th>
                                            <td><span id="result-grasa-pct-CUN-BAE">---</span> <span class="unit">%</span></td>
                                            <td><small id="grasa-pct-CUN-BAE-source">(No estimado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Grasa Abdominal Total (cm2)</label></th>
                                            <td><span id="result-grasa-abdominal">---</span> <span class="unit">cm2</span></td>
                                            <td><small id="grasa-abdominal-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Espesor Grasa Abdominal(cm)</label></th>
                                            <td><span id="result-abdominal-fat-thickness">---</span> <span class="unit">cm</span></td>
                                            <td><small id="abdominal-fat-thickness-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Agua corporal total (kg y % del peso corporal)</label></th>
                                            <td><span id="result-agua-corporal">---</span> <span class="unit"></span></td>
                                            <td><small id="agua-corporal-source">(No calculado)</small></td>
                                        </tr>
                                    </tbody>
                                    <tbody class="accordion-section">
                                        <tr class="section-header" data-accordion="metricas-metabolicas">
                                            <th colspan="3">
						<div style="display: flex; justify-content: space-between; align-items: center;">
                                                <span class="accordion-toggle">Métricas Metabólicas</span>
                                                <span class="accordion-icon">▼</span>
                                            </th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Edad Metabólica</label></th>
                                            <td><span id="result-edadmetabolica">---</span> <span class="unit">años</span></td>
                                            <td><small id="edadmetabolica-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>TMB</label></th>
                                            <td><span id="result-tmb">---</span> <span class="unit">Kcal</span></td>
                                            <td><small id="tmb-source">(No calculado)</small></td>
                                        </tr>
                                    </tbody>
                                    <tbody class="accordion-section">
                                        <tr class="section-header" data-accordion="masa-libre-grasa">
					    <th colspan="3">
					        <div class="accordion-header">
					            <div style="display: flex; align-items: center;">
					                <span class="accordion-toggle">Masa Libre de Grasa</span>
					                <span class="accordion-icon">▼</span>
					            </div>
					            <div class="button-group">
					                <button id="abrirContainerTipologia">Tipología</button>
					                <button id="abrirContainerSomatotipo">Somatotipo</button>
					            </div>
					        </div>
					    </th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Magra Actual (MLG)</label></th>
                                            <td><span id="result-masa-magra-actual">---</span> <span class="unit">kg</span></td>
                                            <td><small id="masa-magra-actual-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Magra Metabólico (MLG)</label></th>
                                            <td><span id="result-masa-magra-metabolic">---</span> <span class="unit">kg</span></td>
                                            <td><small id="masa-magra-metabolic-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>IMLG Actual</label></th>
                                            <td><span id="result-imlg-actual">---</span> <span class="unit">kg/m²</span></td>
                                            <td><small id="imlg-actual-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>IMLG Metabólico</label></th>
                                            <td><span id="result-imlg-metabolic">---</span> <span class="unit">kg/m²</span></td>
                                            <td><small id="imlg-metabolic-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>IMG Actual</label></th>
                                            <td><span id="result-img-actual">---</span> <span class="unit">kg/m²</span></td>
                                            <td><small id="img-actual-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>IMG Metabólico</label></th>
                                            <td><span id="result-img-metabolic">---</span> <span class="unit">kg/m²</span></td>
                                            <td><small id="img-metabolic-source">(No calculado)</small></td>
                                        </tr>
                                    </tbody>
                                    <tbody class="accordion-section">
				    <tr class="section-header" data-accordion="estructurales">
				        <th colspan="3">
				            
				                <span class="accordion-toggle">Estructurales</span>
				                <span class="accordion-icon">▼</span>
				                
						
				            </div>
				        </th>
				    </tr>
				    <tr class="accordion-content">
				        <th scope="row"><label>Somatotipo</label></th>
				        <td><span id="result-somatotipo">---</span></td>
				        <td><small id="somatotipo-source">(Endo: Meso: Ecto)</small></td>
				    </tr>
				    <tr class="accordion-content">
				        <th scope="row"><label>Tipología Actual</label></th>
				        <td><span id="result-tipologia-actual">---</span></td>
				        <td><small id="tipologia-actual-source">(Relación IMLG/IMG)</small></td>
				    </tr>

                                        <tr class="accordion-content">
                                            <th scope="row"><label>Tipología Metabólico</label></th>
                                            <td><span id="result-tipologia-metabolic">---</span></td>
                                            <td><small id="tipologia-metabolic-source">(Relación IMLG/IMG)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Área Muscular Brazo (AMB)</label></th>
                                            <td><span id="result-amb">---</span> <span class="unit">cm²</span></td>
                                            <td><small id="amb-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Muscular Total (MMT)</label></th>
                                            <td><span id="result-mmt">---</span> <span class="unit">kg</span></td>
                                            <td><small id="mmt-source">(Estimado según AMB)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Masa Muscular</label></th>
                                            <td><span id="result-Pct-mmt">---</span> <span class="unit">%</span></td>
                                            <td><small id="Pct-mmt-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>AMB(c) Corregida</label></th>
                                            <td><span id="result-ambc">---</span> <span class="unit">cm²</span></td>
                                            <td><small id="ambc-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Muscular Total (MMT)</label></th>
                                            <td><span id="result-mmt2">---</span> <span class="unit">kg</span></td>
                                            <td><small id="mmt2-source">(Estimado según AMB(c) Heymsfield, 1982)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>% Masa Muscular</label></th>
                                            <td><span id="result-Pct-mmt2">---</span> <span class="unit">%</span></td>
                                            <td><small id="Pct-mmt2-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Area Grasa Brazo</label></th>
                                            <td><span id="result-agb">---</span> <span class="unit">%</span></td>
                                            <td><small id="agb-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Ósea</label></th>
                                            <td><span id="result-masa-osea">---</span> <span class="unit">kg</span></td>
                                            <td><small id="masa-osea-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Residual</label></th>
                                            <td><span id="result-masa-residual">---</span> <span class="unit">kg</span></td>
                                            <td><small id="masa-residual-source">(No calculado)</small></td>
                                        </tr>
                                    </tbody>
                                    <tbody class="accordion-section">
                                        <tr class="section-header" data-accordion="objetivos">
                                            <th colspan="3">
                                                <span class="accordion-toggle">Objetivos</span>
                                                <span class="accordion-icon">▼</span>
                                            </th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Peso Ideal (% Grasa)</label></th>
                                            <td><span id="result-peso-ideal">---</span> <span class="unit">kg</span></td>
                                            <td><small id="peso-ideal-source">(Según % GC Actual Rango de Edad, Sexo y AF)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Peso Ideal(% Grasa Mtb)</label></th>
                                            <td><span id="result-peso-ideal-metabolic">---</span> <span class="unit">kg</span></td>
                                            <td><small id="pesometabolico-source">(Según % GC Metabolico Edad, Sexo y AF)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Peso a Perder/Ganar</label></th>
                                            <td><span id="result-peso-objetivo">---</span> <span class="unit">kg</span></td>
                                            <td><small id="peso-objetivo-source">Peso Actual - Masa Grasa</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Peso a Perder/Ganar(Mtb)</label></th>
                                            <td><span id="result-peso-objetivo-metabolic">---</span> <span class="unit">kg</span></td>
                                            <td><small id="peso-objetivo-metabolicsource">Peso Actual - Masa Grasa Metabolica</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Muscular a Ganar</label></th>
                                            <td><span id="result-peso-muscular">---</span> <span class="unit">kg</span></td>
                                            <td><small id="peso-muscular-source"></small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Masa Muscular a Ganar(Mtb)</label></th>
                                            <td><span id="result-peso-muscular-matabolic">---</span> <span class="unit">kg</span></td>
                                            <td><small id="peso-muscular-metabolicsource"></small></td>
                                        </tr>
                                    </tbody>
                                    <tbody class="accordion-section">
                                        <tr class="section-header" data-accordion="bioquimicos">
                                            <th colspan="3">
                                                <span class="accordion-toggle">Parámetros Bioquímicos</span>
                                                <span class="accordion-icon">▼</span>
                                            </th>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Nutrición</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Albúmina</label></th>
                                            <td><span id="result-albumina">---</span> <span class="unit">g/dL</span></td>
                                            <td><small id="albumina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Prealbúmina</label></th>
                                            <td><span id="result-prealbumina">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="prealbumina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Proteína Total</label></th>
                                            <td><span id="result-proteina-total">---</span> <span class="unit">g/dL</span></td>
                                            <td><small id="proteina-total-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Lípidos</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Colesterol Total</label></th>
                                            <td><span id="result-colesterol-total">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="colesterol-total-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>HDL (colesterol "bueno")</label></th>
                                            <td><span id="result-hdl">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="hdl-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Triglicéridos</label></th>
                                            <td><span id="result-trigliceridos">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="trigliceridos-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Glucosa</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Glucosa en ayunas</label></th>
                                            <td><span id="result-glucosa-ayunas">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="glucosa-ayunas-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>HbA1c</label></th>
                                            <td><span id="result-hba1c">---</span> <span class="unit">%</span></td>
                                            <td><small id="hba1c-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Insulina</label></th>
                                            <td><span id="result-insulina">---</span> <span class="unit">µU/mL</span></td>
                                            <td><small id="insulina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Inflamación</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>PCR ultrasensible</label></th>
                                            <td><span id="result-pcr-ultrasensible">---</span> <span class="unit">mg/L</span></td>
                                            <td><small id="pcr-ultrasensible-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Leptina</label></th>
                                            <td><span id="result-leptina">---</span> <span class="unit">ng/mL</span></td>
                                            <td><small id="leptina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Adiponectina</label></th>
                                            <td><span id="result-adiponectina">---</span> <span class="unit">µg/mL</span></td>
                                            <td><small id="adiponectina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Hígado</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>ALT</label></th>
                                            <td><span id="result-alt">---</span> <span class="unit">U/L</span></td>
                                            <td><small id="alt-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>GGT</label></th>
                                            <td><span id="result-ggt">---</span> <span class="unit">U/L</span></td>
                                            <td><small id="ggt-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>AST</label></th>
                                            <td><span id="result-ast">---</span> <span class="unit">U/L</span></td>
                                            <td><small id="ast-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Hormonas</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>TSH</label></th>
                                            <td><span id="result-tsh">---</span> <span class="unit">µIU/mL</span></td>
                                            <td><small id="tsh-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Testosterona (H)</label></th>
                                            <td><span id="result-testosterona">---</span> <span class="unit">ng/dL</span></td>
                                            <td><small id="testosterona-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Cortisol</label></th>
                                            <td><span id="result-cortisol">---</span> <span class="unit">ng/dL</span></td>
                                            <td><small id="cortisol-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Óseo</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Vitamina D (25-OH-D3)</label></th>
                                            <td><span id="result-vitamina-d">---</span> <span class="unit">ng/mL</span></td>
                                            <td><small id="vitamina-d-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Fosfatasa Alcalina</label></th>
                                            <td><span id="result-fosfatasa-alcalina">---</span> <span class="unit">ng/mL</span></td>
                                            <td><small id="fosfatasa-alcalina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Renal</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>Creatinina</label></th>
                                            <td><span id="result-creatinina">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="creatinina-source">(No calculado)</small></td>
                                        </tr>
                                        <tr class="accordion-content">
                                            <th scope="row"><label>BUN</label></th>
                                            <td><span id="result-bun">---</span> <span class="unit">mg/dL</span></td>
                                            <td><small id="bun-source">(No calculado)</small></td>
                                        </tr>
                                    </tbody>
                                    <tbody class="accordion-section">
                                        <tr class="section-header" data-accordion="analisis">
                                            <th colspan="3">
                                                <span class="accordion-toggle">Análisis Bioquímico</span>
                                                <span class="accordion-icon">▼</span>
                                            </th>
                                        </tr>
                                        <tr class="section-header accordion-content">
                                            <th colspan="3">Interpretación de Resultados Parámetros Bioquímicos</th>
                                        </tr>
                                        <tr class="accordion-content">
                                            <td colspan="3">
                                                <p id="result-analisis">Aquí se proporcionará una explicación detallada de los resultados obtenidos en los parámetros bioquímicos.</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </tbody>
                            </table>
                        </div>
                    </section>
                    <section class="data-section" id="explanation-section" style="display: none;">
		    <div class="explanation-header">
		        <h2>Explicación de los Resultados</h2>
		        <div class="button-container">
		            <!-- Botón Informe -->
		            <button type="button" id="exportar-btn" class="button">Informe</button>
		            
		            <!-- Spinner (dentro del mismo contenedor para alinearlo con el botón) -->
		            <div id="pdf-spinner" class="spinner"></div>
		        </div>
		    </div>
		    
		    <!-- Contenido dinámico para la explicación -->
		    <div id="explanation-content"></div>
		</section>
			<!-- Placeholder for fetched content -->
			<div id="containerTipologiaPlaceholder"></div>
		    <div id="containerSomatotipoPlaceholder"></div>
			
			<!-- Modal container (initially hidden) -->
			<!-- Modal container (initially hidden) -->
			  <!-- Modal Container -->
			    <div id="modalContainer" class="modal-container">
			        <div class="modal-content">
			            <span id="closeModal" class="close-modal">&times;</span>
			            <div class="container-wrapper">
			                <div class="container-content">
			                    <h1>Relación IMLG vs IMG - Mapa de Composición Corporal</h1>
			                    <div class="input-form">
			                        <div class="form-grid">
			                            <div class="form-group">
			                                <label for="sexoInput">Sexo:</label>
			                                <select id="sexoInput">
			                                    <option value="mujer">Mujer</option>
			                                    <option value="hombre">Hombre</option>
			                                </select>
			                            </div>
			                            <div class="form-group">
			                                <label for="edadInput">Edad:</label>
			                                <input type="number" id="edadInput" value="30" min="18" max="120" step="1">
			                                <div id="edadWarning" class="warning-message"></div>
			                            </div>
			                            <div class="form-group">
			                                <label for="actividadInput">Nivel de Actividad:</label>
			                                <select id="actividadInput">
			                                    <option value="sedentario">Sedentario</option>
			                                    <option value="pocoActivo">Poco Activo</option>
			                                    <option value="activo">Activo</option>
			                                    <option value="deportista">Deportista</option>
			                                </select>
			                            </div>
			                            <div class="form-group">
			                                <label for="imlgInput">IMLG:</label>
			                                <input type="number" id="imlgInput" value="17.0" step="0.1">
			                                <div id="imlgWarning" class="warning-message"></div>
			                            </div>
			                            <div class="form-group">
			                                <label for="imgInput">IMG:</label>
			                                <input type="number" id="imgInput" value="11.1" step="0.1">
			                                <div id="imgWarning" class="warning-message"></div>
			                            </div>
			                        </div>
			                        <div style="text-align: center; margin-top: 15px;">
			                            <button id="updateButton">Actualizar</button>
			                            <button class="download-button" id="downloadButton">Descargar Gráfico</button>
			                        </div>
			                    </div>
			                    <div class="legend-container" id="legendContainer"></div>
			                    <div class="chart-container">
			                        <canvas id="somatotype-canvas"></canvas>
			                        <div id="tooltip" class="tooltip"></div>
			                    </div>
			                </div>
			            </div>
			        </div>
			    </div>

		    		 <!-- Modal Somayotipo Container -->
	<div id="modalSomaContainer" class="modal-soma-container">
    <div class="modal-soma-content">
        <span id="closeSomaModal" class="close-soma-modal">×</span>
        <div class="container-soma-wrapper">
            <div class="container-soma-content">
               <!-- <form id="somatotipoForm" novalidate>-->
                    <h1 id="modalTitle">Somatocarta</h1>
                    <div class="input-form">
                        <div class="form-grid">
                            <div>
                                <label for="nombreInput">Género:</label>
				<select id="nombreInput" name="genero">
				    <option value="" disabled>Selecciona género</option>
				    <option value="masculino" selected>Masculino</option> <!-- Añadido selected -->
				    <option value="femenino">Femenino</option>
				</select>
                            </div>
                            <div>
                                <label for="endoInput">Endomorfia:</label>
                                <input type="number" id="endoInput" name="endomorfia" step="0.1" min="0" value="1">
                            </div>
                            <div>
                                <label for="mesoInput">Mesomorfia:</label>
                                <input type="number" id="mesoInput" name="mesomorfia" step="0.1" min="0" value="1">
                            </div>
                            <div>
                                <label for="ectoInput">Ectomorfia:</label>
                                <input type="number" id="ectoInput" name="ectomorfia" step="0.1" min="0" value="1">
                            </div>
                            <div>
                                <label for="deporteInput">Referentes:</label>
                               <select id="deporteInput" name="grupoReferencia">
				    <option value="selectDxt" selected>Selecciona grupo</option>
				    <option value="sedentarios">Sedentarios</option>
				    <option value="poblacionTipo">General</option>
				    <option value="tomasCliente">Registros</option>
				    <option value="Deportes">Deportes</option> <!-- Añadido selected -->
				</select>
                            </div>
                            <div>
                                <label for="modalidadInput">Modalidad:</label>
                                <select id="modalidadInput" name="modalidad" disabled>
                                    <option value="" disabled selected>Selecciona una modalidad</option>
                                </select>
                            </div>
                        </div>
                        <div class="somatotipo-display">
                            <h3>Somatotipo del Deporte</h3>
                            <div class="somatotipo-values">
                                <div>
                                    <label>Endomorfia:</label>
                                    <input type="text" id="somatotipoEndo" readonly>
                                </div>
                                <div>
                                    <label>Mesomorfia:</label>
                                    <input type="text" id="somatotipoMeso" readonly>
                                </div>
                                <div>
                                    <label>Ectomorfia:</label>
                                    <input type="text" id="somatotipoEcto" readonly>
                                </div>
                                <div>
                                    <label>Dominante:</label>
                                    <input type="text" id="somatotipoDominante" readonly>
                                </div>
                                <div>
                                    <label>X:</label>
                                    <input type="text" id="somatotipoX" readonly>
                                </div>
                                <div>
                                    <label>Y:</label>
                                    <input type="text" id="somatotipoY" readonly>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <img id="somatotype-image" src="https://fermagil.github.io/Nutri_Plan_v2/somatotype-chart.png" alt="Carta de Somatotipo">
                            <canvas id="somatotype-point-canvas2"></canvas>
                            <div id="tooltip" class="tooltip"></div>
                        </div>
                        <div class="button-container">
                            <button id="calcularButton">Actualizar</button>
                            <button type="button" class="download-button">Descargar</button>
                            <button type="button" class="closesomaModal">Cerrar</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
		     <!-- Modal Commit Container -->
		    	<div class="commit-modal">
  <div class="modal-content">
    <!-- Encabezado -->
    <div class="modal-header">
      <h2 class="modal-title">Ficha Médica Deportiva</h2>
      <button class="modal-close" type="button" onclick="closeModal()">&times;</button>
    </div>

    <!-- Contenido del formulario -->
    <form id="form-datos-paciente" onsubmit="guardarDatos(event)">
      <div class="modal-body">

        <table class="data-table">
          <!-- Datos Personales -->
          <tr>
            <th colspan="4">Datos Personales</th>
          </tr>
          <tr>
            <td>ID TEST:</td>
            <td><input type="text" name="idTest" class="input-field"></td>
            <td>Técnico:</td>
            <td><input type="text" name="tecnico" class="input-field"></td>
          </tr>
          <tr>
            <td>FECHA:</td>
            <td><input type="date" name="fecha" class="input-field"></td>
            <td>NOMBRE:</td>
            <td><input type="text" name="nombre" class="input-field"></td>
          </tr>
          <tr>
            <td>APELLIDOS:</td>
            <td><input type="text" name="apellidos" class="input-field"></td>
            <td>DEPORTE:</td>
            <td><input type="text" name="deporte" class="input-field"></td>
          </tr>
          <tr>
            <td>ESPECIALIDAD/PUESTO:</td>
            <td><input type="text" name="especialidadPuesto" class="input-field"></td>
            <td>MODALIDAD / ESPECIALIDAD:</td>
            <td><input type="text" name="modalidadEspecialidad" class="input-field"></td>
          </tr>
          <tr>
            <td>SEXO: 
              <label><input type="radio" name="sexo" value="V"> V</label> / 
              <label><input type="radio" name="sexo" value="M"> M</label></td>
            <td><input type="date" name="fechaNacimiento" class="input-field"></td>
            <td>PAÍS DE NACIMIENTO:</td>
            <td><input type="text" name="paisNacimiento" class="input-field"></td>
          </tr>
          <tr>
            <td>RAZA:</td>
            <td><input type="text" name="raza" class="input-field"></td>
          </tr>

          <!-- DATOS DE ENTRENAMIENTO -->
          <tr>
            <th colspan="4">DATOS DE ENTRENAMIENTO</th>
          </tr>
          <tr>
            <td>AÑOS:</td>
            <td><input type="number" name="entrenamientoAnios" class="input-field"></td>
            <td>DÍAS/SEMANA:</td>
            <td><input type="number" name="diasSemana" class="input-field"></td>
          </tr>
          <tr>
            <td>HORAS/DÍA:</td>
            <td><input type="number" name="horasDia" class="input-field"></td>
            <td>INTENSIDAD:</td>
            <td><input type="text" name="intensidad" class="input-field"></td>
          </tr>
          <tr>
            <td>MUJER: Menarquía <input type="checkbox" name="menarquia"></td>
            <td>Menstruación <input type="checkbox" name="menstruacion"></td>
          </tr>
          <tr>
            <td>NIÑO/A - ADOLESCENTE: Estado madurativo:
              <select name="estadoMadurativo" class="input-field">
                <option value="">Selecciona</option>
                <option value="prepuberal">Prepuberal</option>
                <option value="puberal">Puberal</option>
                <option value="pospuberal">Pospuberal</option>
              </select>
            </td>
          </tr>

          <!-- ANAMNESIS DEPORTIVA -->
          <tr>
            <th colspan="4">ANAMNESIS DEPORTIVA</th>
          </tr>
          <tr>
            <td>Deporte que practica:</td>
            <td><input type="text" name="deportePractica" class="input-field"></td>
            <td>Especialidad:</td>
            <td><input type="text" name="anamnesisEspecialidad" class="input-field"></td>
          </tr>
          <tr>
            <td>Categoría:</td>
            <td><input type="text" name="categoria" class="input-field"></td>
            <td>Logros deportivos (si procede):</td>
            <td><input type="text" name="logros" class="input-field"></td>
          </tr>
          <tr>
            <td>Período de la temporada:</td>
            <td><input type="text" name="periodoTemporada" class="input-field"></td>
            <td>Edad de inicio del entrenamiento:</td>
            <td><input type="number" name="edadInicioEntrenamiento" class="input-field"></td>
          </tr>
          <tr>
            <td>Años de práctica deportiva:</td>
            <td><input type="number" name="aniosPractica" class="input-field"></td>
            <td>Número de días que entrena a la semana:</td>
            <td><input type="number" name="diasEntrenamientoSemana" class="input-field"></td>
          </tr>

          <!-- HÁBITOS ALIMENTICIOS -->
          <tr>
            <th colspan="4">HÁBITOS DE ALIMENTACIÓN</th>
          </tr>
          <tr>
            <td>- Desayuno:</td>
            <td><input type="text" name="desayuno" class="input-field"></td>
            <td>- Media mañana:</td>
            <td><input type="text" name="mediaManana" class="input-field"></td>
          </tr>
          <tr>
            <td>- Comida:</td>
            <td><input type="text" name="comida" class="input-field"></td>
            <td>- Merienda:</td>
            <td><input type="text" name="merienda" class="input-field"></td>
          </tr>
          <tr>
            <td>- Cena:</td>
            <td><input type="text" name="cena" class="input-field"></td>
            <td>- Número de piezas de fruta al día:</td>
            <td><input type="number" name="frutaDia" class="input-field"></td>
          </tr>
          <tr>
            <td>- Consumo de leche y productos lácteos al día:</td>
            <td><input type="text" name="lacteosDia" class="input-field"></td>
            <td>- Ingesta de líquidos al día (ml):</td>
            <td><input type="number" name="liquidosDia" class="input-field"></td>
          </tr>

          <!-- COMENTARIOS -->
          <tr>
            <th colspan="4">COMENTARIOS / OBSERVACIONES</th>
          </tr>
          <tr>
            <td colspan="4">
              <textarea name="comentarios" class="textarea-field" placeholder="Escribe aquí tus observaciones..." rows="5"></textarea>
            </td>
          </tr>

          <!-- BOTONES DE NUTRICIÓN -->
          <tr>
            <td colspan="4" style="text-align:center;">
              <label><input type="radio" name="nutricion" value="Balanceada"> Balanceada</label>
              &nbsp;&nbsp;
              <label><input type="radio" name="nutricion" value="No Balanceada"> No Balanceada</label>
            </td>
          </tr>
        </table>
      </div>

      <!-- Pie de página -->
      <div class="modal-footer">
		  <button type="button" onclick="borrarDatos()" class="btn btn-danger">Borrar Datos Guardados</button>
		  <button class="btn btn-secondary" type="button" onclick="closeModal()">Cancelar</button>
		  <button class="btn btn-primary" type="submit">Guardar Ficha</button>
		</div>
    </form>
  </div>
</div>
                </div>
            </div>
        </form>
	    <div id="save-notification" class="notification hidden">
	    ✅ Datos guardados correctamente
	  </div>
    </main>
    <footer>
        <p>© 2025 NutriApp - Valoración Antropométrica. Consulta siempre a un profesional.</p>
    </footer>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
	
<script>
	//Fade out in Title
	const title = document.getElementById('title');
    setTimeout(() => {
      // Start fade-out
      title.classList.add('fade-out');
      setTimeout(() => {
        // Change content and remove glitch classes
        title.innerHTML = 'Valoracion Antropometrica App';
        title.classList.remove('animated-title', 'fade-out');
        title.classList.add('fade-in');
      }, 500); // Duration of fade-out
    }, 3500); // Wait for glitch animation to complete (3.345s rounded up)
	
    // Accordion Effect
document.addEventListener('DOMContentLoaded', () => {
    const accordionSections = document.querySelectorAll('.accordion-section');

    // Explicitly add 'collapsed' class to all sections
    accordionSections.forEach(section => {
        section.classList.add('collapsed');
    });

    // Add click event listeners to toggle sections
    const accordionHeaders = document.querySelectorAll('.section-header[data-accordion]');
    accordionHeaders.forEach(header => {
        header.addEventListener('click', () => {
            const section = header.closest('.accordion-section');
            if (section) {
                section.classList.toggle('collapsed');
            }
        });
    });
});

// Visibility of the "P. Abdominal"
document.addEventListener('DOMContentLoaded', () => {
    const deportistaSelect = document.getElementById('es_deportista');
    const pliegueAbdominalGroup = document.querySelector('.pliegue-abdominal-group');

    // Function to update visibility based on dropdown value
    const updateVisibility = () => {
        const isDeportista = deportistaSelect.value === 'si';
        pliegueAbdominalGroup.style.display = isDeportista ? 'block' : 'none';
    };

    // Function to handle value changes (from dropdown or external data)
    const handleValueChange = (value) => {
        if (deportistaSelect.value !== value) {
            deportistaSelect.value = value;
        }
        localStorage.setItem('es_deportista', value);
        updateVisibility();
    };

    // Restore saved value from localStorage
    const savedValue = localStorage.getItem('es_deportista');
    if (savedValue) {
        handleValueChange(savedValue);
    }

    // Update localStorage and visibility on dropdown change
    deportistaSelect.addEventListener('change', () => {
        handleValueChange(deportistaSelect.value);
    });

    // Observe changes to the dropdown value programmatically
    const observer = new MutationObserver(() => {
        updateVisibility();
    });
    observer.observe(deportistaSelect, {
        attributes: true,
        attributeFilter: ['value']
    });

    // Expose function to update value programmatically
    window.updateDeportistaValue = (newValue) => {
        handleValueChange(newValue);
    };
});

	//pdf create 
document.addEventListener('DOMContentLoaded', () => {
    // Verifica que jsPDF y html2canvas estén cargados
    if (!window.jspdf || !window.jspdf.jsPDF) {
        console.error('Error: Biblioteca jsPDF no está cargada.');
        alert('Error: No se pudo cargar la biblioteca jsPDF. Verifica la inclusión del script.');
        return;
    }
    if (!window.html2canvas) {
        console.error('Error: Biblioteca html2canvas no está cargada.');
        alert('Error: No se pudo cargar la biblioteca html2canvas. Verifica la inclusión del script.');
        return;
    }
    console.log('Bibliotecas jsPDF y html2canvas cargadas correctamente.');

    const exportarBtn = document.getElementById('exportar-btn');
    if (!exportarBtn) {
        console.error('Botón exportar-btn no encontrado.');
        alert('Error: Botón exportar-btn no encontrado.');
        return;
    }

    // Función para convertir data URL a blob
    const dataURLToBlob = (dataURL) => {
        try {
            const byteString = atob(dataURL.split(',')[1]);
            const mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ab], { type: mimeString });
        } catch (error) {
            console.error('Error al convertir dataURL a blob:', error.message);
            return null;
        }
    };

    // Función para descargar archivo (mejorada)
// Función para descargar archivo (mejorada)
const downloadFile = (blob, filename) => {
    try {
        if (!blob || blob.size === 0) {
            throw new Error(`Blob inválido para ${filename}: tamaño ${blob ? blob.size : 'nulo'}`);
        }
        console.log(`Preparando descarga de ${filename}, tamaño: ${blob.size} bytes`);
        const url = window.URL.createObjectURL(blob);
        console.log(`URL creado para ${filename}: ${url}`);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        // Usar setTimeout para evitar bloqueos del navegador
        setTimeout(() => {
            a.click();
            console.log(`Clic simulado para descargar ${filename}`);
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            console.log(`Archivo ${filename} descargado.`);
        }, 100);
        // Añadir enlace de respaldo en la UI
        const backupLink = document.createElement('a');
        backupLink.href = url;
        backupLink.download = filename;
        backupLink.textContent = `Haz clic aquí para descargar ${filename} si no se descarga automáticamente`;
        backupLink.style.display = 'block';
        backupLink.style.color = 'red';
        document.body.appendChild(backupLink);
        setTimeout(() => {
            if (backupLink.parentNode) {
                document.body.removeChild(backupLink);
            }
        }, 10000); // Eliminar enlace después de 10 segundos
    } catch (error) {
        console.error(`Error al descargar ${filename}:`, error.message);
        alert(`Error al descargar ${filename}: ${error.message}`);
    }
};

    exportarBtn.addEventListener('click', async () => {
        console.log('Exportar button clicked. Starting PDF export.');
        const btn = document.getElementById('exportar-btn');
        const spinner = document.getElementById('pdf-spinner');
        // Mostrar spinner y cambiar texto
        spinner.style.display = 'inline-block';
        btn.textContent = 'Creando PDF...';
        btn.disabled = true;

        try {
            const explanationContent = document.getElementById('explanation-content');
            if (!explanationContent) {
                throw new Error('Elemento explanation-content no encontrado');
            }

            // Crea un nuevo documento PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'pt',
                format: 'a4'
            });
            console.log('Documento PDF creado:', doc);

            // Verifica que autoTable esté disponible
            if (!doc.autoTable) {
                throw new Error('El plugin jspdf-autotable no está cargado. Asegúrate de incluir el script jspdf.plugin.autotable.min.js.');
            }

            // Define márgenes
            const margin = {
                top: 50,
                bottom: 90,
                left: 40,
                right: 40
            };
            let yPosition = 50; // Posición vertical inicial (en puntos)
            const pageWidth = doc.internal.pageSize.getWidth(); // ~595pt para A4
            const pageHeight = doc.internal.pageSize.getHeight(); // ~842pt para A4
            const contentWidth = pageWidth - margin.left - margin.right; // ~515pt

            // Obtener datos personales y resultados desde el HTML
            const nombre = document.getElementById('nombre')?.value?.trim() || 'Cliente';
            const edad = document.getElementById('edad')?.value?.trim() || 'N/A';
            const genero = document.getElementById('genero')?.value?.trim() || 'N/A';
            const edadMetabolica = document.getElementById('result-edadmetabolica')?.textContent?.trim() || 'N/A';
            const tipologia = document.getElementById('result-tipologia-actual')?.textContent?.trim() || 'N/A';

            // Obtener y formatear la fecha
            const selectElement = document.getElementById('seleccionar_fecha');
            const fechaId = selectElement?.value?.trim();
            console.log('Valor crudo de seleccionar_fecha (value):', JSON.stringify(fechaId));
            let fecha = 'N/A';
            if (selectElement && fechaId && fechaId !== '') {
                try {
                    const fechaText = selectElement.selectedOptions[0]?.text?.trim();
                    console.log('Texto de la opción seleccionada:', JSON.stringify(fechaText));
                    if (fechaText && fechaText !== 'Seleccionar fecha...') {
                        const match = fechaText.match(/^(\d{2})\/(\d{2})\/(\d{4})(?:,.*(\d{2}:\d{2}))?$/);
                        if (match) {
                            const day = match[1];
                            const month = match[2];
                            const year = match[3].slice(-2); // Últimos 2 dígitos del año
                            fecha = `${day}/${month}/${year}`;
                            console.log('Fecha parseada:', fecha);
                        } else {
                            console.warn('Formato de texto de fecha inválido:', JSON.stringify(fechaText));
                        }
                    } else {
                        console.warn('No se seleccionó una fecha válida o es el placeholder:', JSON.stringify(fechaText));
                    }
                } catch (error) {
                    console.error('Error al formatear la fecha:', error.message);
                }
            } else {
                console.warn('No se seleccionó ninguna fecha o select inválido:', JSON.stringify(fechaId));
            }

            // Construir el título dinámico
            const title = `Explicación de los Resultados con Fecha de Valoración ${fecha} y Sugerencias para ${nombre} con ${edad} años, género ${genero}, Edad Metabólica ${edadMetabolica} años, Tipología ${tipologia}`;

            // Función auxiliar para parsear subsecciones de result-analisis
		// Función auxiliar para parsear subsecciones de result-analisis
		const parseBioquimicosSubsections = () => {
		    const resultAnalisis = document.getElementById('result-analisis');
		    if (!resultAnalisis) {
		        console.warn('Elemento result-analisis no encontrado.');
		        return [{ fullWidth: true, value: '---' }];
		    }
		
		    const subsections = [
		        'Deficiencia de Vitamina D',
		        'Fosfatasa Alcalina Elevada',
		        'Riesgo de Hipotiroidismo',
		        'Testosterona Baja',
		        'Cortisol Elevado',
		        'Inflamación Sistémica',
		        'Hígado Graso (NAFLD)',
		        'Riesgo de Hígado Graso (NAFLD)',
		        'Riesgo de Fibrosis Hepática',
		        'Disfunción Renal',
		        'Riesgo Metabólico Elevado',
		        'Resistencia Leptínica',
		        'Adiponectina Baja',
		        'Diabetes No Controlada',
		        'Prediabetes',
		        'Diabetes Mellitus',
		        'Resistencia a la Insulina',
		        'Obesidad Metabólica (Síndrome Metabólico)',
		        'Riesgo de Obesidad Metabólica',
		        'Desnutrición Proteica',
		        'Riesgo de Desnutrición Proteica'
		    ];
		
		    const result = [];
		    let currentSubsection = null;
		    let currentText = '';
		    const nodes = resultAnalisis.childNodes;
		
		    for (const node of nodes) {
		        if (node.nodeType === Node.ELEMENT_NODE) {
		            const tag = node.tagName.toLowerCase();
		            const text = node.textContent.trim();
		
		            if (tag === 'h2') {
		                // Guardar la subsección anterior si existe
		                if (currentSubsection && currentText) {
		                    result.push({ subsectionTitle: true, content: currentSubsection });
		                    result.push({ fullWidth: true, value: currentText.trim() || '---' });
		                    console.log(`Subsección procesada: ${currentSubsection}`);
		                    currentText = '';
		                }
		                // Verificar si el h2 es una subsección válida
		                if (subsections.includes(text)) {
		                    currentSubsection = text;
		                } else {
		                    currentSubsection = null;
		                }
		            } else if (['p', 'div', 'span', 'li'].includes(tag) && currentSubsection) {
		                // Añadir texto asociado a la subsección
		                currentText += (currentText ? '\n' : '') + text;
		            }
		        } else if (node.nodeType === Node.TEXT_NODE && currentSubsection) {
		            const text = node.textContent.trim();
		            if (text) {
		                currentText += (currentText ? '\n' : '') + text;
		            }
		        }
		    }
		
		    // Añadir la última subsección si existe
		    if (currentSubsection && currentText) {
		        result.push({ subsectionTitle: true, content: currentSubsection });
		        result.push({ fullWidth: true, value: currentText.trim() || '---' });
		        console.log(`Subsección procesada: ${currentSubsection}`);
		    }
		
		    // Si no se encontraron subsecciones, añadir fila por defecto
		    if (result.length === 0) {
		        console.warn('No se encontraron subsecciones <h2> en result-analisis.');
		        result.push({ fullWidth: true, value: '---' });
		    }
		
		    return result;
		};
		
		// Definir datos de la tabla principal, organizados por secciones
		const tableData = [
		    // Composición Corporal
		    { section: 'Composición Corporal', metric: '', value: '', note: '' },
		    { metric: 'IMC', value: `${document.getElementById('result-imc')?.textContent?.trim() || '---'} kg/m²`, note: document.getElementById('imc-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'ICC', value: document.getElementById('result-icc')?.textContent?.trim() || '---', note: document.getElementById('icc-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: '% Grasa Deseado', value: `${document.getElementById('result-grasa-pct-deseado')?.textContent?.trim() || '---'} %`, note: document.getElementById('grasa-pct-deseado-source')?.textContent?.trim() || '(No estimado)' },
		    { metric: '% Grasa Actual', value: `${document.getElementById('result-grasa-pct-actual')?.textContent?.trim() || '---'} %`, note: document.getElementById('grasa-pct-actual-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: '% Grasa Metabólico', value: `${document.getElementById('result-grasa-pct-metabolic')?.textContent?.trim() || '---'} %`, note: document.getElementById('grasa-pct-metabolic-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: '% Grasa Visceral', value: `${document.getElementById('result-grasa-pct-visceral')?.textContent?.trim() || '---'} %`, note: document.getElementById('grasa-pct-visceral-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Grasa Actual (MGa)', value: `${document.getElementById('result-masa-grasa-actual')?.textContent?.trim() || '---'} kg`, note: document.getElementById('masa-grasa-actual-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Grasa Metabólico (MG)', value: `${document.getElementById('result-masa-grasa-metabolic')?.textContent?.trim() || '---'} kg`, note: document.getElementById('masa-grasa-metabolic-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: '% Grasa (Deurenberg)', value: `${document.getElementById('result-grasa-pct-Deurenberg')?.textContent?.trim() || '---'} %`, note: document.getElementById('grasa-pct-Deurenberg-source')?.textContent?.trim() || '(No estimado)' },
		    { metric: '% Grasa (CUN-BAE)', value: `${document.getElementById('result-grasa-pct-CUN-BAE')?.textContent?.trim() || '---'} %`, note: document.getElementById('grasa-pct-CUN-BAE-source')?.textContent?.trim() || '(No estimado)' },
		    { metric: 'Grasa Abdominal Total', value: `${document.getElementById('result-grasa-abdominal')?.textContent?.trim() || '---'} cm²`, note: document.getElementById('grasa-abdominal-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Espesor Grasa Abdominal', value: `${document.getElementById('result-abdominal-fat-thickness')?.textContent?.trim() || '---'} cm`, note: document.getElementById('abdominal-fat-thickness-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Agua Corporal Total', value: document.getElementById('result-agua-corporal')?.textContent?.trim() || '---', note: document.getElementById('agua-corporal-source')?.textContent?.trim() || '(No calculado)' },
		    // Métricas Metabólicas
		    { section: 'Métricas Metabólicas', metric: '', value: '', note: '' },
		    { metric: 'Edad Metabólica', value: `${document.getElementById('result-edadmetabolica')?.textContent?.trim() || '---'} años`, note: document.getElementById('edadmetabolica-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'TMB', value: `${document.getElementById('result-tmb')?.textContent?.trim() || '---'} Kcal`, note: document.getElementById('tmb-source')?.textContent?.trim() || '(No calculado)' },
		    // Masa Libre de Grasa
		    { section: 'Masa Libre de Grasa', metric: '', value: '', note: '' },
		    { metric: 'Masa Magra Actual (MLG)', value: `${document.getElementById('result-masa-magra-actual')?.textContent?.trim() || '---'} kg`, note: document.getElementById('masa-magra-actual-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Magra Metabólico (MLG)', value: `${document.getElementById('result-masa-magra-metabolic')?.textContent?.trim() || '---'} kg`, note: document.getElementById('masa-magra-metabolic-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'IMLG Actual', value: `${document.getElementById('result-imlg-actual')?.textContent?.trim() || '---'} kg/m²`, note: document.getElementById('imlg-actual-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'IMLG Metabólico', value: `${document.getElementById('result-imlg-metabolic')?.textContent?.trim() || '---'} kg/m²`, note: document.getElementById('imlg-metabolic-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'IMG Actual', value: `${document.getElementById('result-img-actual')?.textContent?.trim() || '---'} kg/m²`, note: document.getElementById('img-actual-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'IMG Metabólico', value: `${document.getElementById('result-img-metabolic')?.textContent?.trim() || '---'} kg/m²`, note: document.getElementById('img-metabolic-source')?.textContent?.trim() || '(No calculado)' },
		    // Estructurales
		    { section: 'Estructurales', metric: '', value: '', note: '' },
		    { metric: 'Somatotipo', value: document.getElementById('result-somatotipo')?.textContent?.trim() || '---', note: document.getElementById('somatotipo-source')?.textContent?.trim() || '(Endo: Meso: Ecto)' },
		    { metric: 'Tipología Actual', value: document.getElementById('result-tipologia-actual')?.textContent?.trim() || '---', note: document.getElementById('tipologia-actual-source')?.textContent?.trim() || '(Relación IMLG/IMG)' },
		    { metric: 'Tipología Metabólico', value: document.getElementById('result-tipologia-metabolic')?.textContent?.trim() || '---', note: document.getElementById('tipologia-metabolic-source')?.textContent?.trim() || '(Relación IMLG/IMG)' },
		    { metric: 'Área Muscular Brazo (AMB)', value: `${document.getElementById('result-amb')?.textContent?.trim() || '---'} cm²`, note: document.getElementById('amb-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Muscular Total (MMT)', value: `${document.getElementById('result-mmt')?.textContent?.trim() || '---'} kg`, note: document.getElementById('mmt-source')?.textContent?.trim() || '(Estimado según AMB)' },
		    { metric: '% Masa Muscular', value: `${document.getElementById('result-Pct-mmt')?.textContent?.trim() || '---'} %`, note: document.getElementById('Pct-mmt-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'AMB(c) Corregida', value: `${document.getElementById('result-ambc')?.textContent?.trim() || '---'} cm²`, note: document.getElementById('ambc-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Muscular Total (MMT2)', value: `${document.getElementById('result-mmt2')?.textContent?.trim() || '---'} kg`, note: document.getElementById('mmt2-source')?.textContent?.trim() || '(Estimado según AMB(c) Heymsfield, 1982)' },
		    { metric: '% Masa Muscular (MMT2)', value: `${document.getElementById('result-Pct-mmt2')?.textContent?.trim() || '---'} %`, note: document.getElementById('Pct-mmt2-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Area Grasa Brazo', value: `${document.getElementById('result-agb')?.textContent?.trim() || '---'} %`, note: document.getElementById('agb-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Ósea', value: `${document.getElementById('result-masa-osea')?.textContent?.trim() || '---'} kg`, note: document.getElementById('masa-osea-source')?.textContent?.trim() || '(No calculado)' },
		    { metric: 'Masa Residual', value: `${document.getElementById('result-masa-residual')?.textContent?.trim() || '---'} kg`, note: document.getElementById('masa-residual-source')?.textContent?.trim() || '(No calculado)' },
		    // Objetivos
		    { section: 'Objetivos', metric: '', value: '', note: '' },
		    { metric: 'Peso Ideal (% Grasa)', value: `${document.getElementById('result-peso-ideal')?.textContent?.trim() || '---'} kg`, note: document.getElementById('peso-ideal-source')?.textContent?.trim() || '(Según % GC Actual Rango de Edad, Sexo y AF)' },
		    { metric: 'Peso Ideal (% Grasa Mtb)', value: `${document.getElementById('result-peso-ideal-metabolic')?.textContent?.trim() || '---'} kg`, note: document.getElementById('pesometabolico-source')?.textContent?.trim() || '(Según % GC Metabolico Edad, Sexo y AF)' },
		    { metric: 'Peso a Perder/Ganar', value: `${document.getElementById('result-peso-objetivo')?.textContent?.trim() || '---'} kg`, note: document.getElementById('peso-objetivo-source')?.textContent?.trim() || 'Peso Actual - Masa Grasa' },
		    { metric: 'Peso a Perder/Ganar (Mtb)', value: `${document.getElementById('result-peso-objetivo-metabolic')?.textContent?.trim() || '---'} kg`, note: document.getElementById('peso-objetivo-metabolicsource')?.textContent?.trim() || 'Peso Actual - Masa Grasa Metabolica' },
		    { metric: 'Masa Muscular a Ganar', value: `${document.getElementById('result-peso-muscular')?.textContent?.trim() || '---'} kg`, note: document.getElementById('peso-muscular-source')?.textContent?.trim() || '' },
		    { metric: 'Masa Muscular a Ganar (Mtb)', value: `${document.getElementById('result-peso-muscular-matabolic')?.textContent?.trim() || '---'} kg`, note: document.getElementById('peso-muscular-metabolicsource')?.textContent?.trim() || '' },
		    // Interpretación de Resultados Parámetros Bioquímicos
		    { section: 'Interpretación de Resultados Parámetros Bioquímicos', metric: '', value: '', note: '' },
		    ...parseBioquimicosSubsections()
		];

            // Crear tabla principal con autoTable, incluyendo el título como encabezado
            // Crear tabla principal con autoTable, incluyendo el título como encabezado
		doc.autoTable({
		    startY: yPosition,
		    head: [
		        [{ content: title, colSpan: 3, styles: { fontStyle: 'bold', fontSize: 14, fillColor: [255, 255, 255], textColor: [56, 142, 60], halign: 'center' } }],
		        ['Métrica', 'Valor', 'Nota']
		    ],
		    body: tableData.map(row => {
		        if (row.section) {
		            return [{ content: row.section, colSpan: 3, styles: { fontStyle: 'bold', fillColor: [200, 200, 200] } }];
		        }
		        if (row.subsectionTitle) {
		            return [{ content: row.content, colSpan: 3, styles: { fontStyle: 'bold', fillColor: [220, 220, 220] } }];
		        }
		        if (row.fullWidth) {
		            return [{ content: row.value, colSpan: 3, styles: { fontStyle: 'normal', fillColor: [255, 255, 255] } }];
		        }
		        return [row.metric, row.value, row.note];
		    }),
		    theme: 'grid',
		    styles: {
		        font: 'helvetica',
		        fontSize: 9,
		        textColor: [0, 0, 0],
		        lineColor: [0, 0, 0],
		        lineWidth: 0.5,
		        cellPadding: 4
		    },
		    headStyles: {
		        fillColor: [56, 142, 60], // Verde para el encabezado de columnas
		        textColor: [255, 255, 255], // Texto blanco
		        fontStyle: 'bold',
		        fontSize: 10
		    },
		    margin: { left: margin.left, right: margin.right },
		    didDrawPage: (data) => {
		        yPosition = data.cursor.y; // Actualiza yPosition después de la tabla
		    }
		});

            console.log('Tabla principal de resultados con título añadida en yPosition:', yPosition);

            // Añadir título para el contenido de explanation-content
		yPosition += 20; // Espacio después de la tabla
		if (yPosition + 50 > pageHeight - margin.bottom) {
		    doc.addPage();
		    yPosition = margin.top;
		    console.log('Nueva página añadida para explicación, yPosition reiniciada:', yPosition);
		}
		
		// Configurar estilo similar a <h2> (título destacado)
		doc.setFont('helvetica', 'bold');  // Fuente en negrita
		doc.setFontSize(14);  // Tamaño más grande (12 es normal, 14-16 para h2)
		doc.setTextColor(56, 142, 60);  // Verde oscuro (como en tu tabla) o [0, 0, 0] para negro
		
		// Escribir el título
		doc.text('Detalles de la Explicación de los Resultados por Secciones:', margin.left, yPosition);
		
		// Restaurar estilo normal para el texto siguiente
		doc.setFont('helvetica', 'normal');
		doc.setFontSize(10);  // Tamaño estándar
		doc.setTextColor(0, 0, 0);  // Negro
		
		yPosition += 10;  // Espacio después del título (ajusta según necesidad)

            // Definir secciones principales
            const sections = [
                'Explicación de los Resultados del IMC, ICC y % Grasa Actual',
                'Masa Grasa y Masa Magra(MLG), Tipología del Cuerpo según Índices de Masa (IMLG e IMG), Interpretación de las Tipologías',
                'Edad Metabólica, ¿Cómo Mejorar tu Edad Metabólica?',
                'Relación entre IMLG, TMB y GET, Sugerencias Personalizadas',
                'Reserva Proteica AMB, Masa Ósea y Masa Residual',
                'Estimacion del Somatotipo, Sugerencias para Mejorar tu Composición Corporal, Medición del Somatotipo, Categorías de Predominancia Física y Recomendaciones'
            ];

            // Mapear encabezados del DOM a secciones principales
            const headerMapping = {
                'Explicación de los Resultados del IMC, ICC y % Grasa Actual': 0,
                'Peso Ideal Estimado': 0,
                'Masa Grasa y Masa Magra(MLG)': 1,
                'Tipología del Cuerpo según Índices de Masa (IMLG e IMG)': 1,
                'Edad Metabólica': 2,
                'Sugerencias Personalizadas': [2, 3],
                'Relación entre IMLG, TMB y GET': 3,
                'Reserva Proteica AMB, Masa Ósea y Masa Residual': 4,
                'Estimacion del Somatotipo': 5,
                'Sugerencias para Mejorar tu Composición Corporal': 5,
                'Medición del Somatotipo': 5
            };

            // Recolectar todas las imágenes (charts)
            // Recolectar todas las imágenes (charts) - Ajustado para el chart de somatotipo
const canvasElements = explanationContent.querySelectorAll('canvas, div canvas');
const chartDataUrls = [];
for (let i = 0; i < canvasElements.length; i++) {
    const canvas = canvasElements[i];
    try {
        let elementToCapture = canvas;
        // Para el último chart (somatotype), capturar el .chart-container que contiene <img> y <canvas>
        if (i === canvasElements.length - 1) {
            const parentContainer = canvas.closest('.chart-container');
            if (parentContainer && parentContainer.querySelector('#somatotype-image')) {
                elementToCapture = parentContainer;
                console.log(`Capturando .chart-container para chart ${i + 1} (somatotype) con <img id="somatotype-image">`);
            } else {
                console.warn(`No se encontró .chart-container con #somatotype-image para chart ${i + 1}`);
            }
        }
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const renderedCanvas = await html2canvas(elementToCapture, {
            scale: 2,
            useCORS: true,
            allowTaint: false,
            logging: true,
            backgroundColor: null, // Preservar fondo
            onclone: async (document, element) => {
                // Forzar carga de la imagen de fondo para el somatotype
                if (i === canvasElements.length - 1) {
                    const img = element.querySelector('#somatotype-image');
                    if (img) {
                        await new Promise((resolve, reject) => {
                            img.crossOrigin = 'Anonymous';
                            img.onload = resolve;
                            img.onerror = () => {
                                console.error(`Error al cargar #somatotype-image para chart ${i + 1}`);
                                reject();
                            };
                            // Forzar recarga si la imagen ya está cargada
                            if (img.complete) {
                                img.src = img.src;
                            }
                        });
                        console.log(`#somatotype-image cargada para chart ${i + 1}`);
                    }
                }
            }
        });
        const dataUrl = renderedCanvas.toDataURL('image/png');
        console.log(`Chart ${i + 1} capturado:`, {
            dataUrlLength: dataUrl.length,
            width: renderedCanvas.width,
            height: renderedCanvas.height
        });
        chartDataUrls.push(dataUrl);
        console.log(`Chart ${i + 1} listo para depuración.`);
    } catch (error) {
        console.error(`Error al capturar chart ${i + 1}:`, error.message);
        chartDataUrls.push(null);
    }
}
       

            // Procesar el contenido de explanation-content por secciones
            const sectionContents = sections.map(() => []);
            let currentSectionIndex = 0;
            let chartIndex = 0;
            let lastSugerenciasSection = 2;

            const elements = explanationContent.childNodes;
            console.log('Encabezados encontrados en explanation-content:');
            for (const element of elements) {
                if (element.nodeType !== Node.ELEMENT_NODE) continue;

                const tag = element.tagName.toLowerCase();
                let content = '';

                if (['h1', 'h2', 'h3'].includes(tag)) {
                    const text = element.textContent.trim();
                    console.log(`- ${tag}: "${text}"`);
                    if (text in headerMapping) {
                        const mapping = headerMapping[text];
                        if (Array.isArray(mapping)) {
                            currentSectionIndex = text === 'Sugerencias Personalizadas' && lastSugerenciasSection === 2 ? 2 : 3;
                            lastSugerenciasSection = currentSectionIndex;
                        } else {
                            currentSectionIndex = mapping;
                        }
                    }
                } else if (tag === 'p') {
                    content = element.textContent.trim();
                    if (content) {
                        sectionContents[currentSectionIndex].push({ type: 'text', content });
                    }
                } else if (tag === 'ul' || tag === 'ol') {
                    const items = element.querySelectorAll('li');
                    let index = 1;
                    for (const li of items) {
                        const text = li.textContent.trim();
                        if (text) {
                            const bullet = tag === 'ul' ? '•' : `${index++}.`;
                            content = `${bullet} ${text}`;
                            sectionContents[currentSectionIndex].push({ type: 'text', content });
                        }
                    }
                } else if (tag === 'table') {
                    const rows = element.querySelectorAll('tr');
                    for (const row of rows) {
                        const cells = row.querySelectorAll('th, td');
                        const cellTexts = Array.from(cells).map(cell => cell.textContent.trim()).filter(text => text);
                        if (cellTexts.length === 0) continue;
                        content = cellTexts.join(' | ');
                        sectionContents[currentSectionIndex].push({ type: 'text', content });
                    }
                } else if (tag === 'canvas' || (tag === 'div' && element.querySelector('canvas'))) {
                    if (chartIndex < chartDataUrls.length) {
                        sectionContents[currentSectionIndex].push({
                            type: 'image',
                            content: chartDataUrls[chartIndex] || `Error: No se pudo cargar el chart ${chartIndex + 1}.`,
                            sectionIndex: currentSectionIndex
                        });
                        console.log(`Chart ${chartIndex + 1} asignado a sección ${sections[currentSectionIndex]}`);
                    }
                    chartIndex++;
                }
            }

            // Renderizar una tabla por sección (solo texto) y añadir imágenes después
            for (let i = 0; i < sections.length; i++) {
                const section = sections[i];
                const content = sectionContents[i].filter(item => item.type === 'text');

                if (content.length === 0 && !sectionContents[i].some(item => item.type === 'image')) {
                    console.warn(`Sección "${section}" está vacía, omitiendo tabla.`);
                    continue;
                }

                // Añadir tabla para texto
                if (content.length > 0) {
                    if (yPosition + 50 > pageHeight - margin.bottom) {
                        doc.addPage();
                        yPosition = margin.top;
                        console.log('Nueva página añadida para tabla de sección, yPosition reiniciada:', yPosition);
                    }

                    doc.autoTable({
                        startY: yPosition,
                        head: [[section]],
                        body: content.map(item => [item.content]),
                        theme: 'grid',
                        styles: {
                            font: 'helvetica',
                            fontSize: 9,
                            textColor: [0, 0, 0],
                            lineColor: [0, 0, 0],
                            lineWidth: 0.5,
                            cellPadding: 4
                        },
                        headStyles: {
                            fillColor: [56, 142, 60],
                            textColor: [255, 255, 255],
                            fontStyle: 'bold',
                            fontSize: 10
                        },
                        columnStyles: {
                            0: { cellWidth: contentWidth }
                        },
                        margin: { left: margin.left, right: margin.right },
                        didDrawPage: (data) => {
                            yPosition = data.cursor.y + 10;
                        }
                    });

                    console.log(`Tabla de texto para sección "${section}" añadida en yPosition:`, yPosition);
                }

                // Añadir imágenes directamente con doc.addImage
                // Añadir imágenes directamente con doc.addImage
		const images = sectionContents[i].filter(item => item.type === 'image');
		for (const imageItem of images) {
		    if (imageItem.content.startsWith('data:')) {
		        try {
		            const imgProps = doc.getImageProperties(imageItem.content);
		            console.log(`Propiedades de imagen para sección "${section}":`, {
		                width: imgProps.width,
		                height: imgProps.height,
		                dataLength: imageItem.content.length
		            });
		            // Confirmar si es el último chart (somatotype)
		            const isLastChart = chartIndex === canvasElements.length - 1;
		            if (isLastChart) {
		                console.log(`Renderizando chart 6 (somatotype) en sección "${section}", incluye <img id="somatotype-image">`);
		            }
		
		            const pdfWidth = contentWidth - 8;
		            const imgHeight = (imgProps.height * pdfWidth) / imgProps.width;
		
		            if (yPosition + imgHeight + 20 > pageHeight - margin.bottom) {
		                doc.addPage();
		                yPosition = margin.top;
		                console.log('Nueva página añadida para imagen, yPosition reiniciada:', yPosition);
		            }	
		
		            //doc.text(`Chart ${chartIndex + 1} añadido:`, margin.left, yPosition);
		            yPosition += 15;
		            doc.addImage(imageItem.content, 'PNG', margin.left + 4, yPosition + 4, pdfWidth, imgHeight);
		            console.log(`Imagen renderizada directamente en sección "${section}" con dimensiones ${pdfWidth}x${imgHeight}${isLastChart ? ' (somatotype con <img>)' : ''}`);
		            yPosition += imgHeight + 20;
		        } catch (error) {
		            console.error(`Error al renderizar imagen directamente en sección "${section}":`, error.message);
		            doc.text(`Error: No se pudo renderizar el chart ${chartIndex + 1}.`, margin.left, yPosition + 20);
		            yPosition += 30;
		        }
		    } else {
		        doc.text(imageItem.content, margin.left, yPosition + 20);
		        yPosition += 30;
		    }
		    chartIndex++;
		}
            }

            // Genera el blob y descárgalo
           	console.log('Generando blob PDF...');
		const blob = doc.output('blob');
		if (!blob || blob.size === 0) {
		    throw new Error('El blob del PDF es inválido o está vacío.');
		}
		console.log('Blob PDF generado:', { size: blob.size, type: blob.type });
		downloadFile(blob, `Resultados_${nombre}_${fecha}.pdf`);
		console.log('Documento PDF generado y descargado.');
		alert('Documento PDF exportado exitosamente.');

            // Para depuración: instrucción para descargar charts PNG manualmente
            console.log('Para descargar los charts PNG, ejecuta en la consola:');
            console.log(chartDataUrls.map((url, i) => `downloadFile(dataURLToBlob("${url}"), "chart_${i + 1}.png");`).join('\n'));
        } catch (error) {
            console.error('Error en exportación a PDF:', error.message, error.stack);
            alert('Error al exportar a PDF: ' + error.message);
        } finally {
            // Restaurar botón
            spinner.style.display = 'none';
            btn.textContent = 'Informe';
            btn.disabled = false;
        }
    });
});
	//Abrir Container MapaTipologia Corporal
 // File loading functions (for XLSX, kept as is)
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
            return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];

                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));

                    var headerRowIndex = filteredData.findIndex((row, index) =>
                        row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                        headerRowIndex = 0;
                    }

                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        // Body composition chart logic
        const cliente = [{ x: 18, y: 6 }];

        const typologies = [
            { name: 'Obeso Sedentario', color: 'rgba(255, 153, 153, 0.5)', emoji: '📺🥔' },
            { name: 'Adiposo Sedentario', color: 'rgba(255, 0, 0, 0.5)', emoji: '🥐🍩' },
            { name: 'Obeso Sólido', color: 'rgba(255, 165, 0, 0.5)', emoji: '🍔🦍' },
            { name: 'Delgado Adiposo', color: 'rgba(255, 204, 153, 0.5)', emoji: '🚶🍩' },
            { name: 'Promedio', color: 'rgba(212, 237, 145, 0.5)', emoji: '😊' },
            { name: 'Atleta Promedio', color: 'rgba(0, 128, 0, 0.5)', emoji: '🏃' },
            { name: 'Delgado', color: 'rgba(255, 255, 153, 0.5)', emoji: '🌱🧘' },
            { name: 'Esbelto Magro Atleta', color: 'rgba(0, 128, 0, 0.5)', emoji: '💪🔥' },
            { name: 'Musculoso Atleta', color: 'rgba(0, 128, 0, 0.5)', emoji: '🏋️💪' }
        ];

        function createLegend() {
            const legendContainer = document.getElementById('legendContainer');
            legendContainer.innerHTML = ''; // Clear existing content
            typologies.forEach(typology => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <span class="legend-color" style="background-color: ${typology.color};"></span>
                    <span>${typology.emoji} ${typology.name}</span>
                `;
                legendContainer.appendChild(legendItem);
            });
        }

        const canvas = document.getElementById('somatotype-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 700;
        canvas.height = 350;

        const tooltip = document.getElementById('tooltip');

        const xMin = 11.5;
        const xMax = 26.7;
        const yMin = 2;
        const yMax = 14.3;

        let currentPointX = 0;
        let currentPointY = 0;
        const pointRadius = 7;

        function mapToCanvas(value, min, max, canvasSize) {
            return ((value - min) / (max - min)) * canvasSize;
        }

        function drawGrid(sexo, actividad, edad) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            let ranges = RangesGet(sexo, actividad, edad);
            let imlgRanges = ranges.imlgRanges;
            let imgRanges = ranges.imgRanges;
            let maxIMLG = ranges.maxIMLG;
            let maxIMG = ranges.maxIMG;

            const xBajo = mapToCanvas(imlgRanges.bajo, xMin, xMax, canvas.width);
            const xMedio = mapToCanvas(imlgRanges.medio, xMin, xMax, canvas.width);
            const xAlto = mapToCanvas(imlgRanges.alto, xMin, xMax, canvas.width);
            const xMaxCanvas = mapToCanvas(maxIMLG, xMin, xMax, canvas.width);

            const yBajo = canvas.height - mapToCanvas(imgRanges.bajo, yMin, yMax, canvas.height);
            const yMedio = canvas.height - mapToCanvas(imgRanges.medio, yMin, yMax, canvas.height);
            const yAlto = canvas.height - mapToCanvas(imgRanges.alto, yMin, yMax, canvas.height);
            const yMaxCanvas = canvas.height - mapToCanvas(maxIMG, yMin, yMax, canvas.height);

            const regions = [
                { xStart: 0, xEnd: xMedio, yStart: 0, yEnd: yAlto, typology: 'Obeso Sedentario' },
                { xStart: xMedio, xEnd: xAlto, yStart: 0, yEnd: yAlto, typology: 'Adiposo Sedentario' },
                { xStart: xAlto, xEnd: canvas.width, yStart: 0, yEnd: yAlto, typology: 'Obeso Sólido' },
                { xStart: 0, xEnd: xMedio, yStart: yAlto, yEnd: yMedio, typology: 'Delgado Adiposo' },
                { xStart: xMedio, xEnd: xAlto, yStart: yAlto, yEnd: yMedio, typology: 'Promedio' },
                { xStart: xAlto, xEnd: canvas.width, yStart: yAlto, yEnd: yMedio, typology: 'Atleta Promedio' },
                { xStart: 0, xEnd: xMedio, yStart: yMedio, yEnd: canvas.height, typology: 'Delgado' },
                { xStart: xMedio, xEnd: xAlto, yStart: yMedio, yEnd: canvas.height, typology: 'Esbelto Magro Atleta' },
                { xStart: xAlto, xEnd: canvas.width, yStart: yMedio, yEnd: canvas.height, typology: 'Musculoso Atleta' }
            ];

            regions.forEach(region => {
                const typologyObj = typologies.find(t => t.name === region.typology);
                const color = typologyObj ? typologyObj.color : 'rgba(200, 200, 200, 0.5)';
                ctx.fillStyle = color;
                ctx.fillRect(region.xStart, region.yStart, region.xEnd - region.xStart, region.yEnd - region.yStart);

                ctx.fillStyle = 'black';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const labelX = (region.xStart + region.xEnd) / 2;
                const labelY = (region.yStart + region.yEnd) / 2;
                ctx.fillText(region.typology, labelX, labelY);
            });

            ctx.strokeStyle = 'black';
            ctx.lineWidth = 1;

            ctx.beginPath();
            ctx.moveTo(xMedio, 0);
            ctx.lineTo(xMedio, canvas.height);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(xAlto, 0);
            ctx.lineTo(xAlto, canvas.height);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(0, yMedio);
            ctx.lineTo(canvas.width, yMedio);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(0, yAlto);
            ctx.lineTo(canvas.width, yAlto);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(0, canvas.height);
            ctx.lineTo(canvas.width, canvas.height);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(0, canvas.height);
            ctx.stroke();

            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            for (let imlg = 12; imlg <= 26; imlg += 2) {
                const x = mapToCanvas(imlg, xMin, xMax, canvas.width);
                ctx.fillText(imlg, x, canvas.height - 15);
                ctx.beginPath();
                ctx.moveTo(x, canvas.height);
                ctx.lineTo(x, canvas.height - 5);
                ctx.stroke();
            }

            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let img = 2; img <= 14; img += 2) {
                const y = canvas.height - mapToCanvas(img, yMin, yMax, canvas.height);
                ctx.fillText(img, 15, y);
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(5, y);
                ctx.stroke();
            }

            ctx.textAlign = 'center';
            ctx.fillText('IMLG (kg/m²)', canvas.width / 2, canvas.height - 30);
            ctx.save();
            ctx.translate(30, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('IMG (kg/m²)', 0, 0);
            ctx.restore();
        }

        function drawPoint(imlg, img, color) {
            const x = mapToCanvas(imlg, xMin, xMax, canvas.width);
            const y = canvas.height - mapToCanvas(img, yMin, yMax, canvas.height);
            ctx.beginPath();
            ctx.arc(x, y, pointRadius, 0, 2 * Math.PI);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = 'black';
            ctx.stroke();

            currentPointX = x;
            currentPointY = y;
        }

        function isCursorOverPoint(mouseX, mouseY) {
            const dx = mouseX - currentPointX;
            const dy = mouseY - currentPointY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance <= pointRadius + 5;
        }

        canvas.addEventListener('mousemove', (event) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;

            if (isCursorOverPoint(mouseX, mouseY)) {
                const sexo = document.getElementById('sexoInput').value;
                const edad = parseInt(document.getElementById('edadInput').value);
                const actividad = document.getElementById('actividadInput').value;
                const result = detectarTipologia(cliente, sexo, actividad, edad);
                const tipologia = result.tipologia;
                const typologyObj = typologies.find(t => t.name === tipologia);
                const emoji = typologyObj ? typologyObj.emoji : '';
                tooltip.style.display = 'block';
                tooltip.innerHTML = `Cliente: IMLG=${cliente[0].x}, IMG=${cliente[0].y}, Tipología=${emoji} ${tipologia}`;

                let tooltipX = currentPointX - tooltip.offsetWidth / 2;
                let tooltipY = currentPointY - tooltip.offsetHeight - pointRadius - 5;

                if (tooltipX < 0) {
                    tooltipX = 0;
                }
                if (tooltipX + tooltip.offsetWidth > canvas.width) {
                    tooltipX = canvas.width - tooltip.offsetWidth;
                }
                if (tooltipY < 0) {
                    tooltipY = currentPointY + pointRadius + 5;
                }
                if (tooltipY + tooltip.offsetHeight > canvas.height) {
                    tooltipY = canvas.height - tooltip.offsetHeight;
                }

                tooltip.style.left = `${tooltipX}px`;
                tooltip.style.top = `${tooltipY}px`;
            } else {
                tooltip.style.display = 'none';
            }
        });

        canvas.addEventListener('mouseleave', () => {
            tooltip.style.display = 'none';
        });

        function RangesGet(sexo, actividad, edad) {
            if (edad < 18) {
                return null;
            }

            let Groupage;
            if (edad >= 18 && edad <= 29) {
                ageGroup = '18-29';
            } else if (edad >= 30 && edad <= 49) {
                ageGroup = '30-49';
            } else {
                ageGroup = '50+';
            }

            let imlgRanges, imgRanges, maxIMLG, maxIMG;

            if (sexo === 'femenino') {
                if (Groupage === '18-29') {
                    if (actividad === 'sedentario') {
                        imlgRanges = { bajo: 12.5, medio: 14.5, alto: 16.5 };
                        imgRanges = { bajo: 4, medio: 7, alto: 9 };
                        maxIMLG = 18.5;
                        maxIMG = 13;
                    } else if (actividad === 'pocoActivo') {
                        imlgRanges = { bajo: 13, medio: 15, alto: 17 };
                        imgRanges = { bajo: 3.5, medio: 6.5, alto: 8.5 };
                        maxIMLG = 19;
                        maxIMG = 12;
                    } else if (actividad === 'activo') {
                        imlgRanges = { bajo: 13.5, medio: 15.5, alto: 17.5 };
                        imgRanges = { bajo: 3, medio: 6, alto: 8 };
                        maxIMLG = 20;
                        maxIMG = 10;
                    } else {
                        imlgRanges = { bajo: 14, medio: 16, alto: 18.5 };
                        imgRanges = { bajo: 3, medio: 5, alto: 7 };
                        maxIMLG = 22;
                        maxIMG = 9;
                    }
                } else if (Groupage === '30-49') {
                    if (actividad === 'sedentario') {
                        imlgRanges = { bajo: 12, medio: 14, alto: 16 };
                        imgRanges = { bajo: 5, medio: 8, alto: 10 };
                        maxIMLG = 18;
                        maxIMG = 14.3;
                    } else if (actividad === 'pocoActivo') {
                        imlgRanges = { bajo: 12.5, medio: 14.5, alto: 16.5 };
                        imgRanges = { bajo: 4, medio: 7, alto: 9 };
                        maxIMLG = 18.5;
                        maxIMG = 13;
                    } else if (actividad === 'activo') {
                        imlgRanges = { bajo: 13, medio: 15, alto: 17 };
                        imgRanges = { bajo: 3.5, medio: 6.5, alto: 8.5 };
                        maxIMLG = 19;
                        maxIMG = 11;
                    } else {
                        imlgRanges = { bajo: 13.5, medio: 15.5, alto: 17.5 };
                        imgRanges = { bajo: 3, medio: 5.5, alto: 7.5 };
                        maxIMLG = 20;
                        maxIMG = 9.5;
                    }
                } else {
                    if (actividad === 'sedentario') {
                        imlgRanges = { bajo: 11.5, medio: 13.5, alto: 15.5 };
                        imgRanges = { bajo: 6, medio: 9, alto: 11 };
                        maxIMLG = 17.5;
                        maxIMG = 14.3;
                    } else if (actividad === 'pocoActivo') {
                        imlgRanges = { bajo: 12, medio: 14, alto: 16 };
                        imgRanges = { bajo: 5, medio: 8, alto: 10 };
                        maxIMLG = 18;
                        maxIMG = 13;
                    } else if (actividad === 'activo') {
                        imlgRanges = { bajo: 12.5, medio: 14.5, alto: 16.5 };
                        imgRanges = { bajo: 4, medio: 7, alto: 9 };
                        maxIMLG = 18.5;
                        maxIMG = 11;
                    } else {
                        imlgRanges = { bajo: 13, medio: 15, alto: 17 };
                        imgRanges = { bajo: 3.5, medio: 6, alto: 8 };
                        maxIMLG = 19;
                        maxIMG = 10;
                    }
                }
            } else {
                if (Groupage === '18-29') {
                    if (actividad === 'sedentario') {
                        imlgRanges = { bajo: 15, medio: 17, alto: 19 };
                        imgRanges = { bajo: 3, medio: 6, alto: 8 };
                        maxIMLG = 21;
                        maxIMG = 11;
                    } else if (actividad === 'pocoActivo') {
                        imlgRanges = { bajo: 15.5, medio: 17.5, alto: 19.5 };
                        imgRanges = { bajo: 2.5, medio: 5.5, alto: 7.5 };
                        maxIMLG = 21.5;
                        maxIMG = 10;
                    } else if (actividad === 'activo') {
                        imlgRanges = { bajo: 16, medio: 18, alto: 20 };
                        imgRanges = { bajo: 2, medio: 5, alto: 7 };
                        maxIMLG = 23;
                        maxIMG = 9;
                    } else {
                        imlgRanges = { bajo: 17, medio: 19, alto: 21.5 };
                        imgRanges = { bajo: 2, medio: 4, alto: 6 };
                        maxIMLG = 25;
                        maxIMG = 8;
                    }
                } else if (Groupage === '30-49') {
                    if (actividad === 'sedentario') {
                        imlgRanges = { bajo: 14.5, medio: 16.5, alto: 18.5 };
                        imgRanges = { bajo: 4, medio: 7, alto: 9 };
                        maxIMLG = 20.5;
                        maxIMG = 12;
                    } else if (actividad === 'pocoActivo') {
                        imlgRanges = { bajo: 15, medio: 17, alto: 19 };
                        imgRanges = { bajo: 3, medio: 6, alto: 8 };
                        maxIMLG = 21;
                        maxIMG = 11;
                    } else if (actividad === 'activo') {
                        imlgRanges = { bajo: 15.5, medio: 17.5, alto: 19.5 };
                        imgRanges = { bajo: 2.5, medio: 5.5, alto: 7.5 };
                        maxIMLG = 22;
                        maxIMG = 9.5;
                    } else {
                        imlgRanges = { bajo: 16, medio: 18, alto: 20 };
                        imgRanges = { bajo: 2, medio: 4.5, alto: 6.5 };
                        maxIMLG = 23;
                        maxIMG = 8.5;
                    }
                } else {
                    if (actividad === 'sedentario') {
                        imlgRanges = { bajo: 14, medio: 16, alto: 18 };
                        imgRanges = { bajo: 5, medio: 8, alto: 10 };
                        maxIMLG = 20;
                        maxIMG = 12;
                    } else if (actividad === 'pocoActivo') {
                        imlgRanges = { bajo: 14.5, medio: 16.5, alto: 18.5 };
                        imgRanges = { bajo: 4, medio: 7, alto: 9 };
                        maxIMLG = 20.5;
                        maxIMG = 11;
                    } else if (actividad === 'activo') {
                        imlgRanges = { bajo: 15, medio: 17, alto: 19 };
                        imgRanges = { bajo: 3, medio: 6, alto: 8 };
                        maxIMLG = 21;
                        maxIMG = 10;
                    } else {
                        imlgRanges = { bajo: 15.5, medio: 17.5, alto: 19.5 };
                        imgRanges = { bajo: 2.5, medio: 5, alto: 7 };
                        maxIMLG = 22;
                        maxIMG = 9;
                    }
                }
            }

            return { imlgRanges, imgRanges, maxIMLG, maxIMG };
        }
		//Validaciones
           function validateInputs(sexo, actividad, edad, imlg, img) {
	    const imlgWarning = document.getElementById('imlgWarning');
	    const imgWarning = document.getElementById('imgWarning');
	    imlgWarning.style.display = 'none';
	    imgWarning.style.display = 'none';
	
	    const ranges = RangesGet(sexo, actividad, edad);
	    if (!ranges) {
	        // Display a warning for invalid age, but allow processing
	        document.getElementById('edadWarning').textContent = 'Edad debe ser mayor o igual a 18';
	        document.getElementById('edadWarning').style.display = 'block';
	        return true; // Allow calculation to proceed
	    }
	    const { maxIMLG, maxIMG } = ranges;
	
	    // Check IMLG and display warnings if out of range
	    if (imlg < xMin) {
	        imlgWarning.textContent = `IMLG debe ser al menos ${xMin} kg/m²`;
	        imlgWarning.style.display = 'block';
	    } else if (imlg > maxIMLG) {
	        imlgWarning.textContent = `IMLG no puede exceder ${maxIMLG} kg/m² para ${sexo === 'mujer' ? 'mujeres' : 'hombres'} de ${edad >= 50 ? '50+' : (edad >= 30 ? '30-49' : '18-29')} años ${actividad}`;
	        imlgWarning.style.display = 'block';
	    }
	
	    // Check IMG and display warnings if out of range
	    if (img < yMin) {
	        imgWarning.textContent = `IMG debe ser al menos ${yMin} kg/m²`;
	        imgWarning.style.display = 'block';
	    } else if (img > maxIMG) {
	        imgWarning.textContent = `IMG no puede exceder ${maxIMG} kg/m² para ${sexo === 'mujer' ? 'mujeres' : 'hombres'} de ${edad >= 50 ? '50+' : (edad >= 30 ? '30-49' : '18-29')} años ${actividad}`;
	        imgWarning.style.display = 'block';
	    }
	
	    return true; // Always allow calculation to proceed
	}

        function detectarTipologia(cliente, sexo, actividad, edad) {
            if (!cliente || !cliente[0] || typeof cliente[0].x !== 'number' || typeof cliente[0].y !== 'number') {
                return { tipologia: 'Datos inválidos', closestTipologia: null };
            }
            if (edad < 18) {
                return { tipologia: 'Edad no válida (debe ser mayor o igual a 18)', closestTipologia: null };
            }
            let x = cliente[0].x;
            let y = cliente[0].y;
            let tipologia = '';
            let closestTipologia = null;

            const ranges = getRanges(sexo, actividad, edad);
            if (!ranges) {
                return { tipologia: 'Edad no válida (debe ser mayor o igual a 18)', closestTipologia: null };
            }
            let imlgRanges = ranges.imlgRanges;
            let imgRanges = ranges.imgRanges;
            let maxIMLG = ranges.maxIMLG;
            let maxIMG = ranges.maxIMG;

            let isOutOfRange = true;
            let adjustedX = x;
            let adjustedY = y;

            if (x < xMin || x > maxIMLG || y < yMin || y > maxIMG) {
                isOutOfRange = true;
                adjustedX = Math.max(xMin, Math.min(x, maxIMLG));
                adjustedY = Math.max(yMin, Math.min(y, maxIMG));
            }

            let xToUse = isOutOfRange ? adjustedX : x;
            let yToUse = isOutOfRange ? adjustedY : y;

            let imlgCategory = '';
            if (xToUse >= imlgRanges.bajo && xToUse < imlgRanges.medio) {
                imlgCategory = 'bajo';
            } else if (xToUse >= imlgRanges.medio && xToUse < imlgRanges.alto) {
                imlgCategory = 'medio';
            } else if (xToUse >= imlgRanges.alto && xToUse <= maxIMLG) {
                imlgCategory = 'alto';
            }

            let imgCategory = '';
            if (yToUse >= imgRanges.bajo && yToUse < imgRanges.medio) {
                imgCategory = 'bajo';
            } else if (yToUse >= imgRanges.medio && yToUse < imgRanges.alto) {
                imgCategory = 'medio';
            } else if (yToUse >= imgRanges.alto && yToUse <= maxIMG) {
                imgCategory = 'alto';
            }

            if (imlgCategory === 'bajo') {
                if (imgCategory === 'alto') tipologia = 'Obeso Sedentario';
                else if (imgCategory === 'medio') tipologia = 'Delgado Adiposo';
                else if (imgCategory === 'bajo') tipologia = 'Delgado';
            } else if (imlgCategory === 'medio') {
                if (imgCategory === 'alto') tipologia = 'Adiposo Sedentario';
                else if (imgCategory === 'medio') tipologia = 'Promedio';
                else if (imgCategory === 'bajo') tipologia = 'Esbelto Magro Atleta';
            } else if (imlgCategory === 'alto') {
                if (imgCategory === 'alto') tipologia = 'Obeso Sólido';
                else if (imgCategory === 'medio') tipologia = 'Atleta Promedio';
                else if (imgCategory === 'bajo') tipologia = 'Musculoso Atleta';
            }

            return { tipologia: tipologia || 'Fuera de rango', closestTipologia };
        }

        function updateChart() {
            const sexo = document.getElementById('sexoInput').value;
            const actividad = document.getElementById('actividadInput').value;
            const edad = parseInt(document.getElementById('edadInput').value);
            const imlg = parseFloat(document.getElementById('imlgInput').value);
            const img = parseFloat(document.getElementById('imgInput').value);

            cliente[0] = { x: imlg, y: img };

            const isValid = validateInputs(sexo, actividad, edad, imlg, img);
            if (!isValid) {
                drawGrid(sexo, actividad, edad);
                return;
            }

            drawGrid(sexo, actividad, edad);
            drawPoint(imlg, img, 'red');
        }

        function downloadChart() {
            const link = document.createElement('a');
            link.download = 'mapa_composicion_corporal.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // Initialize modal form fields with values from HTML, URL parameters, or defaults
	function populateFormFields() {
    const generoElement = document.getElementById('genero');
    const edadElement = document.getElementById('edad');
    const esDeportistaElement = document.getElementById('es_deportista');
    const imlgElement = document.getElementById('result-imlg-actual');
    const imgElement = document.getElementById('result-img-actual');
    const urlParams = new URLSearchParams(window.location.search);

    // Map genero to sexoInput values
    const genero = generoElement && generoElement.value ? 
        (generoElement.value === 'masculino' ? 'masculino' : generoElement.value === 'femenino' ? 'femenino' : 'mujer') : 
        (urlParams.get('sexo') === 'masculino' ? 'masculino' : 'femenino');

    // Map edad, ensuring it's at least 18
    const edadFromHtml = edadElement && edadElement.value ? parseFloat(edadElement.value) : NaN;
    const edadFromUrl = parseInt(urlParams.get('edad'));
    const edad = !isNaN(edadFromHtml) && edadFromHtml >= 18 ? edadFromHtml : 
        (!isNaN(edadFromUrl) && edadFromUrl >= 18 ? edadFromUrl : 30);

    // Map es_deportista to actividad levels
    const actividadFromHtml = esDeportistaElement && esDeportistaElement.value ? 
        (esDeportistaElement.value.toLowerCase() === 'sí' ? 'deportista' : 'sedentario') : null;
    const actividadFromUrl = urlParams.get('actividad');
    const actividad = actividadFromHtml ? actividadFromHtml : 
        (['sedentario', 'pocoActivo', 'activo', 'deportista'].includes(actividadFromUrl) ? actividadFromUrl : 'sedentario');

    // Get IMLG and IMG values, checking for '---' or invalid values
    const imlgFromHtml = imlgElement && imlgElement.textContent !== '---' ? parseFloat(imlgElement.textContent) : NaN;
    const imgFromHtml = imgElement && imgElement.textContent !== '---' ? parseFloat(imgElement.textContent) : NaN;
    const imlgFromUrl = parseFloat(urlParams.get('imlg'));
    const imgFromUrl = parseFloat(urlParams.get('img'));
    const imlg = !isNaN(imlgFromHtml) ? imlgFromHtml : (!isNaN(imlgFromUrl) ? imlgFromUrl : 17.0);
    const img = !isNaN(imgFromHtml) ? imgFromHtml : (!isNaN(imgFromUrl) ? imgFromUrl : 11.1);

    // Set form field values
    document.getElementById('sexoInput').value = genero;
    document.getElementById('edadInput').value = edad;
    document.getElementById('actividadInput').value = actividad;
    document.getElementById('imlgInput').value = imlg;
    document.getElementById('imgInput').value = img;

    // Update cliente array for chart rendering
    cliente[0] = { x: imlg, y: img };
}

       // Modal event listener for opening
	const button = document.getElementById('abrirContainerTipologia');
	button.addEventListener('click', function(e) {
	    e.stopPropagation();
	    e.preventDefault();
	    const modal = document.getElementById('modalContainer');
	    modal.style.display = 'flex';
		 setTimeout(() => {
	            modal.style.opacity = '1';
	            modal.style.transition = 'opacity 0.3s ease-in-out';
	        }, 10);
	    populateFormFields(); // Populate form fields when modal opens
	    createLegend();
	    updateChart();
	});
	
	
	       

        document.getElementById('closeModal').addEventListener('click', function(e) {
            e.stopPropagation();
            e.preventDefault();
            document.getElementById('modalContainer').style.display = 'none';
        });

        document.getElementById('modalContainer').addEventListener('click', function(e) {
            if (e.target === this) {
                e.stopPropagation();
                e.preventDefault();
                this.style.display = 'none';
            }
        });

       document.getElementById('updateButton').addEventListener('click', function(e) {
	    e.stopPropagation();
	    e.preventDefault();
	    updateChart();
	});

	document.getElementById('downloadButton').addEventListener('click', function(e) {
	    e.stopPropagation();
	    e.preventDefault();
	    downloadChart();
	});
	



//Abrir Container y grafico Somatocarta

document.addEventListener('DOMContentLoaded', () => {
    const buttonsoma = document.getElementById('abrirContainerSomatotipo');
    const modalsoma = document.getElementById('modalSomaContainer');
    const closeSpan = document.querySelector('.close-soma-modal');
    const closeButton = document.querySelector('.closesomaModal');
    let retryCountPopulate = 0;
    const MAX_RETRIES = 10;
    const RETRY_INTERVAL = 1000;

    // Modal event listener for opening
    if (buttonsoma) {
        buttonsoma.addEventListener('click', function(e) {
            e.stopPropagation();
            e.preventDefault();

            if (!modalsoma) {
                console.error('Modal container with ID "modalSomaContainer" not found.');
                return;
            }

            modalsoma.style.display = 'flex';
            setTimeout(() => {
                modalsoma.style.opacity = '1';
                modalsoma.style.transition = 'opacity 0.3s ease-in-out';
            }, 10);

            console.log('Abriendo:', new Date().toISOString(), {
                modalSomaContainer: !!modalsoma,
                somatotipoContainer: !!document.getElementById('somatotipo-container'),
                modalContent: modalsoma.innerHTML.substring(0, 100) + '...'
            });

            retryCountPopulate = 0;
            setTimeout(() => {
                if (modalsoma.querySelector('#nombreInput')) {
                    populateFields();
                } else {
                    console.warn('Fields not found initially. Relying on MutationObserver or retries.');
                }
            }, 100);
        });
    } else {
        console.error('Button with ID "abrirContainerSomatotipo" not found.');
    }

    // Function to close the modal
    function closeSomaModal() {
        if (!modalsoma) {
            console.error('Modal container with ID "modalSomaContainer" not found.');
            return;
        }

        modalsoma.style.opacity = '0';
        setTimeout(() => {
            modalsoma.style.display = 'none';
        }, 300);
    }

    // Function to populate fields
    function populateFields() {
        const modalContainer = document.getElementById('modalSomaContainer');
        const generoSelect = modalContainer.querySelector('#nombreInput');
        const endoInput = modalContainer.querySelector('#endoInput');
        const mesoInput = modalContainer.querySelector('#mesoInput');
        const ectoInput = modalContainer.querySelector('#ectoInput');
        const deporteSelect = modalContainer.querySelector('#deporteInput');
        const modalidadSelect = modalContainer.querySelector('#modalidadInput');

        const generoMap = {
            'masculino': 'masculino',
            'femenino': 'femenino'
        };

        const defaultValues = {
            genero: 'masculino',
            endomorfia: 1.0,
            mesomorfia: 1.0,
            ectomorfia: 1.0,
            grupoReferencia: 'N/A',
            modalidad: 'N/A'
        };

        let generoValue = '';
        const sourceGenero = document.getElementById('genero');
        if (sourceGenero && sourceGenero.value in generoMap) {
            generoValue = generoMap[sourceGenero.value];
        }

        let somatotipoValues = { endomorfia: null, mesomorfia: null, ectomorfia: null };
        const resultSomatotipo = document.getElementById('result-somatotipo');
        if (resultSomatotipo && resultSomatotipo.textContent !== '---') {
            const text = resultSomatotipo.textContent;
            const match = text.match(/\s*([\d.]+)\s*:\s*([\d.]+)\s*:\s*([\d.]+)/);
            if (match) {
                somatotipoValues = {
                    endomorfia: parseFloat(match[1]),
                    mesomorfia: parseFloat(match[2]),
                    ectomorfia: parseFloat(match[3])
                };
                console.log('somatotipoValues:', somatotipoValues);
            }
        }

        if (!generoSelect.value) {
            generoSelect.value = generoValue || defaultValues.genero;
        }

        function setSomatotipoValue(input, somatotipoValue, defaultValue) {
            const numericValue = parseFloat(input.value);
            const shouldUseDefault = (
                !input.value ||
                input.value == 1 ||
                input.value == "1" ||
                isNaN(numericValue) ||
                (somatotipoValue !== null &&
                 !isNaN(somatotipoValue) &&
                 numericValue !== somatotipoValue)
            );

            if (shouldUseDefault) {
                input.value = (somatotipoValue !== null && !isNaN(somatotipoValue))
                    ? somatotipoValue.toFixed(1)
                    : defaultValue.toFixed(1);
            }
        }

        setSomatotipoValue(endoInput, somatotipoValues.endomorfia, defaultValues.endomorfia);
        setSomatotipoValue(mesoInput, somatotipoValues.mesomorfia, defaultValues.mesomorfia);
        setSomatotipoValue(ectoInput, somatotipoValues.ectomorfia, defaultValues.ectomorfia);

        if (!deporteSelect.value) {
            deporteSelect.value = defaultValues.grupoReferencia;
        }
        if (!modalidadSelect.value) {
            modalidadSelect.value = defaultValues.modalidad;
        }

        console.log('Campos rellenados:', {
            genero: generoSelect.value,
            endomorfia: endoInput.value,
            mesomorfia: mesoInput.value,
            ectomorfia: ectoInput.value,
            grupoReferencia: deporteSelect.value,
            modalidad: modalidadSelect.value
        });

        drawSomaChart(somatotipoValues);
    }

    // Function to draw somatotipo chart
    function drawSomaChart(initialData, updatedData = null) {
        const Somatotypecanvas = document.getElementById('somatotype-point-canvas2');
        const imgSomatotype = document.getElementById('somatotype-image');

        if (!Somatotypecanvas || !imgSomatotype) {
            console.error('Canvas #somatotype-point-canvas2 o imagen #somatotype-image no encontrado');
            return;
        }

        const container = document.querySelector('.chart-container');
        if (!container) {
            console.error('Chart container (.chart-container) not found');
            return;
        }

        let displayedWidth = container.clientWidth;
        let displayedHeight = container.clientHeight;

        if (displayedWidth === 0 || displayedHeight === 0) {
            console.warn('Container has zero dimensions, using fallback size (500x500px)');
            displayedWidth = 500;
            displayedHeight = 500;
        }

        Somatotypecanvas.width = displayedWidth;
        Somatotypecanvas.height = displayedHeight;

        const ctxSoma = Somatotypecanvas.getContext('2d');
        ctxSoma.clearRect(0, 0, Somatotypecanvas.width, Somatotypecanvas.height);

        const chartWidth = displayedWidth * 0.8;
        const chartHeight = displayedHeight * 0.8;
        const chartOffsetX = (displayedWidth - chartWidth) / 2;
        const chartOffsetY = (displayedHeight - chartHeight) / 2;

        const centerX = chartOffsetX + chartWidth / 2;
        const centerY = chartOffsetY + chartHeight / 2;
        const xAxisY = chartOffsetY + chartHeight;

        console.log(`Container Dimensions: width=${displayedWidth}, height=${displayedHeight}`);
        console.log(`Chart Area: offsetX=${chartOffsetX}, offsetY=${chartOffsetY}, width=${chartWidth}, height=${chartHeight}`);

        // Draw X-axis
        ctxSoma.beginPath();
        ctxSoma.moveTo(chartOffsetX, xAxisY);
        ctxSoma.lineTo(chartOffsetX + chartWidth, xAxisY);
        ctxSoma.strokeStyle = '#000000';
        ctxSoma.lineWidth = 1; // Reduced from 2 to make axis finer
        ctxSoma.stroke();

        ctxSoma.font = '10px Inter, sans-serif'; // Reduced from 16px for finer appearance
        ctxSoma.fillStyle = '#000000';
        ctxSoma.textAlign = 'center';
        for (let i = -8; i <= 8; i += 2) {
            const xPos = chartOffsetX + ((i + 8) / 16) * chartWidth;
            ctxSoma.beginPath();
            ctxSoma.moveTo(xPos, xAxisY - 4); // Reduced tick size from 5 to 4
            ctxSoma.lineTo(xPos, xAxisY + 4);
            ctxSoma.lineWidth = 0.5; // Reduced from implicit 2 to make graduations finer
            ctxSoma.stroke();
            ctxSoma.fillText(i.toString(), xPos, xAxisY + 18); // Adjusted position slightly
        }
        ctxSoma.font = '14px Roboto, sans-serif'; // Reduced from 20px for finer axis label
        ctxSoma.fillText('Endomorfia - Ectomorfia', chartOffsetX + chartWidth / 2, xAxisY + 28);

        // Draw Y-axis
        const yAxisX = chartOffsetX + chartWidth;
        ctxSoma.beginPath();
        ctxSoma.moveTo(yAxisX, xAxisY);
        ctxSoma.lineTo(yAxisX, chartOffsetY);
        ctxSoma.strokeStyle = '#000000';
        ctxSoma.lineWidth = 1; // Reduced from 2 to make axis finer
        ctxSoma.stroke();

        ctxSoma.font = '10px Inter, sans-serif'; // Reduced from 16px for finer appearance
        ctxSoma.fillStyle = '#000000';
        ctxSoma.textAlign = 'center';
        for (let i = -10; i <= 12; i += 2) {
            const yPos = centerY - (i / 22) * ((centerY - chartOffsetY) + (xAxisY - centerY));
            ctxSoma.beginPath();
            ctxSoma.moveTo(yAxisX - 4, yPos); // Reduced tick size from 5 to 4
            ctxSoma.lineTo(yAxisX + 4, yPos);
            ctxSoma.lineWidth = 0.5; // Reduced from implicit 2 to make graduations finer
            ctxSoma.stroke();
            ctxSoma.fillText(i.toString(), yAxisX + 18, yPos + 5); // Adjusted position slightly
        }

        ctxSoma.save();
        ctxSoma.translate(chartOffsetX + ((7 + 8) / 16) * chartWidth, chartOffsetY + chartHeight / 2);
        ctxSoma.rotate(-Math.PI / 2);
        ctxSoma.font = '14px Roboto, sans-serif'; // Reduced from 20px for finer axis label
        ctxSoma.textAlign = 'center';
        ctxSoma.fillText('Mesomorfia', 0, 0);
        ctxSoma.restore();

        // Draw blue point (initial data)
        if (initialData) {
            const x = initialData.ectomorfia - initialData.endomorfia;
            const y = 2 * initialData.mesomorfia - (initialData.endomorfia + initialData.ectomorfia);
            const xClamped = Math.min(Math.max(x, -8), 8);
            const yClamped = Math.min(Math.max(y, -10), 12);

            const pixelX = chartOffsetX + ((xClamped + 8) / 16) * chartWidth;
            const pixelY = centerY - (yClamped / 22) * ((centerY - chartOffsetY) + (xAxisY - centerY));

            console.log(`Blue Point Coordinates: pixelX=${pixelX}, pixelY=${pixelY}`);

            ctxSoma.beginPath();
            ctxSoma.arc(pixelX, pixelY, 6, 0, 2 * Math.PI);
            ctxSoma.fillStyle = '#0056b3';
            ctxSoma.fill();
            ctxSoma.strokeStyle = '#003087';
            ctxSoma.lineWidth = 2;
            ctxSoma.stroke();

            ctxSoma.font = 'bold 10px Arial, sans-serif';
            ctxSoma.fillStyle = '#000000';
            ctxSoma.strokeStyle = '#ffffff';
            ctxSoma.lineWidth = 2;
            ctxSoma.textAlign = 'center';
            ctxSoma.strokeText(
                `${initialData.endomorfia.toFixed(1)}-${initialData.mesomorfia.toFixed(1)}-${initialData.ectomorfia.toFixed(1)}`,
                pixelX,
                pixelY - 15
            );
            ctxSoma.fillText(
                `${initialData.endomorfia.toFixed(1)}-${initialData.mesomorfia.toFixed(1)}-${initialData.ectomorfia.toFixed(1)}`,
                pixelX,
                pixelY - 15
            );
        }

        // Draw red point (updated data)
        if (updatedData) {
            const x = updatedData.ectomorfia - updatedData.endomorfia;
            const y = 2 * updatedData.mesomorfia - (updatedData.endomorfia + updatedData.ectomorfia);
            const xClamped = Math.min(Math.max(x, -8), 8);
            const yClamped = Math.min(Math.max(y, -10), 12);

            const pixelX = chartOffsetX + ((xClamped + 8) / 16) * chartWidth;
            const pixelY = centerY - (yClamped / 22) * ((centerY - chartOffsetY) + (xAxisY - centerY));

            console.log(`Red Point Coordinates: pixelX=${pixelX}, pixelY=${pixelY}`);

            ctxSoma.beginPath();
            ctxSoma.arc(pixelX, pixelY, 6, 0, 2 * Math.PI);
            ctxSoma.fillStyle = '#FF0000';
            ctxSoma.fill();
            ctxSoma.strokeStyle = '#8B0000';
            ctxSoma.lineWidth = 2;
            ctxSoma.stroke();

            ctxSoma.font = 'bold 10px Arial, sans-serif';
            ctxSoma.fillStyle = '#000000';
            ctxSoma.strokeStyle = '#ffffff';
            ctxSoma.lineWidth = 2;
            ctxSoma.textAlign = 'center';
            ctxSoma.strokeText(
                `${updatedData.endomorfia.toFixed(1)}-${updatedData.mesomorfia.toFixed(1)}-${updatedData.ectomorfia.toFixed(1)}`,
                pixelX,
                pixelY + 25
            );
            ctxSoma.fillText(
                `${updatedData.endomorfia.toFixed(1)}-${updatedData.mesomorfia.toFixed(1)}-${updatedData.ectomorfia.toFixed(1)}`,
                pixelX,
                pixelY + 25
            );
        }
    }

    // Attempt to draw chart with retries
    function attemptDrawChart(initialData, attempts = 0, maxAttempts = 20) {
        const container = document.querySelector('.chart-container');
        if (!container) {
            console.error('Chart container (.chart-container) not found');
            return;
        }

        console.log('Attempt', attempts, 'Container state:', {
            display: window.getComputedStyle(container).display,
            visibility: window.getComputedStyle(container).visibility,
            width: container.clientWidth,
            height: container.clientHeight,
            modalDisplay: window.getComputedStyle(modalsoma).display
        });

        if (container.clientWidth > 0 && container.clientHeight > 0 && window.getComputedStyle(modalsoma).display !== 'none') {
            const imgSomatotype = document.getElementById('somatotype-image');
            if (imgSomatotype.complete && imgSomatotype.naturalWidth > 0) {
                drawSomaChart(initialData);
            } else {
                imgSomatotype.onload = () => drawSomaChart(initialData);
                imgSomatotype.onerror = () => {
                    console.error('Error al cargar la imagen #somatotype-image');
                };
            }
        } else if (attempts < maxAttempts) {
            setTimeout(() => attemptDrawChart(initialData, attempts + 1, maxAttempts), 100);
        } else {
            console.error('Max attempts reached, unable to draw chart due to zero container dimensions');
            drawSomaChart(initialData);
        }
    }

    // MutationObserver to detect modal visibility
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'style') {
                const display = window.getComputedStyle(modalsoma).display;
                if (display === 'flex') {
                    console.log('Modal is now visible, attempting to draw chart');
                    const resultSomatotipo = document.getElementById('result-somatotipo');
                    let initialData = null;
                    if (resultSomatotipo && resultSomatotipo.textContent !== '---') {
                        const text = resultSomatotipo.textContent;
                        const match = text.match(/\s*([\d.]+)\s*:\s*([\d.]+)\s*:\s*([\d.]+)/);
                        if (match) {
                            initialData = {
                                endomorfia: parseFloat(match[1]),
                                mesomorfia: parseFloat(match[2]),
                                ectomorfia: parseFloat(match[3])
                            };
                        }
                    }
                    attemptDrawChart(initialData);
                    observer.disconnect();
                }
            }
        });
    });

    observer.observe(modalsoma, { attributes: true });

    if (window.getComputedStyle(modalsoma).display === 'flex') {
        const resultSomatotipo = document.getElementById('result-somatotipo');
        let initialData = null;
        if (resultSomatotipo && resultSomatotipo.textContent !== '---') {
            const text = resultSomatotipo.textContent;
            const match = text.match(/\s*([\d.]+)\s*:\s*([\d.]+)\s*:\s*([\d.]+)/);
            if (match) {
                initialData = {
                    endomorfia: parseFloat(match[1]),
                    mesomorfia: parseFloat(match[2]),
                    ectomorfia: parseFloat(match[3])
                };
            }
        }
        attemptDrawChart(initialData);
    }

    // Function to handle "Calcular" button click
    function handleCalcularSubmit(e) {
        e.stopPropagation();
        e.preventDefault();

        const modalContainer = document.getElementById('modalSomaContainer');
        const generoSelect = modalContainer.querySelector('#nombreInput');
        const endoInput = modalContainer.querySelector('#somatotipoEndo');
        const mesoInput = modalContainer.querySelector('#somatotipoMeso');
        const ectoInput = modalContainer.querySelector('#somatotipoEcto');
        const deporteSelect = modalContainer.querySelector('#deporteInput');
        const modalidadSelect = modalContainer.querySelector('#modalidadInput');

        let isValid = true;
        const errors = [];

        if (!generoSelect.value) {
            isValid = false;
            errors.push('El campo género es requerido.');
            generoSelect.classList.add('invalid');
        } else {
            generoSelect.classList.remove('invalid');
        }
        if (!endoInput.value || isNaN(endoInput.value) || endoInput.value < 0) {
            isValid = false;
            errors.push('El campo endomorfia es inválido.');
            endoInput.classList.add('invalid');
        } else {
            endoInput.classList.remove('invalid');
        }
        if (!mesoInput.value || isNaN(mesoInput.value) || mesoInput.value < 0) {
            isValid = false;
            errors.push('El campo mesomorfia es inválido.');
            mesoInput.classList.add('invalid');
        } else {
            mesoInput.classList.remove('invalid');
        }
        if (!ectoInput.value || isNaN(ectoInput.value) || ectoInput.value < 0) {
            isValid = false;
            errors.push('El campo ectomorfia es inválido.');
            ectoInput.classList.add('invalid');
        } else {
            ectoInput.classList.remove('invalid');
        }
        if (!deporteSelect.value) {
            isValid = false;
            errors.push('El campo grupo de referencia es requerido.');
            deporteSelect.classList.add('invalid');
        } else {
            deporteSelect.classList.remove('invalid');
        }

        if (!isValid) {
            console.error('Errores de validación:', errors);
            alert('Por favor, corrige los campos inválidos.');
            return;
        }

        const updatedData = {
            genero: generoSelect.value,
            endomorfia: parseFloat(endoInput.value),
            mesomorfia: parseFloat(mesoInput.value),
            ectomorfia: parseFloat(ectoInput.value),
            grupoReferencia: deporteSelect.value,
            modalidad: modalidadSelect.value || 'N/A'
        };

        console.log('Datos procesados:', updatedData);

        const resultSomatotipo = document.getElementById('result-somatotipo');
        let initialData = null;
        if (resultSomatotipo && resultSomatotipo.textContent !== '---') {
            const text = resultSomatotipo.textContent;
            const match = text.match(/\s*([\d.]+)\s*:\s*([\d.]+)\s*:\s*([\d.]+)/);
            if (match) {
                initialData = {
                    endomorfia: parseFloat(match[1]),
                    mesomorfia: parseFloat(match[2]),
                    ectomorfia: parseFloat(match[3])
                };
            }
        }

        drawSomaChart(initialData, updatedData);
    }

    // Set up "Calcular" button listener
    const calcularButton = document.querySelector('#calcularButton');
    if (calcularButton) {
        calcularButton.removeEventListener('click', handleCalcularSubmit);
        calcularButton.addEventListener('click', handleCalcularSubmit);
    } else {
        console.error('Calcular button with ID "calcularButton" not found.');
    }

    // Helper function to determine dominant component
    function getDominante(data) {
        const { endomorfia, mesomorfia, ectomorfia } = data;
        const max = Math.max(endomorfia, mesomorfia, ectomorfia);
        if (max === endomorfia) return 'Endomorfia';
        if (max === mesomorfia) return 'Mesomorfia';
        return 'Ectomorfia';
    }

    // Helper function to calculate X coordinate
    function calculateX(data) {
        return data.ectomorfia - data.endomorfia;
    }

    // Helper function to calculate Y coordinate
    function calculateY(data) {
        return 2 * data.mesomorfia - (data.endomorfia + data.ectomorfia);
    }




    // Set up close button (×)
    if (closeSpan) {
        closeSpan.removeEventListener('click', closeSomaModal);
        closeSpan.addEventListener('click', (e) => {
            e.stopPropagation();
            closeSomaModal();
        });
    } else {
        console.error('Close span with class "close-soma-modal" not found.');
    }

    // Set up close button (Cerrar)
    if (closeButton) {
        closeButton.removeEventListener('click', closeSomaModal);
        closeButton.addEventListener('click', (e) => {
            e.stopPropagation();
            closeSomaModal();
        });
    } else {
        console.error('Close button with class "closesomaModal" not found.');
    }

    // Close modal on click outside content
    modalsoma?.addEventListener('click', (e) => {
        if (e.target === modalsoma) {
            closeSomaModal();
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modalsoma?.style.display === 'flex') {
            closeSomaModal();
        }
    });


    

   

    // Debugging: Log DOM state
    console.log('DOM loaded:', new Date().toISOString(), {
        modalsoma: !!modalsoma,
        somatotipoContainer: !!document.getElementById('somatotipo-container')
    });

    // Manual trigger for dynamic content
    window.populateSomaForm = function () {
        console.log('Manual trigger for populateFields:', new Date().toISOString());
        retryCountPopulate = 0;
        populateFields();
    };
});
	document.addEventListener('DOMContentLoaded', () => {
    const deporteInput = document.getElementById('deporteInput');
    const modalidadInput = document.getElementById('modalidadInput');
    const nombreInput = document.getElementById('nombreInput');
    const somatotipoEndo = document.getElementById('somatotipoEndo');
    const somatotipoMeso = document.getElementById('somatotipoMeso');
    const somatotipoEcto = document.getElementById('somatotipoEcto');
    const somatotipoDominante = document.getElementById('somatotipoDominante');
    const somatotipoX = document.getElementById('somatotipoX');
    const somatotipoY = document.getElementById('somatotipoY');

    // Verificar qué elementos no se encontraron
    const missingElements = [];
    if (!deporteInput) missingElements.push('deporteInput');
    if (!modalidadInput) missingElements.push('modalidadInput');
    if (!nombreInput) missingElements.push('nombreInput');
    if (!somatotipoEndo) missingElements.push('somatotipoEndo');
    if (!somatotipoMeso) missingElements.push('somatotipoMeso');
    if (!somatotipoEcto) missingElements.push('somatotipoEcto');
    if (!somatotipoDominante) missingElements.push('somatotipoDominante');
    if (!somatotipoX) missingElements.push('somatotipoX');
    if (!somatotipoY) missingElements.push('somatotipoY');

    if (missingElements.length > 0) {
        console.error(`Los siguientes elementos no se encontraron en el DOM: ${missingElements.join(', ')}`);
        return;
    }

    // Lista de modalidades deportivas
    const deportesModalidades = [
    "Aerobic",
    "Atletismo: 100m lisos",
    "Atletismo: 1500m",
    "Atletismo: 400m vallas",
    "Atletismo: Altura",
    "Atletismo: Fondo",
    "Atletismo: Lanz. Jabalina",
    "Atletismo: Lanzamientos",
    "Atletismo: Marcha",
    "Atletismo: Marcha 20km",
    "Atletismo: Maratón",
    "Atletismo: Pértiga",
    "Atletismo: Salto de altura",
    "Ba	dminton",
    "Bádminton: Dobles",
    "Baloncesto",
    "Baloncesto: Aleros",
    "Balonmano",
    "Béisbol: Lanzadores",
    "Billar",
    "Bolos",
    "Boxeo: Peso pesado",
    "Boxeo: <56kg",
    "Boxeo: <64kg",
    "Boxeo: <75kg",
    "Boxeo: <91kg",
    "Ciclismo: BMX",
    "Ciclismo: Carretera",
    "Ciclismo: Montaña",
    "Ciclismo: Pista - Velocidad",
    "Ciclismo: Ruta",
    "CrossFit",
    "Curling",
    "Danza Clásica",
    "Escalada Deportiva",
    "Esgrima",
    "Esquí Alpino",
    "Frontenis",
    "Fútbol: Campo",
    "Fútbol: Porteros",
    "Fútbol: <18",
    "Fútbol: >18",
    "Gimnasia Artística",
    "Gimnasia Artística: Masculina",
    "Gimnasia Rítmica",
    "Gimnasia Trampolín",
    "Golf",
    "Halterofilia",
    "Hípica: Salto",
    "Hockey Hierba",
    "Judo: -90 kg",
    "Judo: <58kg",
    "Judo: >80kg",
    "Judo: 58-72kg",
    "Judo: 72-80kg",
    "Karate: Kumite",
    "Lanzamiento de Peso",
    "Lucha: Grecorromana",
    "Lucha: <58kg",
    "Lucha: >80kg",
    "Lucha: 58-72kg",
    "Lucha: 72-80kg",
    "Natación: 1500m Libre",
    "Natación: Carreras <16",
    "Natación: Carreras >16",
    "Natación: Sincronizada",
    "Pádel",
    "Parkour",
    "Patinaje Artístico",
    "Patinaje: Velocidad",
    "Pesca Deportiva",
    "Petanca",
    "Pilates",
    "Piragüismo: Aguas Tranquilas",
    "Piragüismo: Slalom",
    "Polo Acuático",
    "Waterpolo: Arco Abs",
    "Waterpolo: Arco Jr",
    "Waterpolo: Fuerza Abs",
    "Waterpolo: Fuerza Jr",
    "Waterpolo: Porteros Abs",
    "Waterpolo: Porteros Jr",
    "Remo: Ligeros",
    "Remo: Pesados",
    "Remo: Skiff",
    "Rugby: Delanteros",
    "Senderismo: Alta Montaña",
    "Squash",
    "Surf: Competición",
    "Taekwondo",
    "Taekwondo: <49kg",
    "Taekwondo: <57kg",
    "Taekwondo: <58kg",
    "Taekwondo: <67kg",
    "Taekwondo: <68kg",
    "Taekwondo: <80kg",
    "Taekwondo: >67kg",
    "Taekwondo: >80kg",
    "Tai Chi",
    "Tenis",
    "Tenis: <16",
    "Tenis: >16",
    "Tenis de Mesa",
    "Tiro con Arco",
    "Triatlón",
    "Triatlón: Larga Distancia",
    "Vela: Laser",
    "Voleibol",
    "Voleibol: Centrales",
    "Yoga: Hatha"
];
// Tabla de datos de somatotipos
const somatotipoData = [
    { deporte: "aerobic", sexo: "H", endo: 3, meso: 3.2, ecto: 4, dominante: "Ecto", x: 1, y: -0.6, endo_f: 3.2, meso_f: 2.6, ecto_f: 4.3, x_f: 1.1, y_f: -2.3 },
    { deporte: "atletismo_100m_lisos", sexo: "H", endo: 2.2, meso: 5.8, ecto: 3.8, dominante: "Meso", x: 1.6, y: 5.6, endo_f: 2.5, meso_f: 5, ecto_f: 4, x_f: 1.5, y_f: 3.5 },
    { deporte: "atletismo_1500m", sexo: "H", endo: 1.9, meso: 3.5, ecto: 5.8, dominante: "Ecto", x: 3.9, y: -0.7, endo_f: 2.1, meso_f: 2.9, ecto_f: 6, x_f: 3.9, y_f: -2.3 },
    { deporte: "atletismo_400m_vallas", sexo: "H", endo: 2.3, meso: 4.4, ecto: 4.5, dominante: "Ecto", x: 2.2, y: 2, endo_f: 2.6, meso_f: 3.8, ecto_f: 4.8, x_f: 2.2, y_f: 0.2 },
    { deporte: "atletismo_altura", sexo: "H", endo: 1.6, meso: 3.5, ecto: 0.9, dominante: "", x: 2.6, y: 0.8, endo_f: 2.5, meso_f: 2, ecto_f: 4.4, x_f: -2.4, y_f: -1.9 },
    { deporte: "atletismo_fondo", sexo: "H", endo: 1.7, meso: 3.6, ecto: 3.6, dominante: "", x: 0, y: -3.8, endo_f: 2.4, meso_f: 2.4, ecto_f: 3.9, x_f: -1.5, y_f: -1.5 },
    { deporte: "atletismo_lanz_jabalina", sexo: "H", endo: 2.5, meso: 5, ecto: 3.8, dominante: "Meso", x: 1.3, y: 3.7, endo_f: 2.8, meso_f: 4.3, ecto_f: 3.5, x_f: 0.7, y_f: 2.3 },
    { deporte: "atletismo_lanzamientos", sexo: "H", endo: 3.6, meso: 6.1, ecto: 1.1, dominante: "", x: 5, y: -3.6, endo_f: 4.3, meso_f: 4.1, ecto_f: 1.6, x_f: 2.5, y_f: 2.9 },
    { deporte: "atletismo_marcha", sexo: "H", endo: 1.7, meso: 3.9, ecto: 3.5, dominante: "", x: 0.4, y: -1.5, endo_f: 3.2, meso_f: 2.6, ecto_f: 3.3, x_f: -0.7, y_f: 0.1 },
    { deporte: "atletismo_marcha_20km", sexo: "H", endo: 2, meso: 3, ecto: 5.5, dominante: "Ecto", x: 3.5, y: -1.5, endo_f: 2.2, meso_f: 2.4, ecto_f: 5.8, x_f: 3.6, y_f: -3.2 },
    { deporte: "atletismo_maratón", sexo: "H", endo: 1.8, meso: 2.9, ecto: 6, dominante: "Ecto", x: 4.2, y: -2, endo_f: 2, meso_f: 2.3, ecto_f: 6.2, x_f: 4.2, y_f: -3.6 },
    { deporte: "atletismo_pértiga", sexo: "H", endo: 1.6, meso: 4.7, ecto: 3, dominante: "", x: 1.7, y: -1.5, endo_f: 2.9, meso_f: 3.1, ecto_f: 3.2, x_f: -0.1, y_f: 0.5 },
    { deporte: "atletismo_salto_de_altura", sexo: "H", endo: 2, meso: 4.2, ecto: 4.8, dominante: "Ecto", x: 2.8, y: 1.6, endo_f: 2.2, meso_f: 3.6, ecto_f: 5.2, x_f: 3, y_f: -0.2 },
    { deporte: "atletismo_vel_vallas", sexo: "H", endo: 1.7, meso: 4.8, ecto: 0.9, dominante: "", x: 3.9, y: 0.9, endo_f: 2.6, meso_f: 3.1, ecto_f: 3, x_f: 0.1, y_f: 1.1 },
    { deporte: "badminton", sexo: "H", endo: 2.5, meso: 3.5, ecto: 4.5, dominante: "Ecto", x: 2, y: 0, endo_f: 2.8, meso_f: 2.9, ecto_f: 4.8, x_f: 2, y_f: -1.8 },
    { deporte: "bádminton_dobles", sexo: "H", endo: 3, meso: 3.5, ecto: 4.2, dominante: "Ecto", x: 1.2, y: -0.2, endo_f: 3.3, meso_f: 2.9, ecto_f: 4.5, x_f: 1.2, y_f: -2 },
    { deporte: "baloncesto", sexo: "H", endo: 2.5, meso: 3.5, ecto: 3.6, dominante: "", x: -0.1, y: 1, endo_f: 4, meso_f: 2.7, ecto_f: 2.9, x_f: -0.2, y_f: -1.5 },
    { deporte: "baloncesto_aleros", sexo: "H", endo: 2.5, meso: 4.3, ecto: 4.6, dominante: "Ecto", x: 2.1, y: 1.5, endo_f: 2.8, meso_f: 3.7, ecto_f: 4.9, x_f: 2.1, y_f: -0.3 },
    { deporte: "balonmano", sexo: "H", endo: 3, meso: 5.3, ecto: 3.2, dominante: "Meso", x: 0.2, y: 4.4, endo_f: 3.5, meso_f: 4.7, ecto_f: 3, x_f: -0.5, y_f: 2.9 },
    { deporte: "balonmano", sexo: "H", endo: 2.8, meso: 4.9, ecto: 2.2, dominante: "", x: 2.7, y: -0.6, endo_f: 3.8, meso_f: 3.5, ecto_f: 2.4, x_f: 1.1, y_f: 0.9 },
    { deporte: "béisbol_lanzadores", sexo: "H", endo: 3, meso: 4.8, ecto: 3.5, dominante: "Meso", x: 0.5, y: 3.1, endo_f: 3.4, meso_f: 4.2, ecto_f: 3.2, x_f: -0.2, y_f: 1.8 },
    { deporte: "billar", sexo: "H", endo: 4.2, meso: 2.3, ecto: 3, dominante: "Endo", x: -1.2, y: -2.6, endo_f: 4.5, meso_f: 1.8, ecto_f: 2.7, x_f: -1.8, y_f: -3.6 },
    { deporte: "bolos", sexo: "H", endo: 4.5, meso: 2.5, ecto: 3, dominante: "Endo", x: -1.5, y: -2.5, endo_f: 4.8, meso_f: 2, ecto_f: 2.8, x_f: -2, y_f: -3.6 },
    { deporte: "boxeo_menos_56kg", sexo: "H", endo: 2.2, meso: 4.5, ecto: 2.7, dominante: "", x: 1.8, y: 0.5, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "boxeo_menos_64kg", sexo: "H", endo: 2.2, meso: 4.9, ecto: 2.7, dominante: "", x: 2.2, y: 0.5, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "boxeo_menos_75kg", sexo: "H", endo: 2.1, meso: 4.7, ecto: 2.8, dominante: "", x: 1.9, y: 0.6, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "boxeo_menos_91kg", sexo: "H", endo: 3.2, meso: 5.7, ecto: 1.4, dominante: "", x: 4.3, y: -1.8, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "boxeo_peso_pesado", sexo: "H", endo: 3.8, meso: 5.5, ecto: 2.5, dominante: "Meso", x: -1.3, y: 4.7, endo_f: 4.2, meso_f: 4.8, ecto_f: 2.2, x_f: -2, y_f: 3.2 },
    { deporte: "ciclismo_bmx", sexo: "H", endo: 2.8, meso: 4.5, ecto: 3.8, dominante: "Meso", x: 1, y: 2.4, endo_f: 3, meso_f: 3.9, ecto_f: 3.6, x_f: 0.6, y_f: 1.2 },
    { deporte: "ciclismo_carretera", sexo: "H", endo: 1.8, meso: 4.1, ecto: 3.2, dominante: "", x: 0.9, y: -2.7, endo_f: 3.3, meso_f: 3.1, ecto_f: 2.6, x_f: 0.5, y_f: 0.4 },
    { deporte: "ciclismo_montaña", sexo: "H", endo: 2, meso: 4.7, ecto: 2.8, dominante: "", x: 1.9, y: -2.5, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "ciclismo_pista_velocidad", sexo: "H", endo: 2.5, meso: 4.9, ecto: 4, dominante: "Meso", x: 1.5, y: 3.3, endo_f: 2.8, meso_f: 4.3, ecto_f: 4.2, x_f: 1.4, y_f: 1.6 },
    { deporte: "ciclismo_ruta", sexo: "H", endo: 2.2, meso: 3.2, ecto: 5.6, dominante: "Ecto", x: 3.4, y: -1.4, endo_f: 2.4, meso_f: 2.6, ecto_f: 5.8, x_f: 3.4, y_f: -3 },
    { deporte: "crossfit", sexo: "H", endo: 2.8, meso: 6.3, ecto: 2.5, dominante: "Meso", x: -0.3, y: 7.3, endo_f: 3.2, meso_f: 5.6, ecto_f: 2.3, x_f: -0.9, y_f: 5.7 },
    { deporte: "curling", sexo: "H", endo: 4, meso: 3.5, ecto: 2.8, dominante: "Endo", x: -1.2, y: 0.2, endo_f: 4.3, meso_f: 2.9, ecto_f: 2.5, x_f: -1.8, y_f: -1 },
    { deporte: "danza_clásica", sexo: "H", endo: 2.5, meso: 3, ecto: 5, dominante: "Ecto", x: 2.5, y: -1.5, endo_f: 2.2, meso_f: 2.5, ecto_f: 5.5, x_f: 3.3, y_f: -2.7 },
    { deporte: "escalada_deportiva", sexo: "H", endo: 2.3, meso: 4, ecto: 4.5, dominante: "Ecto", x: 2.2, y: 1.2, endo_f: 2.5, meso_f: 3.4, ecto_f: 4.8, x_f: 2.3, y_f: -0.5 },
    { deporte: "esgrima", sexo: "H", endo: 2.5, meso: 3.8, ecto: 4.7, dominante: "Ecto", x: 2.2, y: 0.4, endo_f: 2.8, meso_f: 3.2, ecto_f: 5, x_f: 2.2, y_f: -1.4 },
    { deporte: "esgrima", sexo: "H", endo: 2.5, meso: 4.2, ecto: 3.2, dominante: "", x: 1, y: -2.4, endo_f: 3.4, meso_f: 2.5, ecto_f: 3.3, x_f: -0.8, y_f: -1.7 },
    { deporte: "esquí_alpino", sexo: "H", endo: 3, meso: 4.5, ecto: 3.5, dominante: "Meso", x: 0.5, y: 2.5, endo_f: 3.4, meso_f: 3.9, ecto_f: 3.2, x_f: -0.2, y_f: 1.2 },
    { deporte: "esquí_alpino", sexo: "H", endo: 2.2, meso: 4.7, ecto: 2.7, dominante: "", x: 2, y: 0.6, endo_f: 3.6, meso_f: 3.3, ecto_f: 2.4, x_f: 0.9, y_f: -1.2 },
    { deporte: "frontenis", sexo: "H", endo: 3, meso: 4, ecto: 3.8, dominante: "Meso", x: 0.8, y: 1.2, endo_f: 3.3, meso_f: 3.4, ecto_f: 3.6, x_f: 0.3, y_f: -0.1 },
    { deporte: "fútbol_campo", sexo: "H", endo: 2.7, meso: 4.5, ecto: 4, dominante: "Meso", x: 1.3, y: 2.3, endo_f: 3, meso_f: 3.9, ecto_f: 4.2, x_f: 1.2, y_f: 0.6 },
    { deporte: "fútbol_más_18", sexo: "H", endo: 2.4, meso: 3.9, ecto: 3.2, dominante: "", x: 0.7, y: 0.9, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "fútbol_menos_18", sexo: "H", endo: 2.3, meso: 4.4, ecto: 2.8, dominante: "", x: 1.6, y: 0.6, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "fútbol_porteros", sexo: "H", endo: 3.2, meso: 5, ecto: 3.3, dominante: "Meso", x: 0.1, y: 3.5, endo_f: 3.7, meso_f: 4.4, ecto_f: 3.1, x_f: -0.6, y_f: 2 },
    { deporte: "gimnasia_artística", sexo: "H", endo: 1.6, meso: 5.4, ecto: 2.7, dominante: "", x: 2.7, y: -5.1, endo_f: 2.2, meso_f: 3.8, ecto_f: 3.1, x_f: 0.7, y_f: 2.4 },
    { deporte: "gimnasia_artística_masculina", sexo: "H", endo: 2, meso: 6, ecto: 3.5, dominante: "Meso", x: 1.5, y: 6.5, endo_f: 2.2, meso_f: 5, ecto_f: 4, x_f: 1.8, y_f: 3.8 },
    { deporte: "gimnasia_rítmica", sexo: "M", endo: 2.2, meso: 3.8, ecto: 5, dominante: "Ecto", x: 2.8, y: 0.4, endo_f: 2, meso_f: 3, ecto_f: 5.5, x_f: 3.5, y_f: -1.5 },
    { deporte: "gimnasia_rítmica", sexo: "M", endo: 1.9, meso: 2.2, ecto: 5.1, dominante: "", x: -2.9, y: -2.4, endo_f: 1.9, meso_f: 2.2, ecto_f: 5.1, x_f: -2.9, y_f: -2.4 },
    { deporte: "gimnasia_trampolín", sexo: "H", endo: 1.8, meso: 4.6, ecto: 3.2, dominante: "", x: 1.4, y: 4.2, endo_f: 3.1, meso_f: 3.1, ecto_f: 3.1, x_f: 0, y_f: 0 },
    { deporte: "golf", sexo: "H", endo: 4, meso: 3, ecto: 3.5, dominante: "Endo", x: -0.5, y: -1.5, endo_f: 4.5, meso_f: 2.5, ecto_f: 3, x_f: -1.5, y_f: -2.5 },
    { deporte: "golf", sexo: "H", endo: 2.7, meso: 4.2, ecto: 3.1, dominante: "", x: 1.1, y: 0.5, endo_f: 4.4, meso_f: 2.7, ecto_f: 2.8, x_f: -0.1, y_f: -1.9 },
    { deporte: "halterofilia", sexo: "H", endo: 2.5, meso: 7.5, ecto: 1.5, dominante: "Meso", x: -1, y: 11, endo_f: 3, meso_f: 6.8, ecto_f: 1.2, x_f: -1.8, y_f: 9.4 },
    { deporte: "halterofilia", sexo: "H", endo: 3.2, meso: 6, ecto: 1.5, dominante: "", x: 4.5, y: -1.7, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "hípica_salto", sexo: "H", endo: 3, meso: 3.5, ecto: 4, dominante: "Ecto", x: 1, y: 0, endo_f: 3.3, meso_f: 2.9, ecto_f: 4.3, x_f: 1, y_f: -1.8 },
    { deporte: "hockey_hierba", sexo: "H", endo: 2.7, meso: 4.5, ecto: 3.9, dominante: "Meso", x: 1.2, y: 2.4, endo_f: 3, meso_f: 3.9, ecto_f: 4.1, x_f: 1.1, y_f: 0.7 },
    { deporte: "hockey_hierba", sexo: "H", endo: 2.3, meso: 4.7, ecto: 2.6, dominante: "", x: 2.1, y: 0.3, endo_f: 3.6, meso_f: 3.1, ecto_f: 2.6, x_f: 0.5, y_f: -0.1 },
    { deporte: "judo_58_72kg", sexo: "H", endo: 1.9, meso: 5.5, ecto: 2.2, dominante: "", x: 3.3, y: 0.3, endo_f: 2.9, meso_f: 3.5, ecto_f: 2.4, x_f: 1.1, y_f: -0.4 },
    { deporte: "judo_58_72kg", sexo: "M", endo: 3.6, meso: 4.3, ecto: 1.8, dominante: "", x: 2.5, y: -1.8, endo_f: 3.6, meso_f: 4.3, ecto_f: 1.8, x_f: 2.5, y_f: -1.8 },
    { deporte: "judo_72_80kg", sexo: "H", endo: 2.3, meso: 5.8, ecto: 2, dominante: "", x: 3.8, y: -0.3, endo_f: 3.6, meso_f: 4.3, ecto_f: 1.8, x_f: 2.5, y_f: -1.8 },
    { deporte: "judo_72_80kg", sexo: "M", endo: 3.8, meso: 4.6, ecto: 1.3, dominante: "", x: 3.3, y: -2.5, endo_f: 3.8, meso_f: 4.6, ecto_f: 1.3, x_f: 3.3, y_f: -2.5 },
    { deporte: "judo_menos_58kg", sexo: "M", endo: 2.9, meso: 3.5, ecto: 2.4, dominante: "", x: 1.1, y: -0.4, endo_f: 2.9, meso_f: 3.5, ecto_f: 2.4, x_f: 1.1, y_f: -0.4 },
    { deporte: "judo_menos_90_kg", sexo: "H", endo: 3, meso: 4.6, ecto: 3.4, dominante: "Meso", x: 0.4, y: 2.8, endo_f: 3.5, meso_f: 4, ecto_f: 3.2, x_f: -0.3, y_f: 1.3 },
    { deporte: "judo_más_80kg", sexo: "H", endo: 3.3, meso: 7.3, ecto: 0.8, dominante: "", x: 6.5, y: -2.4, endo_f: 3.8, meso_f: 4.6, ecto_f: 1.3, x_f: 3.3, y_f: -2.5 },
    { deporte: "kárate_kumite", sexo: "H", endo: 2.7, meso: 4.2, ecto: 4, dominante: "Meso", x: 1.3, y: 1.7, endo_f: 3, meso_f: 3.6, ecto_f: 4.2, x_f: 1.2, y_f: 0 },
    { deporte: "lanzamiento_de_peso", sexo: "H", endo: 3, meso: 7, ecto: 1.8, dominante: "Meso", x: -1.2, y: 9.2, endo_f: 3.5, meso_f: 6.3, ecto_f: 1.5, x_f: -2, y_f: 7.6 },
    { deporte: "lucha_58_72kg", sexo: "H", endo: 2.1, meso: 5.2, ecto: 2.3, dominante: "", x: 2.9, y: 0.1, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "lucha_72_80kg", sexo: "H", endo: 2.5, meso: 5.5, ecto: 1.8, dominante: "", x: 3.7, y: -0.7, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "lucha_grecorromana", sexo: "H", endo: 3.2, meso: 6.2, ecto: 2.2, dominante: "Meso", x: -1, y: 7, endo_f: 3.7, meso_f: 5.5, ecto_f: 2, x_f: -1.7, y_f: 5.3 },
    { deporte: "lucha_menos_58kg", sexo: "H", endo: 1.8, meso: 4.4, ecto: 3.1, dominante: "", x: 1.3, y: 1.3, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "lucha_más_80kg", sexo: "H", endo: 3.2, meso: 6.6, ecto: 1, dominante: "", x: 5.6, y: -2.2, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "natación_1500m_libre", sexo: "H", endo: 2.5, meso: 3, ecto: 5.2, dominante: "Ecto", x: 2.7, y: -1.7, endo_f: 2.7, meso_f: 2.4, ecto_f: 5.4, x_f: 2.7, y_f: -3.3 },
    { deporte: "natación_carreras_menos_16", sexo: "H", endo: 2.2, meso: 4.3, ecto: 3.2, dominante: "", x: 1.1, y: 1, endo_f: 3, meso_f: 2.9, ecto_f: 3.3, x_f: -0.4, y_f: 0.3 },
    { deporte: "natación_carreras_más_16", sexo: "H", endo: 1.9, meso: 4.6, ecto: 3, dominante: "", x: 1.6, y: 1.1, endo_f: 3, meso_f: 3.1, ecto_f: 3, x_f: 0.1, y_f: -0.1 },
    { deporte: "natación_sincronizada", sexo: "M", endo: 3, meso: 3.5, ecto: 4.2, dominante: "Ecto", x: 1.2, y: -0.2, endo_f: 2.8, meso_f: 3, ecto_f: 4.5, x_f: 1.7, y_f: -1.3 },
    { deporte: "natación_sincronizada", sexo: "M", endo: 3.3, meso: 2.6, ecto: 3.2, dominante: "", x: -0.6, y: -0.1, endo_f: 3.3, meso_f: 2.6, ecto_f: 3.2, x_f: -0.6, y_f: -0.1 },
    { deporte: "pádel", sexo: "H", endo: 3, meso: 3.8, ecto: 4, dominante: "Ecto", x: 1, y: 0.6, endo_f: 3.3, meso_f: 3.2, ecto_f: 4.2, x_f: 0.9, y_f: -1.1 },
    { deporte: "parkour", sexo: "H", endo: 2.5, meso: 4.3, ecto: 4.2, dominante: "Meso", x: 1.7, y: 1.9, endo_f: 2.8, meso_f: 3.7, ecto_f: 4.4, x_f: 1.6, y_f: 0.2 },
    { deporte: "patinaje_artístico", sexo: "H", endo: 2.2, meso: 4.3, ecto: 3.1, dominante: "", x: 1.2, y: 0.9, endo_f: 3, meso_f: 2.9, ecto_f: 3, x_f: -0.1, y_f: -0.3 },
    { deporte: "patinaje_velocidad", sexo: "H", endo: 1.9, meso: 4.1, ecto: 3.3, dominante: "", x: 0.8, y: 3, endo_f: 3.7, meso_f: 3.5, ecto_f: 2.3, x_f: 1.2, y_f: 1 },
    { deporte: "patinaje_velocidad", sexo: "H", endo: 2.1, meso: 5.3, ecto: 2, dominante: "", x: 3.3, y: -0.2, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "pentatlón", sexo: "H", endo: 2.1, meso: 4.4, ecto: 3.2, dominante: "", x: 1.2, y: -3.4, endo_f: 3.4, meso_f: 2.9, ecto_f: 3.1, x_f: -0.2, y_f: -0.7 },
    { deporte: "pesca_deportiva", sexo: "H", endo: 4.2, meso: 3, ecto: 2.8, dominante: "Endo", x: -1.4, y: -1, endo_f: 4.5, meso_f: 2.5, ecto_f: 2.5, x_f: -2, y_f: -2 },
    { deporte: "petanca", sexo: "H", endo: 5, meso: 2, ecto: 2.5, dominante: "Endo", x: -2.5, y: -3.5, endo_f: 5.3, meso_f: 1.5, ecto_f: 2.2, x_f: -3.1, y_f: -4.5 },
    { deporte: "pilates", sexo: "H", endo: 3.2, meso: 3, ecto: 4, dominante: "Ecto", x: 0.8, y: -1.2, endo_f: 3.5, meso_f: 2.4, ecto_f: 4.2, x_f: 0.7, y_f: -2.9 },
    { deporte: "piragüismo_aguas_tranquilas", sexo: "H", endo: 3, meso: 5.4, ecto: 3, dominante: "Meso", x: 0, y: 4.8, endo_f: 3.4, meso_f: 4.8, ecto_f: 2.8, x_f: -0.6, y_f: 3.4 },
    { deporte: "piragüismo_aguas_tranquilas", sexo: "H", endo: 1.9, meso: 4.3, ecto: 3, dominante: "", x: 1.3, y: 1.1, endo_f: 3.1, meso_f: 3.3, ecto_f: 2.4, x_f: 0.9, y_f: -0.7 },
    { deporte: "piragüismo_slalom", sexo: "H", endo: 1.9, meso: 5, ecto: 2.8, dominante: "", x: 2.2, y: 0.9, endo_f: 3.3, meso_f: 3.3, ecto_f: 2.7, x_f: 0.6, y_f: 0.6 },
    { deporte: "remo_ligeros", sexo: "H", endo: 1.8, meso: 4.2, ecto: 3, dominante: "", x: 1.2, y: 1.2, endo_f: 2.8, meso_f: 2, ecto_f: 2.6, x_f: -0.6, y_f: -0.2 },
    { deporte: "remo_pesados", sexo: "H", endo: 2.3, meso: 4.8, ecto: 2.5, dominante: "", x: 2.3, y: 0.2, endo_f: 4.4, meso_f: 3.6, ecto_f: 2, x_f: 1.6, y_f: -2.4 },
    { deporte: "remo_skiff", sexo: "H", endo: 2.8, meso: 5, ecto: 3.5, dominante: "Meso", x: 0.7, y: 3.7, endo_f: 3.2, meso_f: 4.3, ecto_f: 3, x_f: -0.2, y_f: 2.4 },
    { deporte: "rugby_delanteros", sexo: "H", endo: 3.5, meso: 6.5, ecto: 2, dominante: "Meso", x: -1.5, y: 7.5, endo_f: 4, meso_f: 5.8, ecto_f: 1.8, x_f: -2.2, y_f: 5.8 },
    { deporte: "senderismo_alta_montaña", sexo: "H", endo: 2.8, meso: 3.2, ecto: 4.5, dominante: "Ecto", x: 1.7, y: -0.9, endo_f: 3, meso_f: 2.6, ecto_f: 4.8, x_f: 1.8, y_f: -2.6 },
    { deporte: "squash", sexo: "H", endo: 2.7, meso: 4, ecto: 4.3, dominante: "Ecto", x: 1.6, y: 1, endo_f: 3, meso_f: 3.4, ecto_f: 4.6, x_f: 1.6, y_f: -0.8 },
    { deporte: "surf_competición", sexo: "H", endo: 2.8, meso: 4, ecto: 4.2, dominante: "Ecto", x: 1.4, y: 1, endo_f: 3, meso_f: 3.4, ecto_f: 4.5, x_f: 1.5, y_f: -0.7 },
    { deporte: "taekwondo", sexo: "H", endo: 2.8, meso: 4.3, ecto: 3.8, dominante: "Meso", x: 1, y: 2, endo_f: 3, meso_f: 3.7, ecto_f: 4, x_f: 1, y_f: 0.4 },
    { deporte: "taekwondo_menos_49kg", sexo: "M", endo: 2.5, meso: 2.6, ecto: 3.5, dominante: "", x: -0.9, y: 1, endo_f: 2.5, meso_f: 2.6, ecto_f: 3.5, x_f: -0.9, y_f: 1 },
    { deporte: "taekwondo_menos_57kg", sexo: "M", endo: 3, meso: 3, ecto: 3.2, dominante: "", x: -0.2, y: 0.2, endo_f: 3, meso_f: 3, ecto_f: 3.2, x_f: -0.2, y_f: 0.2 },
    { deporte: "taekwondo_menos_58kg", sexo: "H", endo: 1.7, meso: 3.9, ecto: 3.6, dominante: "", x: 0.3, y: 1.9, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "taekwondo_menos_67kg", sexo: "M", endo: 3.2, meso: 3.4, ecto: 2.7, dominante: "", x: 0.7, y: -0.5, endo_f: 3.2, meso_f: 3.4, ecto_f: 2.7, x_f: 0.7, y_f: -0.5 },
    { deporte: "taekwondo_menos_68kg", sexo: "H", endo: 1.8, meso: 4.3, ecto: 3.3, dominante: "", x: 1, y: 1.5, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "taekwondo_menos_80kg", sexo: "H", endo: 2.2, meso: 4.5, ecto: 2.9, dominante: "", x: 1.6, y: 0.6, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "taekwondo_más_67kg", sexo: "M", endo: 3.6, meso: 3.8, ecto: 2.2, dominante: "", x: 1.6, y: -1.4, endo_f: 3.6, meso_f: 3.8, ecto_f: 2.2, x_f: 1.6, y_f: -1.4 },
    { deporte: "taekwondo_más_80kg", sexo: "H", endo: 3, meso: 5.5, ecto: 1.9, dominante: "", x: 3.6, y: -1.1, endo_f: 0, meso_f: 0, ecto_f: 0, x_f: 0, y_f: 0 },
    { deporte: "tai_chi", sexo: "H", endo: 3.8, meso: 2.5, ecto: 3.5, dominante: "Endo", x: -0.3, y: -2.3, endo_f: 4, meso_f: 2, ecto_f: 3.2, x_f: -0.8, y_f: -3.2 },
    { deporte: "tenis", sexo: "H", endo: 2.8, meso: 4.8, ecto: 3.8, dominante: "Meso", x: 1, y: 3, endo_f: 3, meso_f: 4.2, ecto_f: 4, x_f: 1, y_f: 1.4 },
    { deporte: "tenis_de_mesa", sexo: "H", endo: 2.9, meso: 3.9, ecto: 3.2, dominante: "", x: 0.7, y: 0.4, endo_f: 4.5, meso_f: 2.8, ecto_f: 2.8, x_f: 0, y_f: -1.7 },
    { deporte: "tenis_más_16", sexo: "H", endo: 2.2, meso: 4.3, ecto: 3, dominante: "", x: 1.3, y: 0.8, endo_f: 3.7, meso_f: 3.1, ecto_f: 2.5, x_f: 0.6, y_f: -1.1 },
    { deporte: "tenis_menos_16", sexo: "H", endo: 2.4, meso: 3.9, ecto: 3.5, dominante: "", x: 0.4, y: 1.1, endo_f: 3.7, meso_f: 3, ecto_f: 2.7, x_f: 0.3, y_f: -0.9 },
    { deporte: "tiro_con_arco", sexo: "H", endo: 3.5, meso: 3, ecto: 4, dominante: "Endo", x: 0.5, y: -1.5, endo_f: 3.8, meso_f: 2.4, ecto_f: 4.2, x_f: 0.4, y_f: -3.2 },
    { deporte: "triatlón", sexo: "H", endo: 1.7, meso: 4.6, ecto: 3.1, dominante: "", x: 1.5, y: -2.8, endo_f: 2.4, meso_f: 3.2, ecto_f: 3.4, x_f: -0.2, y_f: 1 },
    { deporte: "triatlón_larga_distancia", sexo: "H", endo: 2, meso: 3, ecto: 5.5, dominante: "Ecto", x: 3.5, y: -1.5, endo_f: 2.2, meso_f: 2.4, ecto_f: 5.7, x_f: 3.5, y_f: -3.1 },
    { deporte: "vela_laser", sexo: "H", endo: 3.2, meso: 3.8, ecto: 3.8, dominante: "Meso", x: 0.6, y: 0.6, endo_f: 3.5, meso_f: 3.2, ecto_f: 3.6, x_f: 0.1, y_f: -0.7 },
    { deporte: "voleibol", sexo: "H", endo: 2.2, meso: 3.9, ecto: 3.4, dominante: "", x: 0.5, y: 2.3, endo_f: 3.5, meso_f: 2.3, ecto_f: 3.4, x_f: -1.1, y_f: -2.2 },
    { deporte: "voleibol_centrales", sexo: "H", endo: 2.5, meso: 4.7, ecto: 4.3, dominante: "Meso", x: 1.8, y: 2.6, endo_f: 2.8, meso_f: 4, ecto_f: 4.5, x_f: 1.7, y_f: 0.7 },
    { deporte: "waterpolo", sexo: "H", endo: 3, meso: 4.5, ecto: 3.5, dominante: "Meso", x: 0.5, y: 2.5, endo_f: 3.5, meso_f: 3.9, ecto_f: 3.2, x_f: -0.3, y_f: 1.1 },
    { deporte: "waterpolo_arco_abs", sexo: "H", endo: 2.7, meso: 4.8, ecto: 2.4, dominante: "", x: 2.4, y: -0.3, endo_f: 3.9, meso_f: 3.2, ecto_f: 2.6, x_f: 0.6, y_f: -1.3 },
    { deporte: "waterpolo_arco_jr", sexo: "H", endo: 2.3, meso: 4.4, ecto: 2.9, dominante: "", x: 1.5, y: 0.7, endo_f: 4.1, meso_f: 3.4, ecto_f: 2.4, x_f: 1, y_f: -1.7 },
    { deporte: "waterpolo_fuerza_abs", sexo: "H", endo: 3.5, meso: 5.8, ecto: 1.9, dominante: "", x: 3.9, y: -1.6, endo_f: 4, meso_f: 3.2, ecto_f: 2.5, x_f: 0.7, y_f: -1.5 },
    { deporte: "waterpolo_fuerza_jr", sexo: "H", endo: 3.2, meso: 4.5, ecto: 2.7, dominante: "", x: 1.8, y: -0.6, endo_f: 4.6, meso_f: 3.3, ecto_f: 2.4, x_f: 0.9, y_f: -2.2 },
    { deporte: "waterpolo_porteros_abs", sexo: "H", endo: 3, meso: 4.3, ecto: 2.8, dominante: "", x: 1.5, y: -0.2, endo_f: 4, meso_f: 2.7, ecto_f: 2.7, x_f: 0, y_f: -1.3 },
    { deporte: "waterpolo_porteros_jr", sexo: "H", endo: 2.8, meso: 4, ecto: 3.5, dominante: "", x: 0.5, y: 0.7, endo_f: 4.7, meso_f: 2.6, ecto_f: 2.7, x_f: -0.1, y_f: -2 },
    { deporte: "yoga_hatha", sexo: "H", endo: 3.5, meso: 2.5, ecto: 4, dominante: "Endo", x: 0.5, y: -2.5, endo_f: 3.8, meso_f: 2, ecto_f: 4.2, x_f: 0.4, y_f: -4 }
];


 // Función para actualizar las opciones de modalidadInput
    function updateModalidadOptions() {
        const selectedGrupo = deporteInput.value;
        modalidadInput.innerHTML = '<option value="" disabled selected>Selecciona una modalidad</option>';

        if (selectedGrupo === 'Deportes') {
            deportesModalidades.forEach(modalidad => {
                const option = document.createElement('option');
                option.value = modalidad.toLowerCase().replace(/ /g, '_').replace(/:/g, '').replace(/[\(\)]/g, '').replace(/-/g, '_').replace(/>/g, 'más_').replace(/</g, 'menos_');
                option.textContent = modalidad;
                modalidadInput.appendChild(option);
            });
            modalidadInput.disabled = false;
        } else {
            const option = document.createElement('option');
            option.value = selectedGrupo.toLowerCase();
            option.textContent = selectedGrupo;
            modalidadInput.appendChild(option);
            modalidadInput.disabled = true;
        }
        updateSomatotipoValues();
    }

    // Función para actualizar los valores del somatotipo
    function updateSomatotipoValues() {
        const selectedModalidad = modalidadInput.value;
        const selectedSexo = nombreInput.value;

        // Limpiar los campos
        somatotipoEndo.value = '';
        somatotipoMeso.value = '';
        somatotipoEcto.value = '';
        somatotipoDominante.value = '';
        somatotipoX.value = '';
        somatotipoY.value = '';

        // Verificar que haya una modalidad y un género seleccionados
        if (!selectedModalidad || !selectedSexo) {
            console.debug('Falta seleccionar modalidad o género.');
            return;
        }

        // Evitar poblar campos para grupos genéricos
        if (['sedentarios', 'poblacionTipo', 'tomasCliente'].includes(selectedModalidad)) {
            console.debug(`Modalidad "${selectedModalidad}" no tiene datos de somatotipo.`);
            return;
        }

        // Buscar datos en somatotipoData
        const sexoKey = selectedSexo === 'masculino' ? 'H' : 'M';
        const data = somatotipoData.find(item => item.deporte === selectedModalidad && item.sexo === "H"); // Siempre busca H

	if (data) {
	    // Asignar valores según el sexo seleccionado
	    somatotipoEndo.value = sexoKey === 'H' ? data.endo : data.endo_f;
	    somatotipoMeso.value = sexoKey === 'H' ? data.meso : data.meso_f;
	    somatotipoEcto.value = sexoKey === 'H' ? data.ecto : data.ecto_f;
	    somatotipoDominante.value = data.dominante || '';
	    somatotipoX.value = sexoKey === 'H' ? data.x : data.x_f;
	    somatotipoY.value = sexoKey === 'H' ? data.y : data.y_f;
	    
	    console.debug(`Somatotipo actualizado para ${selectedModalidad} (${selectedSexo}):`, data);
	} else {
	    console.warn(`No se encontraron datos de somatotipo para ${selectedModalidad} (${sexoKey}).`);
	}
    }

    // Remover eventos previos para evitar duplicados
    deporteInput.removeEventListener('change', updateModalidadOptions);
    modalidadInput.removeEventListener('change', updateSomatotipoValues);
    nombreInput.removeEventListener('change', updateSomatotipoValues);

    // Agregar eventos
    deporteInput.addEventListener('change', updateModalidadOptions);
    modalidadInput.addEventListener('change', updateSomatotipoValues);
    nombreInput.addEventListener('change', updateSomatotipoValues);
});

	// Función para abrir el modal Ficha Médica (Anamnesis)
function openModal(event) {
  if (event) event.stopPropagation();

  const modal = document.getElementById("commitModal");
  if (modal) {
    modal.classList.add("active");

    const hasData = localStorage.getItem("fichaMedica");
    if (hasData) {
      console.log("Hay datos guardados. Se cargarán automáticamente.");
    }

    cargarDatos(); // Carga los datos guardados desde localStorage
  }
}

// Función para cerrar el modal
function closeModal(event) {
  const modal = document.getElementById("commitModal");

  if (modal && modal.classList.contains("active")) {
    const hasData = localStorage.getItem("fichaMedica");

    if (hasData) {
      const confirmDelete = confirm("¿Deseas borrar los datos guardados antes de cerrar?");
      if (confirmDelete) {
        localStorage.removeItem("fichaMedica"); // Borrar datos
        alert("Datos eliminados.");
      }
    }

    modal.classList.remove("active");
  }
}

// Función: Borrar datos manualmente
function borrarDatos() {
  const hasData = localStorage.getItem("fichaMedica");

  if (!hasData) {
    alert("No hay datos guardados.");
    return;
  }

  const confirmDelete = confirm("¿Estás seguro de que deseas borrar los datos guardados?");
  if (confirmDelete) {
    localStorage.removeItem("fichaMedica");
    alert("Datos borrados correctamente.");

    // Limpiar formulario visualmente
    const form = document.getElementById("form-datos-paciente");
    if (form) {
      form.reset();

      // Desmarcar radios y checkboxes
      const radioInputs = form.querySelectorAll('input[type="radio"]');
      radioInputs.forEach(radio => { radio.checked = false; });

      const checkboxInputs = form.querySelectorAll('input[type="checkbox"]');
      checkboxInputs.forEach(checkbox => { checkbox.checked = false; });
    }
  }
}

// Guardar datos del formulario
function guardarDatos(event) {
  event.preventDefault();

  const form = document.getElementById("form-datos-paciente");
  const formData = new FormData(form);
  const data = Object.fromEntries(formData);

  localStorage.setItem("fichaMedica", JSON.stringify(data));

  // Mostrar notificación
  mostrarNotificacion("✅ Datos guardados correctamente");

  closeModal(); // Opcional: cierra el modal después de guardar
}

// Mostrar notificación temporal
function mostrarNotificacion(mensaje) {
  const notification = document.getElementById("save-notification");
  if (!notification) return;

  notification.textContent = mensaje;
  notification.classList.remove("hidden");

  // Ocultar automáticamente después de 3 segundos
  setTimeout(() => {
    notification.classList.add("hidden");
  }, 3000);
}

// Cargar datos al abrir el modal
function cargarDatos() {
  const savedData = localStorage.getItem("fichaMedica");
  if (savedData) {
    const data = JSON.parse(savedData);
    const form = document.getElementById("form-datos-paciente");

    for (const [name, value] of Object.entries(data)) {
      const field = form.querySelector(`[name="${name}"]`);
      if (field && field.type === "radio") {
        field.checked = field.value === value;
      } else if (field) {
        field.value = value;
      }
    }
  }
}

// Event Listeners: Cerrar con teclado o fuera del modal
document.addEventListener("DOMContentLoaded", function () {
  const modal = document.getElementById("commitModal");

  // Cerrar al hacer clic fuera del contenido
  if (modal) {
    modal.addEventListener("click", function (e) {
      if (e.target === this) {
        closeModal();
      }
    });
  }

  // Cerrar con tecla ESC
  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape") {
      closeModal();
    }
  });

  // Asignar evento al botón "Añadir data"
  const btnAbrirData = document.getElementById("btn-abrir-data");
  if (btnAbrirData) {
    btnAbrirData.addEventListener("click", function (event) {
      event.stopPropagation();
      openModal();
    });
  }
});
	
</script>
 <!-- Firebase -->
    <script type="module" src="https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <!-- Chart.js plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
   
	

	
    <!-- Your app.js -->
    <script type="module" src="app.js"></script>
    <script type="module" src="calculations.js"></script>
</body>
</html>
