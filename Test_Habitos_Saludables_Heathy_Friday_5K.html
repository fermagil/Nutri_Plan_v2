<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Healthy Friday - Estaciones</title>
  <style>
/* ===== VARIABLES DE COLOR Y TIPOGRAFÃA (Modernas y accesibles) ===== */
:root {
  /* Colores de Acceso RÃ¡pido */
  --hf-blue-primary: #2563eb; /* Azul estÃ¡ndar */
  --hf-blue-primary-hover: #1d4ed8; /* Hover del azul */
  --hf-green-accent: #0d9488; /* Verde saludable principal */
  --hf-green-accent-hover: #30baaf; /* Hover del verde */
  --hf-green-accent-active: #0a7c72; /* Active del verde */
  --hf-red-error: #dc2626; /* Error */
  --hf-orange-warning: #d97706; /* Advertencia */

  /* Paleta de Colores (mÃ¡s accesible) */
  --color-primary: var(--hf-blue-primary);
  --color-primary-hover: var(--hf-blue-primary-hover);
  --color-success: var(--hf-green-accent);
  --color-success-hover: var(--hf-green-accent-hover);
  --color-success-active: var(--hf-green-accent-active);
  --color-warning: var(--hf-orange-warning);
  --color-danger: var(--hf-red-error);
  --color-bg: #f9fafb; /* Fondo mÃ¡s cÃ¡lido */
  --color-surface: #ffffff;
  --color-text: #111827; /* Negro mÃ¡s oscuro para mejor contraste */
  --color-text-secondary: #4b5563; /* Gris oscuro para secundario */
  --color-text-tertiary: #6b7280; /* Gris medio para terciario */
  --color-border: #d1d5db; /* Gris claro para bordes */
  --color-outline-focus: rgba(37, 99, 235, 0.5); /* Borde de enfoque */

  /* Bordes y Sombras */
  --border-radius: 16px; /* Ligeramente menos redondeado */
  --border-radius-sm: 8px;
  --border-radius-btn: 12px; /* Bordes de botones */
  --border: 1px solid var(--color-border);
  --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Sombra muy sutil */
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Sombra media */
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Sombra mÃ¡s pronunciada */
  --shadow-hover: var(--shadow-lg); /* Sombra al hacer hover */

  /* TipografÃ­a */
  --font-main: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  --font-heading: var(--font-main); /* Misma fuente para encabezados */
  --font-size-xs: 0.75rem; /* 12px */
  --font-size-sm: 0.875rem; /* 14px */
  --font-size-base: 1rem; /* 16px */
  --font-size-lg: 1.125rem; /* 18px */
  --font-size-xl: 1.25rem; /* 20px */
  --font-size-2xl: 1.5rem; /* 24px */
  --font-size-3xl: 1.875rem; /* 30px */
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;

  /* Espaciado */
  --spacing-xs: 0.5rem; /* 8px */
  --spacing-sm: 0.75rem; /* 12px */
  --spacing-md: 1rem; /* 16px */
  --spacing-lg: 1.5rem; /* 24px */
  --spacing-xl: 2rem; /* 32px */
  --spacing-2xl: 3rem; /* 48px */

  /* Contenido MÃ¡ximo */
  --max-width-container: 800px;
  --max-width-content: 768px; /* Para pÃ¡ginas internas */
}

/* ===== REINICIO Y ESTILOS BASE ===== */
/* Reset simplificado y moderno */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  /* Establece el tamaÃ±o base de la fuente para usar 'rem' */
  font-size: 16px;
  /* Mejora la legibilidad del texto */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  font-feature-settings: "kern" 1, "liga" 1, "clig" 1, "calt" 1;
  /* Evita el ajuste de fuente por el navegador */
  -moz-text-size-adjust: none;
  -webkit-text-size-adjust: none;
  text-size-adjust: none;
}

body {
  font-family: var(--font-main);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-normal);
  line-height: 1.6;
  color: var(--color-text);
  background-color: var(--color-bg);
  /* Espacio inferior para evitar que el contenido quede pegado al footer */
  padding-bottom: env(safe-area-inset-bottom, 0);
  /* TransiciÃ³n suave para cambios de tema o modo oscuro si se implementa */
  transition: background-color 0.2s ease, color 0.2s ease;
}

/* ===== ENCABEZADOS ===== */
header h1 {
  text-align: center;
  color: var(--color-primary);
  margin: var(--spacing-xl) 0 var(--spacing-lg); /* Espacio arriba y abajo */
  font-weight: var(--font-weight-bold);
  font-size: var(--font-size-2xl); /* TamaÃ±o mÃ¡s grande */
  line-height: 1.2; /* LÃ­nea mÃ¡s ajustada para tÃ­tulos grandes */
  letter-spacing: -0.025em; /* Ligeramente mÃ¡s ajustado para tÃ­tulos grandes */
  padding: 0 var(--spacing-md); /* Espacio lateral */
}

h2 {
  color: var(--color-primary);
  margin-top: var(--spacing-lg);
  margin-bottom: var(--spacing-md);
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-xl);
  line-height: 1.3;
}

h3 {
  color: var(--color-text);
  margin-top: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-lg);
  line-height: 1.4;
}

/* ===== MENÃš PRINCIPAL (Healthy Friday - Estaciones) ===== */
.menu {
  max-width: var(--max-width-container);
  margin: 0 auto;
  padding: 0 var(--spacing-md) var(--spacing-xl); /* Espacio inferior extra */
}

.menu > main {
  /* Espaciado interno para el contenido principal del menÃº */
  padding: var(--spacing-md) 0;
}

/* Estilo para el botÃ³n de importaciÃ³n CSV */
#import-csv-section {
  margin-bottom: var(--spacing-lg);
}

#import-csv-section[style*="display: none"] {
  /* Asegura que si estÃ¡ oculto, no ocupe espacio */
  display: none !important;
}

#btn-importar-csv {
  background-color: var(--color-success);
  color: white;
  border: none;
  border-radius: var(--border-radius-btn);
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  cursor: pointer;
  width: 100%;
  max-width: 320px; /* Ancho mÃ¡ximo */
  margin: 0 auto; /* Centrado */
  box-shadow: var(--shadow-md);
  transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
  display: flex; /* Centrado interno */
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs); /* Espacio entre Ã­cono y texto */
}

#btn-importar-csv:hover,
#btn-importar-csv:focus {
  background-color: var(--color-success-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

#btn-importar-csv:focus {
  /* Borde de enfoque accesible */
  outline: 2px solid var(--color-outline-focus);
  outline-offset: 2px;
  /* Asegura visibilidad del estado de enfoque */
  z-index: 1;
}

/* Estilo para el encabezado de selecciÃ³n de test */
.menu > main > h2 {
  text-align: center;
  margin-bottom: var(--spacing-lg);
  color: var(--color-text-secondary);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-lg);
}

/* Estilo para la lista de tests */
.menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
  /* DiseÃ±o en cuadrÃ­cula para mejor uso del espacio */
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* MÃ­nimo 280px por columna */
  gap: var(--spacing-md);
}

.menu li {
  /* Opcional: para controlar el espaciado de los items */
  margin: 0;
}

.menu a {
  display: block;
  padding: var(--spacing-md);
  background: var(--color-surface);
  color: var(--color-primary);
  text-decoration: none;
  border-radius: var(--border-radius);
  font-weight: var(--font-weight-semibold);
  text-align: center;
  box-shadow: var(--shadow-md);
  transition: all 0.2s ease;
  border: var(--border);
  /* Asegura que el enlace ocupe todo el contenedor */
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Ajuste de texto para que no se desborde */
  word-break: break-word;
  hyphens: auto;
}

.menu a:hover,
.menu a:focus {
  background-color: var(--color-surface); /* Mantiene el fondo */
  color: var(--color-primary-hover); /* Cambia el color del texto */
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  border-color: var(--color-primary); /* Borde mÃ¡s oscuro al hacer hover */
  /* Borde de enfoque accesible */
  outline: 2px solid var(--color-outline-focus);
  outline-offset: -2px; /* Dentro del borde del elemento */
}

.menu a:focus {
  /* Asegura visibilidad del estado de enfoque */
  z-index: 1;
}

/* Estilo para el botÃ³n de informe global */
.btn-informe {
  background-color: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-btn);
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  cursor: pointer;
  width: 100%;
  margin-top: var(--spacing-xl);
  box-shadow: var(--shadow-md);
  transition: background-color 0.2s ease, transform 0.2s ease;
  display: flex; /* Centrado interno */
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs); /* Espacio entre Ã­cono y texto */
}

.btn-informe:hover,
.btn-informe:focus {
  background-color: var(--color-primary-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

.btn-informe:focus {
  /* Borde de enfoque accesible */
  outline: 2px solid var(--color-outline-focus);
  outline-offset: 2px;
  z-index: 1; /* Asegura visibilidad */
}
/* ===== ESTILOS PARA EL BOTÃ“N DE INFORME GLOBAL (Healthy Friday) ===== */

/* Selecciona el botÃ³n especÃ­fico dentro del menÃº principal */
.menu main .btn-informe-global {
  /* Utiliza variables CSS definidas en :root */
  background-color: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--border-radius-btn); /* Usa la variable de borde redondeado */
  padding: var(--spacing-sm) var(--spacing-md); /* Espaciado consistente */
  font-size: var(--font-size-lg); /* TamaÃ±o de fuente legible */
  font-weight: var(--font-weight-semibold); /* Peso de fuente medio-fuerte */
  cursor: pointer;
  width: 100%; /* Ancho completo como en tu HTML */
  margin-top: var(--spacing-lg); /* Margen superior consistente */
  box-shadow: var(--shadow-md); /* Sombra sutil */
  transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease; /* TransiciÃ³n suave */
  display: flex; /* Centrado interno de Ã­cono y texto */
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs); /* Espacio entre Ã­cono y texto */
  text-decoration: none; /* Por si acaso se convierte en enlace en el futuro */
  max-width: var(--max-width-content); /* Ancho mÃ¡ximo si es necesario */
  margin-left: auto; /* Centrado horizontal si el contenedor es mÃ¡s ancho */
  margin-right: auto;
  margin-top: var(--spacing-lg); /* Espacio superior */
}

/* Estado de hover */
.menu main .btn-informe-global:hover {
  background-color: var(--color-primary-hover); /* Color de hover */
  transform: translateY(-2px); /* Ligero efecto de elevaciÃ³n */
  box-shadow: var(--shadow-hover); /* Sombra mÃ¡s pronunciada al hacer hover */
}

/* Estado de foco (importante para accesibilidad) */
.menu main .btn-informe-global:focus {
  /* Borde de enfoque accesible */
  outline: 2px solid var(--color-outline-focus);
  outline-offset: 2px;
  /* Asegura que el botÃ³n estÃ© por encima de otros elementos si tiene sombra */
  z-index: 1;
  /* Opcional: Mantener el estilo de hover tambiÃ©n en foco */
  background-color: var(--color-primary-hover);
  box-shadow: var(--shadow-hover);
}

/* Opcional: Estado activo (cuando se mantiene presionado) */
.menu main .btn-informe-global:active {
  transform: translateY(0); /* Elimina la elevaciÃ³n */
  box-shadow: var(--shadow-md); /* Vuelve a la sombra base */
}
/* Estilo para el botÃ³n de volver */
.btn-volver {
  display: block;
  width: 100%;
  max-width: 320px; /* Ancho mÃ¡ximo */
  margin: var(--spacing-lg) auto 0; /* Margen superior y centrado */
  padding: var(--spacing-sm) var(--spacing-md);
  background-color: var(--hf-green-accent); /* Verde saludable */
  color: white;
  text-align: center;
  text-decoration: none;
  border-radius: var(--border-radius-btn);
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-base);
  box-shadow: var(--shadow-md);
  transition: background-color 0.2s ease, transform 0.2s ease;
  border: none;
  cursor: pointer;
  display: flex; /* Centrado interno */
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs); /* Espacio entre Ã­cono y texto */
}

.btn-volver:hover,
.btn-volver:focus {
  background-color: var(--hf-green-accent-hover); /* Verde mÃ¡s oscuro */
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

.btn-volver:focus {
  /* Borde de enfoque accesible */
  outline: 2px solid var(--color-outline-focus);
  outline-offset: 2px;
  z-index: 1; /* Asegura visibilidad */
}

/* ===== ACCESIBILIDAD Y PREFERENCIAS DEL USUARIO ===== */
/* Reduce la animaciÃ³n si el usuario lo prefiere */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  .menu a,
  .btn-informe,
  .btn-volver,
  #btn-importar-csv {
    transform: none !important;
    box-shadow: var(--shadow-md) !important; /* Mantiene sombra base */
  }
}

/* ===== IMPRESIÃ“N ===== */
@media print {
  .btn-informe,
  .btn-volver,
  .menu a,
  #btn-importar-csv,
  #import-csv-section {
    display: none !important;
  }

  body,
  .menu,
  .menu ul {
    background: white !important;
    color: black !important;
    box-shadow: none !important;
  }
}

/* ===== RESPONSIVE ===== */
/* Ajustes para pantallas medianas */
@media (max-width: 768px) {
  :root {
    --font-size-2xl: 1.375rem; /* 22px */
    --font-size-xl: 1.125rem; /* 18px */
    --font-size-lg: 1rem; /* 16px */
    --spacing-xl: 1.75rem;
    --spacing-2xl: 2.5rem;
  }

  header h1 {
    font-size: var(--font-size-xl);
    margin: var(--spacing-lg) 0 var(--spacing-md);
  }

  .menu {
    padding: 0 var(--spacing-sm) var(--spacing-lg);
  }

  .menu ul {
    grid-template-columns: 1fr; /* Una columna en mÃ³vil */
    gap: var(--spacing-sm);
  }

  .menu a {
    padding: var(--spacing-md);
    font-size: var(--font-size-base); /* Ligeramente mÃ¡s grande en mÃ³vil */
  }

  .btn-informe,
  .btn-volver,
  #btn-importar-csv {
    max-width: 100%; /* Ancho completo en mÃ³vil */
    padding: var(--spacing-sm) var(--spacing-md);
  }
}

/* Ajustes para pantallas pequeÃ±as */
@media (max-width: 480px) {
  :root {
    --font-size-xl: 1.125rem; /* 18px */
    --font-size-lg: 0.9375rem; /* 15px */
    --font-size-base: 0.9375rem; /* 15px */
    --spacing-lg: var(--spacing-md);
    --spacing-xl: var(--spacing-lg);
  }

  header h1 {
    font-size: var(--font-size-xl);
    margin: var(--spacing-md) 0 var(--spacing-sm);
  }

  .menu {
    padding: 0 var(--spacing-xs) var(--spacing-md);
  }

  .menu a {
    padding: var(--spacing-sm);
    font-size: var(--font-size-base);
  }

  .btn-informe,
  .btn-volver,
  #btn-importar-csv {
    font-size: var(--font-size-base); /* Asegura legibilidad */
  }
}

/* ===== PREGUNTAS (Modernas, Visuales e Inclusivas) ===== */

/* Contenedor de cada pregunta */
.pregunta-item {
  background: var(--color-surface);
  padding: var(--spacing-lg); /* MÃ¡s espacio interno */
  border-radius: var(--border-radius); /* Bordes redondeados consistentes */
  margin: var(--spacing-lg) 0; /* Espacio superior/inferior mÃ¡s generoso */
  /* Sombra mÃ¡s pronunciada para destacar la tarjeta */
  box-shadow: var(--shadow-md);
  /* Borde sutil en lugar de solo una lÃ­nea lateral */
  border: var(--border);
  /* TransiciÃ³n suave para efectos de hover si se agregan */
  transition: box-shadow 0.2s ease, transform 0.1s ease;
}

.pregunta-item:hover {
  /* Opcional: efecto sutil al pasar el ratÃ³n por toda la tarjeta */
  box-shadow: var(--shadow-hover);
  /* transform: translateY(-1px); */ /* Ligeramente elevada (opcional) */
}

/* TÃ­tulo de la pregunta */
.pregunta-item > p {
  margin: 0 0 var(--spacing-md) 0; /* Espacio solo debajo del tÃ­tulo */
  font-weight: var(--font-weight-semibold); /* Peso de fuente medio-fuerte */
  font-size: var(--font-size-lg); /* TamaÃ±o ligeramente mayor */
  color: var(--color-text); /* Color de texto principal */
  line-height: 1.4; /* LÃ­nea mÃ¡s ajustada para mejor lectura */
  /* Opcional: AÃ±adir un Ã­cono o nÃºmero de pregunta aquÃ­ */
  /* padding-left: var(--spacing-sm); */
  /* border-left: 3px solid var(--color-primary); */
}

/* Contenedor de cada opciÃ³n de respuesta (radio o checkbox) */
.opcion {
  display: flex; /* DisposiciÃ³n horizontal */
  align-items: center; /* Centrado vertical */
  margin: var(--spacing-sm) 0; /* Espaciado vertical entre opciones */
  padding: var(--spacing-xs); /* Espacio interno pequeÃ±o para el Ã¡rea de click */
  border-radius: var(--border-radius-sm); /* Bordes ligeramente redondeados para la opciÃ³n */
  /* TransiciÃ³n suave para efectos de hover/focus */
  transition: background-color 0.15s ease, outline 0.15s ease;
  /* Asegura que el cursor indique que es clickable */
  cursor: pointer;
}

/* Efecto hover en la opciÃ³n completa (label) */
.opcion:hover {
  background-color: color-mix(in srgb, var(--color-primary) 10%, transparent); /* Fondo muy sutil al hacer hover */
}

/* Estado de foco en la opciÃ³n completa (label) - MUY IMPORTANTE para a11y */
.opcion:focus-within {
  /* Borde de enfoque claro alrededor de la opciÃ³n completa */
  outline: 2px solid var(--color-outline-focus);
  outline-offset: 2px;
  /* Asegura visibilidad del estado de enfoque */
  z-index: 1;
  position: relative; /* Asegura que z-index funcione si hay otros elementos */
}

/* Input (radio o checkbox) dentro de la opciÃ³n */
.opcion input[type="radio"],
.opcion input[type="checkbox"] {
  /* TamaÃ±o ligeramente mayor para mejor usabilidad */
  width: 1.25em; /* 20px si font-size base es 16px */
  height: 1.25em;
  margin-right: var(--spacing-sm); /* Espacio entre input y label */
  /* Color de Ã©nfasis para el input seleccionado */
  accent-color: var(--color-primary);
  /* Asegura que el input sea parte del Ã¡rea de click del label */
  cursor: pointer;
  flex-shrink: 0; /* No se encoge si el texto es largo */
}

/* Estado de foco en el input (radio/checkbox) */
.opcion input[type="radio"]:focus,
.opcion input[type="checkbox"]:focus {
  /* No necesitas outline aquÃ­ si .opcion:focus-within lo maneja todo */
  /* outline: 2px solid var(--color-outline-focus); */
  /* outline-offset: 2px; */
  /* Es mejor depender del focus en el label padre (.opcion:focus-within) */
}

/* Label de la opciÃ³n (el texto descriptivo) */
.opcion label {
  font-weight: var(--font-weight-normal); /* Peso de fuente normal */
  color: var(--color-text-secondary); /* Color secundario */
  cursor: pointer; /* Muestra que es clickable */
  /* Permite que el texto ocupe el resto del espacio disponible */
  flex-grow: 1;
  line-height: 1.5; /* LÃ­nea mÃ¡s cÃ³moda para lectura */
  user-select: none; /* Evita seleccionar texto accidentalmente al hacer click */
}

/* Opcional: Efecto visual en el label cuando el input asociado estÃ¡ seleccionado */
.opcion input[type="radio"]:checked + label,
.opcion input[type="checkbox"]:checked + label {
  color: var(--color-primary); /* Cambia el color del texto al seleccionar */
  font-weight: var(--font-weight-medium); /* Opcional: Ponerlo en negrita */
}
/* ===== PREGUNTAS ===== */
.pregunta-item {
  background: var(--color-surface);
  padding: 18px;
  border-radius: var(--border-radius);
  margin: 1.2rem 0;
  box-shadow: var(--shadow);
  border-left: 4px solid var(--color-primary);
}

.pregunta-item p {
  margin: 0 0 12px;
  font-weight: 600;
  font-size: 1.1rem;
}

.opcion {
  display: block;
  margin: 8px 0;
}

.opcion input {
  margin-right: 10px;
  width: auto;
  accent-color: var(--color-primary);
}

.opcion label {
  font-weight: normal;
  color: var(--color-text-secondary);
  cursor: pointer;
}


	  /* ===== RESULTADOS (Modernos, Visuales e Inclusivos) ===== */

/* Contenedor principal de los resultados */
#resultado {
  display: none; /* Se mostrarÃ¡ con JS */
  background: var(--color-surface); /* Fondo blanco para contraste */
  padding: var(--spacing-xl); /* Espacio interno generoso */
  border-radius: var(--border-radius); /* Bordes redondeados consistentes */
  margin: var(--spacing-xl) 0; /* Espacio superior/inferior */
  /* Sombra para destacar la tarjeta */
  box-shadow: var(--shadow-md);
  /* Borde sutil con color de Ã©nfasis */
  border: var(--border);
  /* TransiciÃ³n suave si se anima al aparecer */
  transition: opacity 0.3s ease, transform 0.2s ease;
  /* Opcional: Agregar una animaciÃ³n de apariciÃ³n */
  animation: fadeInUp 0.4s ease-out;
}

/* AnimaciÃ³n para la apariciÃ³n del resultado */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* TÃ­tulo de la secciÃ³n de resultados */
#resultado > h2 {
  margin-top: 0; /* Elimina margen superior predeterminado */
  margin-bottom: var(--spacing-md); /* Espacio inferior */
  color: var(--color-primary); /* Color de Ã©nfasis */
  font-weight: var(--font-weight-bold); /* Fuente mÃ¡s fuerte */
  font-size: var(--font-size-xl); /* TamaÃ±o mayor */
  text-align: center; /* Centrado */
  border-bottom: 2px solid var(--color-primary); /* LÃ­nea decorativa */
  padding-bottom: var(--spacing-xs); /* Espacio bajo el tÃ­tulo */
}

/* Contenedor especÃ­fico para las recomendaciones */
#recomendaciones {
  margin-top: var(--spacing-lg); /* Espacio superior */
}

/* SubtÃ­tulo dentro de recomendaciones */
#recomendaciones h3 {
  margin-top: 0; /* No hay margen superior si es el primer elemento */
  margin-bottom: var(--spacing-sm); /* Espacio inferior */
  color: var(--color-text); /* Color de texto principal */
  font-weight: var(--font-weight-semibold); /* Fuente medio-fuerte */
  font-size: var(--font-size-lg); /* TamaÃ±o mayor */
  padding-bottom: var(--spacing-xs); /* Espacio bajo el subtÃ­tulo */
  border-bottom: 1px dashed var(--color-border); /* LÃ­nea divisoria sutil */
}

/* PÃ¡rrafo de recomendaciÃ³n individual */
#recomendaciones p {
  background-color: color-mix(in srgb, var(--color-warning) 10%, transparent); /* Fondo muy sutil con tono de advertencia */
  color: var(--color-text); /* Color de texto principal */
  padding: var(--spacing-md); /* Espacio interno */
  border-radius: var(--border-radius-sm); /* Bordes ligeramente redondeados */
  /* Borde izquierdo con color de advertencia para destacar */
  border-left: 4px solid var(--color-warning);
  font-style: normal; /* Elimina la cursiva */
  line-height: 1.6; /* Altura de lÃ­nea cÃ³moda */
  margin-bottom: var(--spacing-sm); /* Espacio inferior entre pÃ¡rrafos */
  /* Opcional: Icono al inicio */
  /* padding-left: calc(var(--spacing-md) + 1.5em); */
  /* position: relative; */
  /* &::before { content: "ğŸ’¡"; position: absolute; left: var(--spacing-md); top: var(--spacing-md); } */
}

/* Opcional: Estilo especÃ­fico si la recomendaciÃ³n es positiva */
#recomendaciones p.positiva {
  background-color: color-mix(in srgb, var(--color-success) 10%, transparent);
  border-left-color: var(--color-success);
}

/* Opcional: Estilo especÃ­fico si la recomendaciÃ³n es crÃ­tica */
#recomendaciones p.critica {
  background-color: color-mix(in srgb, var(--color-danger) 10%, transparent);
  border-left-color: var(--color-danger);
  color: var(--color-danger);
  font-weight: var(--font-weight-medium);
}


/* ===== INFORME GLOBAL (en nueva ventana - Estilo consistente con Healthy Friday) ===== */
/* Este CSS se aplica a la ventana emergente generada por JS */
.informe-global {
  font-family: var(--font-main); /* TipografÃ­a consistente */
  padding: var(--spacing-lg); /* Espacio interno */
  background: var(--color-bg); /* Fondo consistente */
  color: var(--color-text); /* Color de texto consistente */
  /* Opcional: Ancho mÃ¡ximo para mejor lectura en pantallas grandes */
  max-width: var(--max-width-content);
  margin: 0 auto;
  /* Asegura que el fondo se extienda */
  min-height: 100vh;
}

.informe-global h2 {
  text-align: center; /* Centrado */
  color: var(--color-primary); /* Color de Ã©nfasis */
  margin-bottom: var(--spacing-lg); /* Espacio inferior */
  font-weight: var(--font-weight-bold); /* Fuente mÃ¡s fuerte */
  font-size: var(--font-size-2xl); /* TamaÃ±o mayor */
  padding-bottom: var(--spacing-xs); /* Espacio bajo el tÃ­tulo */
  border-bottom: 3px solid var(--color-primary); /* LÃ­nea decorativa */
}

.informe-global h3 {
  background: var(--color-surface); /* Fondo blanco para el encabezado de secciÃ³n */
  color: var(--color-text); /* Color de texto */
  padding: var(--spacing-sm) var(--spacing-md); /* Espacio interno */
  border-radius: var(--border-radius-sm); /* Bordes ligeramente redondeados */
  margin: var(--spacing-lg) 0 var(--spacing-md) 0; /* Espacio alrededor */
  /* Sombra sutil para destacar */
  box-shadow: var(--shadow-sm);
  font-weight: var(--font-weight-semibold); /* Fuente medio-fuerte */
  font-size: var(--font-size-lg); /* TamaÃ±o mayor */
  border-left: 3px solid var(--color-primary); /* LÃ­nea de Ã©nfasis */
}

.informe-global ul {
  padding-left: var(--spacing-lg); /* SangrÃ­a para la lista */
  margin: var(--spacing-md) 0; /* Espacio arriba y abajo */
}

.informe-global li {
  margin-bottom: var(--spacing-sm); /* Espacio entre elementos de la lista */
  line-height: 1.6; /* Altura de lÃ­nea cÃ³moda */
  padding: var(--spacing-xs) 0; /* Espacio vertical pequeÃ±o */
}

/* Estilo para elementos de alerta dentro del informe */
.informe-global .alerta {
  color: var(--color-danger); /* Color rojo para alertas */
  font-weight: var(--font-weight-semibold); /* Fuente medio-fuerte */
  display: inline-block; /* Opcional: para que el color no ocupe toda la lÃ­nea */
  margin-top: var(--spacing-xs); /* Espacio superior si es necesario */
}

/* Estilo para elementos positivos dentro del informe */
.informe-global .positivo {
  color: var(--color-success); /* Color verde para positivos */
  font-weight: var(--font-weight-semibold); /* Fuente medio-fuerte */
  display: inline-block; /* Opcional: para que el color no ocupe toda la lÃ­nea */
  margin-top: var(--spacing-xs); /* Espacio superior si es necesario */
}

/* ===== ACCESIBILIDAD Y ENFOQUE ===== */
@media (prefers-reduced-motion: reduce) {
  #resultado,
  #resultado * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  .informe-global,
  .informe-global * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ===== IMPRESIÃ“N ===== */
@media print {
  .btn,
  .btn-volver,
  .menu a,
  .btn-informe-global, /* Asegura ocultar tambiÃ©n el botÃ³n de informe global */
  #btn-importar-csv /* Y el botÃ³n de importar CSV */
  {
    display: none !important;
  }

  body,
  .test-container,
  #resultado,
  .informe-global /* Aplica a la ventana de informe tambiÃ©n */
  {
    background: white !important;
    color: black !important;
    box-shadow: none !important;
    border: 1px solid #000 !important; /* Opcional: borde nÃ­tido en impresiÃ³n */
  }

  #resultado,
  .informe-global {
    padding: var(--spacing-md); /* Ajustar padding para impresiÃ³n */
    margin: var(--spacing-sm) 0; /* Ajustar margen para impresiÃ³n */
    /* Romper pÃ¡gina antes de cada secciÃ³n de resultado (opcional) */
    /* page-break-before: always; */
  }

  /* Opcional: Evitar que se corte una secciÃ³n en medio al imprimir */
  .informe-global h3 {
    page-break-after: avoid;
  }
  .informe-global ul,
  .informe-global p {
    page-break-inside: avoid;
  }
}

/* ===== RESPONSIVE ===== */
@media (max-width: 600px) {
  /* Ajustes para la secciÃ³n de resultados */
  #resultado {
    padding: var(--spacing-lg); /* Menos padding en mÃ³vil */
    margin: var(--spacing-lg) var(--spacing-sm); /* Margen lateral */
  }

  #resultado > h2 {
    font-size: var(--font-size-xl); /* TÃ­tulo ligeramente mÃ¡s pequeÃ±o */
  }

  #recomendaciones h3 {
    font-size: var(--font-size-base); /* SubtÃ­tulo mÃ¡s pequeÃ±o */
  }

  #recomendaciones p {
    padding: var(--spacing-sm); /* Menos padding */
    font-size: var(--font-size-sm); /* Texto ligeramente mÃ¡s pequeÃ±o */
  }

  /* Ajustes para el informe global */
  .informe-global {
    padding: var(--spacing-md); /* Menos padding */
  }

  .informe-global h2 {
    font-size: var(--font-size-xl); /* TÃ­tulo mÃ¡s pequeÃ±o */
  }

  .informe-global h3 {
    font-size: var(--font-size-lg); /* SubtÃ­tulo mÃ¡s pequeÃ±o */
    padding: var(--spacing-xs) var(--spacing-sm); /* Menos padding */
  }

  .informe-global ul {
    padding-left: var(--spacing-md); /* Menos sangrÃ­a */
  }
}
  </style>

  <!-- Firebase SDK (versiÃ³n 8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>

  <!-- MenÃº principal -->
  <!-- ğŸ”— BotÃ³n de navegaciÃ³n aÃ±adido -->

  <div id="menu" class="menu">
    <header><h1>Healthy Friday - Estaciones</h1></header>
	  
    <main>
		 <!-- BotÃ³n para importar CSV -->
		
		<!-- Dentro del <form id="form-datos"> -->
		<!-- Antes del resto de campos -->
		<div id="import-csv-section" style="display: none;"> <!-- Oculto por defecto -->
		<!-- Dentro del <form id="form-datos">, antes del resto de campos o justo despuÃ©s del botÃ³n de importar si ya lo tienes -->
		<input type="file" id="filePickerCSV" accept=".csv" style="display: none;">
		<button type="button" id="btn-importar-csv" onclick="abrirSelectorYVerificarContraseÃ±a()">ğŸ” Importar Lista de Alumnos (CSV)</button>
		</div>
<!-- ... resto de campos (curso, edad, sexo) ... -->
      <h2>Selecciona el test de esta estaciÃ³n:</h2>
      <ul>
        <li><a href="#" onclick="cargarTest('postura')">Estacion 1: Higiene Postural</a></li>
        <li><a href="#" onclick="cargarTest('actividad')">Estacion 2: Actividad FÃ­sica</a></li>
        <li><a href="#" onclick="cargarTest('azucar')">Estacion 3: AzÃºcar y AlimentaciÃ³n</a></li>
        <li><a href="#" onclick="cargarTest('alimentacion')">Estacion 4: HÃ¡bitos Alimenticios</a></li>
        <li><a href="#" onclick="cargarTest('composicion')">EstaciÃ³n 5: ComposiciÃ³n Corporal</a></li>
        <li><a href="#" onclick="cargarTest('medioambiente')">Estacion 6: Cuidado Medioambiental</a></li>
        <li><a href="#" onclick="cargarTest('espalda')">EstaciÃ³n 7: Higiene de la Espalda</a></li>
        <li><a href="#" onclick="cargarTest('fuerza')">EstaciÃ³n 8: Deporte y Fuerza</a></li>
        <li><a href="#" onclick="cargarTest('sueno')">EstaciÃ³n 9: HÃ¡bitos de SueÃ±o (Padres)</a></li>
        <li><a href="#" onclick="cargarTest('relajacion')">EstaciÃ³n 10: RelajaciÃ³n</a></li>
      </ul>
     <button class="btn btn-informe-global" onclick="generarInformeAnalitico()">ğŸ“Š Informe Global por Curso y Sexo</button>
	      <a href="https://fermagil.github.io/Nutri_Plan_v2/salud-escolar.html" target="_blank" class="btn-volver" style="display: block; text-align: center; margin-top: 20px; text-decoration: none; width: 100%;">
      ğŸ« Ir a Programa Salud Escolar
    </a>
    </main>
  </div>

  <!-- Formulario de test -->
  <div id="test" style="display:none;" class="test-container">
    <header><h1 id="titulo-test">Test</h1></header>
    
   <form id="form-datos">
	  <label for="codigoAlumno">CÃ³digo de alumno:</label>
	  <select id="codigoAlumno" required>
	    <option value="">-- Importa la lista de alumnos --</option>
	    <!-- Las opciones se llenarÃ¡n dinÃ¡micamente -->
	  </select>
	 
	
	  <label for="curso">Curso:</label>
	  <select id="curso" required>
	    <option value="">-- Selecciona --</option>
	    <option value="1Âº ESO">1Âº ESO</option>
	    <option value="2Âº ESO">2Âº ESO</option>
	    <option value="3Âº ESO">3Âº ESO</option>
	    <option value="4Âº ESO">4Âº ESO</option>
	    <option value="1Âº BACHILLER">1Âº BACHILLER</option> <!-- Puede mantenerse si es necesario -->
	  </select>
	
	  <label for="edad">Edad:</label>
	  <input type="number" id="edad" min="10" max="18" required>
	
	  <label for="sexo">Sexo:</label>
	  <select id="sexo" required>
	    <option value="masculino">Masculino</option>
	    <option value="femenino">Femenino</option>
	    <option value="nobinario">No binario</option>
	  </select>
</form>

    <form id="form-preguntas"></form>

    <button class="btn" onclick="calcularResultado()">Calcular Resultado</button>
    <a href="#" class="btn-volver" onclick="mostrarMenu()">â† Volver al menÃº</a>

    <div id="resultado">
      <h2>Resultados</h2>
      <p><strong>PuntuaciÃ³n total:</strong> <span id="puntaje"></span></p>
      <p><strong>Nivel:</strong> <span id="nivel"></span></p>
      <div id="recomendaciones"></div>
      <br />
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Imprimir Resultados</button>
    </div>
  </div>

<script type="module">
  // 1. Importar Firebase
 
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, getDocs, addDoc, query, where, orderBy, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"; // AsegÃºrate de que 'doc', 'getDoc', 'setDoc' estÃ©n aquÃ­


  // 2. ConfiguraciÃ³n de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyChC7s5NN-z-dSjqeXDaks7gaNaVCJAu7Q",
    authDomain: "nutriplanv2.firebaseapp.com",
    projectId: "nutriplanv2",
    storageBucket: "nutriplanv2.firebasestorage.app",
    messagingSenderId: "653707489758",
    appId: "1:653707489758:web:9133d1d1620825c385ed4f",
    measurementId: "G-NWER69E8B6"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // 3. Datos de los tests (sin cambios)
  const tests = {
    postura: {
      titulo: "Higiene Postural",
      preguntas: [
        "Â¿Mantienes una postura erguida en clase, con espalda apoyada y pies en el suelo?",
        "Â¿Llevas la mochila correctamente, con ambas correas y ajustada a la espalda, sin exceder el 10% de tu peso?",
        "Â¿Usas ordenadores o telÃ©fonos con la pantalla a la altura de los ojos, evitando encorvarte?",
        "Â¿Haces pausas para estirarte durante sesiones prolongadas en clase o frente a pantallas?",
        "Â¿Evitas posturas asimÃ©tricas, como cruzar piernas o inclinarte al usar dispositivos?"
      ],
      recomendaciones: [
        "Comienza con lo bÃ¡sico: Pesa tu mochila y asegÃºrate de no exceder el 10% de tu peso; ajusta correas. Corrige postura en clase y eleva pantallas.",
        "EnfÃ³cate en rutina: Usa soportes para evitar encorvamiento. Haz pausas activas cada hora.",
        "Avanza: Incorpora estiramientos diarios y corrige posturas asimÃ©tricas. Monitorea tu mochila semanalmente.",
        "Refina: EnseÃ±a a otros sobre higiene postural. Usa recordatorios visuales.",
        "Excelente: Lidera talleres y comparte buenos hÃ¡bitos."
      ]
    },
    actividad: {
      titulo: "Actividad FÃ­sica",
      preguntas: [
        "Â¿Realizas al menos 60 minutos de actividad fÃ­sica diaria (caminar, bailar, etc.)?",
        "Â¿Evitas periodos prolongados de sedentarismo, levantÃ¡ndote cada hora?",
        "Â¿Participas en juegos divertidos como Just Dance u otros para hacer AF?",
        "Â¿Incluyes variedad: fuerza, flexibilidad y cardio en tu AF semanal?",
        "Â¿Priorizas AF para mantener un cuerpo en forma y una mente calmada?"
      ],
      recomendaciones: [
        "Comienza: Camina 30 min + juega 30 min. Usa Just Dance para motivarte.",
        "EnfÃ³cate: Rompe el sedentarismo cada hora. Apunta a 60 min diarios.",
        "Avanza: VarÃ­a con fuerza y flexibilidad. Ãšnete a grupos.",
        "Refina: Usa apps para tracking. EnseÃ±a a otros.",
        "Excelente: Lidera sesiones y explora yoga o ciclismo."
      ]
    },
    azucar: {
      titulo: "AzÃºcar y AlimentaciÃ³n",
      preguntas: [
        "Â¿Evitas bebidas azucaradas como refrescos, energÃ©ticas o jugos procesados?",
        "Â¿Reemplazas golosinas o bebidas dulces por opciones naturales como fruta?",
        "Â¿Lees etiquetas de productos para verificar el contenido de azÃºcares aÃ±adidos?",
        "Â¿Consumes menos de una bebida azucarada por semana?",
        "Â¿Sigues guÃ­as como las de la OMS para limitar azÃºcares libres?"
      ],
      recomendaciones: [
        "Comienza: Elimina una bebida azucarada diaria. Reemplaza por agua o fruta.",
        "EnfÃ³cate: Limita a 1 bebida azucarada/semana. Lee etiquetas.",
        "Avanza: Elige productos con 0g azÃºcar aÃ±adido. Monitorea tu consumo.",
        "Refina: Organiza chequeos de salud. EnseÃ±a sobre equivalentes de azÃºcar.",
        "Excelente: Lidera campaÃ±as contra bebidas azucaradas."
      ]
    },
    alimentacion: {
      titulo: "HÃ¡bitos Alimenticios",
      preguntas: [
        "Â¿Consumes al menos cinco piezas de fruta o raciones de verdura al dÃ­a?",
        "Â¿Reemplazas golosinas o snacks procesados por opciones naturales como fruta?",
        "Â¿Eliges comida real (frutas, verduras, proteÃ­nas frescas) sobre sustancias comestibles?",
        "Â¿Sigues el Plato de Harvard: mitad vegetales, cuarto granos, cuarto proteÃ­nas?",
        "Â¿Incorporas frutas como postre o snack saludable en tu rutina diaria?"
      ],
      recomendaciones: [
        "Comienza: Cambia una golosina por fruta. AÃ±ade una ensalada diaria.",
        "EnfÃ³cate: Prepara snacks de fruta. Agrega verduras a cada comida.",
        "Avanza: Cocina platos reales. Evita bebidas azucaradas.",
        "Refina: Experimenta con recetas del Plato de Harvard.",
        "Excelente: Lidera grupos de alimentaciÃ³n saludable."
      ]
    },
    composicion: {
      titulo: "ComposiciÃ³n Corporal",
      preguntas: [
        "Â¿Consumes una dieta equilibrada con al menos 5 porciones de frutas y verduras al dÃ­a?",
        "Â¿Controlas las porciones de comida y evitas comer en exceso?",
        "Â¿Realizas actividad fÃ­sica regular (al menos 150 minutos semanales)?",
        "Â¿Bebes suficiente agua (al menos 2 litros al dÃ­a) y limitas bebidas azucaradas?",
        "Â¿Duermes entre 7-9 horas por noche?"
      ],
      recomendaciones: [
        "Comienza: Calcula tu IMC. Camina 30 min diarios. Reduce porciones.",
        "EnfÃ³cate: Registra tu ingesta. Agrega fuerza 2-3 veces/semana.",
        "Avanza: Mide circunferencias. Integra dieta mediterrÃ¡nea.",
        "Refina: Haz chequeos anuales. EnseÃ±a sobre sobrepeso en EspaÃ±a.",
        "Excelente: Lidera grupos de nutriciÃ³n."
      ]
    },
    medioambiente: {
      titulo: "Cuidado Medioambiental",
      preguntas: [
        "Â¿Recoges papeles o basura del suelo y los tiras a la papelera?",
        "Â¿Evitas tirar basura en el suelo, incluso si no hay papelera cerca?",
        "Â¿Separas residuos reciclables (papel, plÃ¡stico) antes de desecharlos?",
        "Â¿Usas productos reutilizables (botellas, bolsas) en lugar de desechables?",
        "Â¿Participas en actividades de limpieza o brigadas verdes?"
      ],
      recomendaciones: [
        "Comienza: Lleva siempre la basura a la papelera. Recoge 5 papeles diarios.",
        "EnfÃ³cate: Separa reciclables. Organiza limpiezas semanales.",
        "Avanza: Crea carteles ambientales. Reporta papeleras llenas.",
        "Refina: Lidera plantaciones. EnseÃ±a sobre impacto del littering.",
        "Excelente: Organiza eventos de Brigada Verde mensuales."
      ]
    },
    espalda: {
      titulo: "Higiene de la Espalda",
      preguntas: [
        "Â¿Realizas estiramientos diarios para los isquiotibiales y la espalda?",
        "Â¿Mantienes una postura correcta al sentarte o estar de pie?",
        "Â¿Evitas cargar mochilas pesadas o distribuir el peso de manera desigual?",
        "Â¿Realizas pausas para estirarte durante periodos largos sentado?",
        "Â¿Duermes en una posiciÃ³n que apoye la curvatura natural de la espalda?"
      ],
      recomendaciones: [
        "Comienza: Estira isquios diarios. Evita mochilas pesadas.",
        "EnfÃ³cate: Corrige postura con recordatorios. Haz pausas activas.",
        "Avanza: Mide flexibilidad semanal. Usa almohadas de apoyo al dormir.",
        "Refina: Organiza chequeos posturales. EnseÃ±a sobre acortamiento de isquios.",
        "Excelente: Lidera grupos de higiene postural."
      ]
    },
    fuerza: {
      titulo: "Deporte y Fuerza",
      preguntas: [
        "Â¿Practicas ejercicios de fuerza (flexiones, sentadillas) al menos 2-3 veces por semana?",
        "Â¿Incorporas deporte en tu rutina diaria para mejorar la fuerza?",
        "Â¿Evitas el sedentarismo prolongado?",
        "Â¿Sigues una dieta que apoye el desarrollo de fuerza, con proteÃ­nas adecuadas?",
        "Â¿Participas en actividades que reduzcan el estrÃ©s, como el deporte?"
      ],
      recomendaciones: [
        "Comienza: Haz 10 flexiones diarias. Camina 30 min.",
        "EnfÃ³cate: Agrega 20 min de fuerza, 3 veces/semana.",
        "Avanza: Usa normogramas AVENA. VarÃ­a con cardio y fuerza.",
        "Refina: Ajusta dieta. EnseÃ±a sobre fuerza y salud mental.",
        "Excelente: Lidera grupos de deporte."
      ]
    },
    sueno: {
      titulo: "HÃ¡bitos de SueÃ±o (Padres)",
      preguntas: [
        "Â¿Se acuesta mÃ¡s o menos a la misma hora todas las noches?",
        "Â¿Le cuesta mucho dormirse (mÃ¡s de 30 min)?",
        "Â¿Duerme entre 9 y 12 horas por noche?",
        "Â¿Se despierta varias veces sin razÃ³n?",
        "Â¿Usa pantallas menos de 1 hora antes de dormir?"
      ],
      recomendaciones: [
        "Es urgente mejorar: Establece horario fijo, elimina pantallas 1h antes. Consulta al pediatra si no mejora.",
        "Vas por buen camino: Reduce pantallas, asegura 9â€“12 h de sueÃ±o.",
        "Â¡Muy bien! Solo ajusta detalles: mantÃ©n rutina sin pantallas.",
        "Tu hijo/a tiene hÃ¡bitos ejemplares. Â¡Sigue asÃ­!"
      ],
      tipo: "binario",
      invertidas: [1, 3, 4] // Ã­ndices base 0: preguntas 2, 4, 5 â†’ favorables = "No"
    },
    relajacion: {
      titulo: "RelajaciÃ³n",
      preguntas: [
        "Â¿Dedicas al menos 30 minutos al dÃ­a a actividades sin pantallas?",
        "Â¿Evitas el uso de dispositivos electrÃ³nicos al menos 1 hora antes de dormir?",
        "Â¿Practicas tÃ©cnicas de respiraciÃ³n profunda o meditaciÃ³n diaria?",
        "Â¿Limitas el tiempo en redes sociales para evitar el estrÃ©s?",
        "Â¿Buscas entornos naturales o tranquilos, lejos de pantallas?"
      ],
      recomendaciones: [
        "Comienza: Establece 30 min diarios sin pantallas. Prueba respiraciÃ³n 4-6 seg.",
        "EnfÃ³cate: Silencia notificaciones despuÃ©s de las 8 PM. Usa journaling.",
        "Avanza: Crea zonas sin pantallas en casa. Apunta a <2h recreativas/dÃ­a.",
        "Refina: Organiza 'dÃ­as offline'. EnseÃ±a sobre luz azul y melatonina.",
        "Excelente: Lidera grupos de relajaciÃ³n. Promueve alternativas analÃ³gicas."
      ]
    }
  };

  // 4. Variables globales
  let testActual = null;
let listaDeAlumnos = [];
// --- FUNCIÃ“N parseCSV DEFINIDA DENTRO DEL MÃ“DULO ---
  function parseCSV(csvText) {
    // Asumiendo estructura fija: NRE, nÂº, curso, ap1, ap2, name
    const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== '');
    if (lines.length < 2) {
      throw new Error("El archivo CSV estÃ¡ vacÃ­o o no tiene encabezados.");
    }
    const headers = lines[0].split(',').map(h => h.trim());

    // Opcional: Validar encabezados
    const expectedHeaders = ['NRE', 'nÂº', 'curso', 'ap1', 'ap2', 'name'];
    // if (!expectedHeaders.every(h => headers.includes(h))) {
    //    throw new Error("El archivo CSV no tiene las columnas esperadas: " + expectedHeaders.join(', '));
    // }

    const alumnos = [];
    for (let i = 1; i < lines.length; i++) {
      const values = lines[i].split(',').map(v => v.trim());
      const alumno = {};
      headers.forEach((header, index) => {
        alumno[header] = values[index] || '';
      });
      alumnos.push(alumno);
    }
    return alumnos;
  }
	
  // 5. FunciÃ³n para cargar contadores (solo si el usuario tiene rol)
  async function loadCounters() {
    // Verificar rol antes de leer
    const user = auth.currentUser;
    if (!user) return;
    const token = await user.getIdTokenResult();
    if (token.claims.rol !== "salud_escolar") return;

    try {
      const snapshot = await getDocs(collection(db, "resultadosHealthyFriday"));
      const count = snapshot.size;
      // Si tienes un elemento en tu HTML para mostrar este contador, descomenta y cÃ¡mbialo:
      // document.getElementById('contadorHF').textContent = count; // Asume que tienes <span id="contadorHF">0</span>
      console.log(`Total resultados Healthy Friday: ${count}`); // Opcional: para debug
    } catch (error) {
      console.error("Error al cargar contadores de Healthy Friday:", error);
    }
  }

  // 6. Funciones de UI (sin cambios en lÃ³gica, solo expuestas globalmente)
  function mostrarMenu() {
    document.getElementById('menu').style.display = 'block';
    document.getElementById('test').style.display = 'none';
  }

  function cargarTest(tipo) {
    const test = tests[tipo];
    if (!test) return;

    testActual = tipo;
    document.getElementById('titulo-test').textContent = test.titulo;
    document.getElementById('form-preguntas').innerHTML = '';

    if (test.tipo === 'binario') {
      document.querySelector('.sueno-nota')?.remove();
      const nota = document.createElement('div');
      nota.className = 'sueno-nota';
      nota.innerHTML = '<strong>Â¡Importante!</strong> En las preguntas 2, 8 y 10, la respuesta favorable es â€œNoâ€. En las demÃ¡s, es â€œSÃ­â€.';
      document.getElementById('form-datos').after(nota);
    }

    test.preguntas.forEach((pregunta, i) => {
      const div = document.createElement('div');
      div.className = 'pregunta-item';
      div.innerHTML = `<p><strong>${i + 1}.</strong> ${pregunta}</p>`;

      if (test.tipo === 'binario') {
        div.innerHTML += `
          <div class="opcion">
            <label><input type="radio" name="q${i}" value="si" required> SÃ­</label>
          </div>
          <div class="opcion">
            <label><input type="radio" name="q${i}" value="no" required> No</label>
          </div>
        `;
      } else {
        const opciones = ['Nunca', 'Rara vez', 'A veces', 'Frecuentemente', 'Siempre'];
        opciones.forEach((texto, idx) => {
          div.innerHTML += `
            <div class="opcion">
              <label><input type="radio" name="q${i}" value="${idx + 1}" required> ${idx + 1}: ${texto}</label>
            </div>
          `;
        });
      }

      document.getElementById('form-preguntas').appendChild(div);
    });

    document.getElementById('menu').style.display = 'none';
    document.getElementById('test').style.display = 'block';
    document.getElementById('resultado').style.display = 'none';
  }

  // 7. FunciÃ³n para calcular y guardar resultados (actualizada)
  async function calcularResultado() {
    const test = tests[testActual];
    let total = 0;
    const respuestas = {};

    if (test.tipo === 'binario') {
      test.preguntas.forEach((_, i) => {
        const si = document.querySelector(`input[name="q${i}"][value="si"]:checked`);
        const no = document.querySelector(`input[name="q${i}"][value="no"]:checked`);
        if (!si && !no) {
          alert("Por favor responde todas las preguntas.");
          return;
        }
        const valor = si ? 'si' : 'no';
        respuestas[`q${i + 1}`] = valor;
        const esInvertida = test.invertidas.includes(i);
        if ((si && !esInvertida) || (no && esInvertida)) {
          total += 1;
        }
      });
      let nivel, recIndex;
      if (total <= 2) { nivel = "Mal hÃ¡bito"; recIndex = 0; }
      else if (total <= 3) { nivel = "A mejorar"; recIndex = 1; }
      else if (total <= 4) { nivel = "Bueno"; recIndex = 2; }
      else { nivel = "Excelente"; recIndex = 3; }
      document.getElementById('puntaje').textContent = `${total} / 5`;
      document.getElementById('nivel').textContent = nivel;
      document.getElementById('recomendaciones').innerHTML = `<h3>Recomendaciones:</h3><p>${test.recomendaciones[recIndex]}</p>`;
    } else {
      test.preguntas.forEach((_, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (!selected) {
          alert("Por favor responde todas las preguntas.");
          return;
        }
        const valor = parseInt(selected.value);
        respuestas[`q${i + 1}`] = valor;
        total += valor;
      });
      let nivel, recIndex;
      if (total <= 7) { nivel = "Mal hÃ¡bito"; recIndex = 0; }
      else if (total <= 12) { nivel = "Regular"; recIndex = 1; }
      else if (total <= 17) { nivel = "Bueno"; recIndex = 2; }
      else if (total <= 22) { nivel = "Muy bueno"; recIndex = 3; }
      else { nivel = "Excelente"; recIndex = 4; }
      document.getElementById('puntaje').textContent = `${total} / 25`;
      document.getElementById('nivel').textContent = nivel;
      document.getElementById('recomendaciones').innerHTML = `<h3>Recomendaciones:</h3><p>${test.recomendaciones[recIndex]}</p>`;
    }

    // === Guardar en Firestore ===
    const codigoAlumno = document.getElementById('codigoAlumno').value.trim().toUpperCase();
    const curso = document.getElementById('curso').value.trim();
    const edad = parseInt(document.getElementById('edad').value);
    const sexo = document.getElementById('sexo').value;

    if (!codigoAlumno || !curso || !edad || !sexo) {
      alert("Por favor completa todos los datos.");
      return;
    }

    const resultado = {
      codigoAlumno,
      testId: testActual,
      titulo: test.titulo,
      curso,
      edad,
      sexo,
      respuestas,
      puntaje: total,
      nivel: document.getElementById('nivel').textContent,
      fecha: serverTimestamp() // Usar hora del servidor
    };

    try {
      await addDoc(collection(db, "resultadosHealthyFriday"), resultado);
      console.log("âœ… Resultado guardado para:", codigoAlumno, "en test:", testActual);
      // --- Actualizar contadores inmediatamente despuÃ©s de guardar ---
      await loadCounters(); // <- Llama a la funciÃ³n para actualizar
      // ------------------------------------------------------------
    } catch (error) {
      console.error("âŒ Error al guardar:", error);
      alert("Error al guardar. Â¿Hay conexiÃ³n a internet?");
      return;
    }

    document.getElementById('resultado').style.display = 'block';
  }

  // 8. FunciÃ³n para generar informe analÃ­tico (actualizada y completada)
  async function generarInformeAnalitico() {
    // Verificar rol antes de leer
    const user = auth.currentUser;
    if (!user) {
        alert("Usuario no autenticado.");
        window.location.href = 'https://fermagil.github.io/Nutri_Plan_v2/index.html';
        return;
    }
    const token = await user.getIdTokenResult();
    if (token.claims.rol !== "salud_escolar") {
        alert("Acceso denegado: solo profesores autorizados.");
        signOut(auth).then(() => {
            window.location.href = 'https://fermagil.github.io/Nutri_Plan_v2/index.html';
        });
        return;
    }

    try {
      const snapshot = await getDocs(collection(db, "resultadosHealthyFriday"));
      if (snapshot.empty) {
        alert("No hay resultados aÃºn.");
        return;
      }

      // Recopilar todos los resultados
      const todos = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        // Normalizar puntaje a escala 0-100 para comparabilidad
        let puntajeNormalizado;
        if (data.testId === 'sueno') {
          // Test binario: max 5 puntos â†’ escala a 100
          puntajeNormalizado = (data.puntaje / 5) * 100;
        } else {
          // Tests de 5 preguntas: max 25 puntos â†’ escala a 100
          puntajeNormalizado = (data.puntaje / 25) * 100;
        }
        todos.push({ ...data, puntaje100: puntajeNormalizado });
      });

      // [Misma lÃ³gica de cÃ¡lculo del informe analÃ­tico que tenÃ­as antes]
      // --- Inicio de la lÃ³gica de cÃ¡lculo del informe ---
      const alumnos = {};
      todos.forEach(r => {
        if (!alumnos[r.codigoAlumno]) {
          alumnos[r.codigoAlumno] = {
            codigo: r.codigoAlumno,
            curso: r.curso,
            sexo: r.sexo,
            puntajes: [],
            tests: new Set()
          };
        }
        // Evitar duplicados si un alumno repite un test
        if (!alumnos[r.codigoAlumno].tests.has(r.testId)) {
          alumnos[r.codigoAlumno].puntajes.push(r.puntaje100);
          alumnos[r.codigoAlumno].tests.add(r.testId);
        }
      });

      // Calcular promedio por alumno
      const alumnosConPromedio = Object.values(alumnos).map(a => {
        const promedio = a.puntajes.reduce((sum, p) => sum + p, 0) / a.puntajes.length;
        return {
          codigo: a.codigo,
          curso: a.curso,
          sexo: a.sexo,
          promedio,
          completados: a.puntajes.length
        };
      }).filter(a => a.completados >= 5); // Solo alumnos con al menos 5 tests

      if (alumnosConPromedio.length === 0) {
        alert("No hay alumnos con suficientes tests completados.");
        return;
      }

      // === 2. Mejores y peores cursos (por promedio de alumnos en ese curso) ===
      const cursos = {};
      alumnosConPromedio.forEach(a => {
        if (!cursos[a.curso]) cursos[a.curso] = [];
        cursos[a.curso].push(a.promedio);
      });

      const promedioCurso = {};
      for (const [curso, promedios] of Object.entries(cursos)) {
        promedioCurso[curso] = promedios.reduce((sum, p) => sum + p, 0) / promedios.length;
      }

      const cursosOrdenados = Object.entries(promedioCurso)
        .sort((a, b) => b[1] - a[1]);
      const mejorCurso = cursosOrdenados[0];
      const peorCurso = cursosOrdenados[cursosOrdenados.length - 1];

      // === 3. Comparativa global por gÃ©nero ===
      const genero = { masculino: [], femenino: [], nobinario: [] };
      alumnosConPromedio.forEach(a => {
        if (genero[a.sexo]) genero[a.sexo].push(a.promedio);
      });

      const promedioGenero = {};
      for (const [g, promedios] of Object.entries(genero)) {
        if (promedios.length > 0) {
          promedioGenero[g] = promedios.reduce((sum, p) => sum + p, 0) / promedios.length;
        }
      }

      // Determinar gÃ©nero con mejor promedio
      let mejorGenero = null;
      let mejorPromedio = -1;
      for (const [g, prom] of Object.entries(promedioGenero)) {
        if (prom > mejorPromedio) {
          mejorPromedio = prom;
          mejorGenero = g;
        }
      }

      // === 4. Diferencias por gÃ©nero dentro de cada curso ===
      const comparativaPorCurso = {};
      for (const curso of Object.keys(cursos)) {
        const datos = alumnosConPromedio.filter(a => a.curso === curso);
        const generosEnCurso = { masculino: [], femenino: [], nobinario: [] };
        datos.forEach(a => {
          if (generosEnCurso[a.sexo]) generosEnCurso[a.sexo].push(a.promedio);
        });

        comparativaPorCurso[curso] = {};
        for (const [g, promedios] of Object.entries(generosEnCurso)) {
          if (promedios.length > 0) {
            comparativaPorCurso[curso][g] = (promedios.reduce((sum, p) => sum + p, 0) / promedios.length).toFixed(1);
          }
        }
      }

      // === 5. Top 3 alumnos con mejor promedio ===
      const top3 = alumnosConPromedio
        .sort((a, b) => b.promedio - a.promedio)
        .slice(0, 3);
      // --- Fin de la lÃ³gica de cÃ¡lculo del informe ---

      // === 6. Generar HTML del informe ===
      let html = `<h2>ğŸ“Š Informe AnalÃ­tico Healthy Friday</h2>`;
      html += `<p><em>Generado: ${new Date().toLocaleString()}</em></p><hr>`;

      // Mejor y peor curso
      html += `<h3>ğŸ† Mejor y Peor Curso</h3>`;
      html += `<p><strong>Mejor curso:</strong> ${mejorCurso[0]} (${mejorCurso[1].toFixed(1)}%)</p>`;
      html += `<p><strong>Peor curso:</strong> ${peorCurso[0]} (${peorCurso[1].toFixed(1)}%)</p><hr>`;

      // Comparativa por gÃ©nero
      html += `<h3>ğŸ‘¥ Comparativa por GÃ©nero (Global)</h3>`;
      for (const [g, prom] of Object.entries(promedioGenero)) {
        const nombre = g === 'masculino' ? 'Chicos' : g === 'femenino' ? 'Chicas' : 'No binario';
        html += `<p><strong>${nombre}:</strong> ${prom.toFixed(1)}%</p>`;
      }
      const nombreMejorGenero = mejorGenero === 'masculino' ? 'Chicos' : mejorGenero === 'femenino' ? 'Chicas' : 'No binario';
      html += `<p><strong>âœ… Grupo con mejor desempeÃ±o:</strong> ${nombreMejorGenero}</p><hr>`;

      // Diferencias por curso y gÃ©nero
      html += `<h3>ğŸ” Comparativa por Curso y GÃ©nero</h3>`;
      for (const [curso, generos] of Object.entries(comparativaPorCurso)) {
        html += `<h4>${curso}</h4><ul>`;
        for (const [g, prom] of Object.entries(generos)) {
          const nombre = g === 'masculino' ? 'Chicos' : g === 'femenino' ? 'Chicas' : 'No binario';
          html += `<li>${nombre}: ${prom}%</li>`;
        }
        html += `</ul>`;
      }
      html += `<hr>`;

      // Top 3 alumnos
      html += `<h3>ğŸ¥‡ Top 3 Alumnos Destacados</h3>`;
      top3.forEach((alumno, i) => {
        const posicion = ['1Âº', '2Âº', '3Âº'][i];
        const generoTexto = alumno.sexo === 'masculino' ? 'Chico' : alumno.sexo === 'femenino' ? 'Chica' : 'No binario';
        html += `<p><strong>${posicion}:</strong> ${alumno.codigo} (${generoTexto}, ${alumno.curso}) â€“ ${alumno.promedio.toFixed(1)}%</p>`;
      });

      // Abrir en nueva ventana
      const win = window.open('', '_blank');
      win.document.write(`
        <html>
        <head>
          <title>Informe AnalÃ­tico Healthy Friday</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
            h2 { color: #2563eb; text-align: center; }
            h3 { color: #1e293b; margin-top: 24px; }
            h4 { color: #475569; margin-top: 16px; }
            ul { padding-left: 20px; }
            li { margin-bottom: 8px; }
            hr { margin: 24px 0; border: 0; border-top: 1px solid #e2e8f0; }
          </style>
        </head>
        <body>${html}</body>
        </html>
      `);
      win.document.close();

    } catch (error) {
      console.error("Error en informe analÃ­tico:", error);
      alert("No se pudo generar el informe analÃ­tico.");
    }
  }
// --- NUEVAS FUNCIONES PARA GESTIÃ“N DE ALUMNOS ---

// --- FUNCIONES MODIFICADAS PARA USAR FIRESTORE ---

// 1. FunciÃ³n para importar CSV (con contraseÃ±a y guardado en Firestore)
let archivoPendiente = null;

// --- FUNCIÃ“N PARA ABRIR EL SELECTOR DE ARCHIVOS INMEDIATAMENTE ---
function abrirSelectorYVerificarContraseÃ±a() {
  // Al hacer clic en el botÃ³n, inmediatamente se abre el selector de archivos
  // Esto garantiza "user activation".
  const input = document.getElementById('filePickerCSV');
  input.click(); // <-- Este click ocurre inmediatamente tras el click del usuario
}
// --- FUNCIÃ“N PARA PROCESAR EL ARCHIVO SELECCIONADO (ahora con verificaciÃ³n de contraseÃ±a) ---
// Esta funciÃ³n se define una sola vez y se asigna al onchange del input oculto
// Idealmente, esto deberÃ­a suceder una vez al inicializar la pÃ¡gina, si el rol es correcto.
async function procesarArchivoCSVSeleccionado(event) {
  const file = event.target.files[0];
  if (!file) {
      console.log("No se seleccionÃ³ ningÃºn archivo (posiblemente cancelado por el usuario).");
      return; // El usuario cancelÃ³ la selecciÃ³n
  }
// Verificar la contraseÃ±a *despuÃ©s* de que se haya seleccionado un archivo
  const CONTRASENA_CSV = "healthy_Friday_2025";
  const pass = prompt("Introduzca la contraseÃ±a para importar la lista de alumnos:");
  if (pass !== CONTRASENA_CSV) {
    alert("ContraseÃ±a incorrecta. ImportaciÃ³n cancelada.");
    return; // Detener la ejecuciÃ³n si la contraseÃ±a no es vÃ¡lida
  }
	
  try {
    const csvText = await file.text();
    const alumnos = parseCSV(csvText); // Asumiendo que parseCSV estÃ¡ definida como antes

    // --- GUARDAR EN FIRESTORE ---
    // Usar 'db' y 'doc' que deben estar importados en el scope del mÃ³dulo
    // AsegÃºrate de que 'db' sea accesible aquÃ­ (debe estar definido en el scope superior del mÃ³dulo)
    await setDoc(doc(db, "resultadosHealthyFriday", "global"), { alumnosCSV: alumnos }, { merge: true });
    console.log(`âœ… ${alumnos.length} alumnos guardados en Firestore.`);

    // Actualizar la variable local y el select inmediatamente despuÃ©s de guardar
    listaDeAlumnos = alumnos; // Actualizar la lista en memoria
    actualizarSelectCodigos(alumnos);
    alert(`Importados y guardados ${alumnos.length} alumnos correctamente.`);
  } catch (error) {
    console.error("Error al importar o guardar CSV:", error);
    alert(`Error al leer, procesar o guardar el archivo CSV: ${error.message}`);
  }
}


	
//let listaDeAlumnos = []; // Variable global (o de mÃ³dulo) para almacenar la lista cargada
// 2. FunciÃ³n para cargar alumnos desde Firestore (en lugar de localStorage)
// --- FUNCIÃ“N PARA CARGAR DESDE FIRESTORE (una sola vez) ---
async function cargarAlumnosDesdeFirestore() {
  try {
    const docRef = doc(db, "resultadosHealthyFriday", "global");
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();
      // Actualizar la variable global con los datos obtenidos
      listaDeAlumnos = data.alumnosCSV || [];
      console.log(`âœ… ${listaDeAlumnos.length} alumnos cargados en memoria desde Firestore.`);
      actualizarSelectCodigos(listaDeAlumnos);
      return listaDeAlumnos;
    } else {
      console.log("_firestore: No se encontrÃ³ el documento de configuraciÃ³n global._");
      const select = document.getElementById('codigoAlumno');
      select.innerHTML = '<option value="">-- No hay alumnos disponibles --</option>';
      listaDeAlumnos = []; // Asegurar que la lista local tambiÃ©n estÃ© vacÃ­a
      return listaDeAlumnos;
    }
  } catch (error) {
    console.error("Error al cargar alumnos desde Firestore:", error);
    const select = document.getElementById('codigoAlumno');
    select.innerHTML = '<option value="">-- Error al cargar alumnos --</option>';
    listaDeAlumnos = []; // Asegurar que la lista local tambiÃ©n estÃ© vacÃ­a
    return listaDeAlumnos;
  }
}

// 3. FunciÃ³n para actualizar el select de cÃ³digos (sin cambios)
function actualizarSelectCodigos(alumnos) {
  const select = document.getElementById('codigoAlumno');
  select.innerHTML = '<option value="">-- Selecciona un alumno --</option>'; // Limpiar
  alumnos.forEach(alumno => {
    const option = document.createElement('option');
    option.value = alumno.NRE;
    option.textContent = `${alumno.NRE} - ${alumno.name || ''} ${alumno.ap1 || ''} ${alumno.ap2 || ''} (${alumno.curso || 'Curso no especificado'})`;
    select.appendChild(option);
  });
}

// 4. FunciÃ³n para manejar el cambio de selecciÃ³n de alumno (sin cambios)
function onCodigoAlumnoChange() {
  const codigoSeleccionado = document.getElementById('codigoAlumno').value;
  if (!codigoSeleccionado) {
    document.getElementById('curso').value = '';
    document.getElementById('edad').value = '';
    return;
  }
  // Cargar alumnos para encontrar el seleccionado
  // Para mejorar eficiencia, guarda la lista de alumnos en una variable global o en el scope del mÃ³dulo
  // despuÃ©s de cargarla una vez, y Ãºsala aquÃ­.
  // Buscar el alumno en la lista almacenada en memoria, NO en Firestore
  const alumno = listaDeAlumnos.find(a => a.NRE === codigoSeleccionado);
     
     if (alumno) {
     document.getElementById('curso').value = alumno.curso;
     let edadCalculada = '';
     switch(alumno.curso) {
       case '1Âº ESO':
         edadCalculada = 11;
         break;
       case '2Âº ESO':
         edadCalculada = 12;
         break;
       case '3Âº ESO':
         edadCalculada = 13;
         break;
       case '4Âº ESO':
         edadCalculada = 15;
         break;
       default:
         break;
     }
     if (edadCalculada) {
         document.getElementById('edad').value = edadCalculada;
     }
  } else {
     // Opcional: Limpiar si no se encuentra (aunque deberÃ­a existir si estÃ¡ en el select)
     document.getElementById('curso').value = '';
     document.getElementById('edad').value = '';
  }
}

// --- FIN NUEVAS FUNCIONES ---
  // 9. ProtecciÃ³n principal: verificar autenticaciÃ³n y rol
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const token = await user.getIdTokenResult();
      if (token.claims.rol === "salud_escolar") {
        // âœ… Acceso permitido: mostrar menÃº y cargar contadores
        document.getElementById('menu').style.display = 'block'; // Mostrar menÃº inicial
		 
		  document.getElementById('import-csv-section').style.display = 'block'; // Mostrar el botÃ³n de importar
        await loadCounters(); // Cargar contadores al inicio
		  // --- AÃ±adir nuevas funcionalidades ---
			await cargarAlumnosDesdeFirestore(); // Cargar lista desde Firestore
			// AÃ±adir listener al select de cÃ³digo de alumno
			document.getElementById('codigoAlumno').addEventListener('change', onCodigoAlumnoChange);
			// --- Fin nuevas funcionalidades ---
        // Exponer funciones globales para onclick en HTML
		
        window.cargarTest = cargarTest;
        window.calcularResultado = calcularResultado;
        window.generarInformeAnalitico = generarInformeAnalitico;
        window.mostrarMenu = mostrarMenu;
		 window.abrirSelectorYVerificarContraseÃ±a = abrirSelectorYVerificarContraseÃ±a; 
		document.getElementById('filePickerCSV').onchange = procesarArchivoCSVSeleccionado;
		document.getElementById('filePickerCSV').onchange = procesarArchivoCSVSeleccionado;
		  
        window.logout = () => {
          signOut(auth).then(() => {
            window.location.href = 'https://fermagil.github.io/Nutri_Plan_v2/index.html';
          });
        };
      } else {
        // âŒ Sin rol
		document.getElementById('import-csv-section').style.display = 'none'; // Asegurar que estÃ© oculto
        alert("Acceso denegado: solo profesores autorizados.");
        signOut(auth).then(() => {
          window.location.href = 'https://fermagil.github.io/Nutri_Plan_v2/index.html';
        });
      }
    } else {
      // âŒ No autenticado
		document.getElementById('import-csv-section').style.display = 'none'; // Asegurar que estÃ© oculto
      window.location.href = 'https://fermagil.github.io/Nutri_Plan_v2/index.html';
    }
  });

  // 10. Alerta de bases (sin cambios)
  window.addEventListener('DOMContentLoaded', () => {
    const bases = `ğŸ† BASES DEL CONCURSO HEALTHY FRIDAY ğŸ†

â€¢ Cada alumno debe completar los 10 tests (uno por estaciÃ³n).
â€¢ Para participar en el ranking, se requiere haber completado al menos 5 tests.
â€¢ Los 3 alumnos con el promedio mÃ¡s alto (de 0 a 100) recibirÃ¡n un premio.
â€¢ El cÃ³digo de alumno es personal e intransferible.
â€¢ Los resultados se basan en respuestas honestas y responsables.
â€¢ El jurado (equipo docente) se reserva el derecho de verificar la validez de los datos.

Â¡Participa con compromiso y gana reconociendo tus hÃ¡bitos saludables!`;

    alert(bases);
  });
</script>
</body>
</html>
