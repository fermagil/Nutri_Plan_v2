<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Healthy Friday - Estaciones</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 15px;
      background-color: #f9f9f9;
      color: #333;
    }
    header h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
    }
    .menu ul {
      list-style: none;
      padding: 0;
    }
    .menu li {
      margin: 8px 0;
    }
    .menu a {
      display: block;
      padding: 12px;
      background: #3498db;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
    }
    .menu a:hover {
      background: #2980b9;
    }
    .test-container label {
      display: block;
      margin: 12px 0 6px;
      font-weight: bold;
    }
    .test-container input, .test-container select {
      padding: 6px;
      margin-left: 8px;
      font-size: 16px;
      width: 200px;
      max-width: 100%;
    }
    .pregunta-item {
      margin: 16px 0;
      padding: 12px;
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .opcion {
      display: inline-block;
      margin-right: 15px;
      margin-top: 6px;
    }
    .opcion label {
      margin: 0;
      font-weight: normal;
      font-size: 14px;
    }
    #resultado {
      display: none;
      background: #e8f4fc;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid #3498db;
    }
    .btn {
      padding: 10px 20px;
      background: #2ecc71;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    .btn:hover {
      background: #27ae60;
    }
    .btn-volver {
      display: inline-block;
      margin-top: 20px;
      padding: 8px 16px;
      background: #e74c3c;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
    .btn-volver:hover {
      background: #c0392b;
    }
    .sueno-nota {
      background: #fff8e1;
      padding: 12px;
      border-radius: 6px;
      margin: 15px 0;
      border-left: 4px solid #ffc107;
    }
  </style>

  <!-- Firebase SDK (versiÃ³n 8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>

  <!-- MenÃº principal -->
  <div id="menu" class="menu">
    <header><h1>Healthy Friday - Estaciones</h1></header>
    <main>
      <h2>Selecciona el test de esta estaciÃ³n:</h2>
      <ul>
        <li><a href="#" onclick="cargarTest('postura')">Higiene Postural</a></li>
        <li><a href="#" onclick="cargarTest('actividad')">Actividad FÃ­sica</a></li>
        <li><a href="#" onclick="cargarTest('azucar')">AzÃºcar y AlimentaciÃ³n</a></li>
        <li><a href="#" onclick="cargarTest('alimentacion')">HÃ¡bitos Alimenticios</a></li>
        <li><a href="#" onclick="cargarTest('composicion')">ComposiciÃ³n Corporal</a></li>
        <li><a href="#" onclick="cargarTest('medioambiente')">Cuidado Medioambiental</a></li>
        <li><a href="#" onclick="cargarTest('espalda')">Higiene de la Espalda</a></li>
        <li><a href="#" onclick="cargarTest('fuerza')">Deporte y Fuerza</a></li>
        <li><a href="#" onclick="cargarTest('sueno')">HÃ¡bitos de SueÃ±o (Padres)</a></li>
        <li><a href="#" onclick="cargarTest('relajacion')">RelajaciÃ³n</a></li>
      </ul>
      <button class="btn" onclick="generarInformeGlobal()" style="width:100%; margin-top:20px;">ğŸ“Š Informe Global por Curso y Sexo</button>
    </main>
  </div>

  <!-- Formulario de test -->
  <div id="test" style="display:none;" class="test-container">
    <header><h1 id="titulo-test">Test</h1></header>
    
    <form id="form-datos">
      <label>CÃ³digo de alumno: <input type="text" id="codigoAlumno" required placeholder="Ej: ALU-2025-001" autocomplete="off"></label>
      <label>
		  Curso:
		  <select id="curso" required>
			<option value="">-- Selecciona --</option>
			<option value="1Âº ESO">1Âº ESO</option>
			<option value="2Âº ESO">2Âº ESO</option>
			<option value="3Âº ESO">3Âº ESO</option>
			<option value="4Âº ESO">4Âº ESO</option>
			<option value="1Âº BACHILLER">1Âº BACHILLER</option>
		  </select>
		</label>
      <label>Edad: <input type="number" id="edad" min="10" max="18" required></label>
      <label>
        Sexo:
        <select id="sexo" required>
          <option value="masculino">Masculino</option>
          <option value="femenino">Femenino</option>
		  <option value="nobinario">No binario</option>
        </select>
      </label>
    </form>

    <form id="form-preguntas"></form>

    <button class="btn" onclick="calcularResultado()">Calcular Resultado</button>
    <a href="#" class="btn-volver" onclick="mostrarMenu()">â† Volver al menÃº</a>

    <div id="resultado">
      <h2>Resultados</h2>
      <p><strong>PuntuaciÃ³n total:</strong> <span id="puntaje"></span></p>
      <p><strong>Nivel:</strong> <span id="nivel"></span></p>
      <div id="recomendaciones"></div>
      <br />
      <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Imprimir Resultados</button>
    </div>
  </div>

  <script>
    // === ConfiguraciÃ³n de Firebase ===
    const firebaseConfig = {
      apiKey: "AIzaSyChC7s5NN-z-dSjqeXDaks7gaNaVCJAu7Q",
      authDomain: "nutriplanv2.firebaseapp.com",
      projectId: "nutriplanv2",
      storageBucket: "nutriplanv2.firebasestorage.app",
      messagingSenderId: "653707489758",
      appId: "1:653707489758:web:9133d1d1620825c385ed4f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // === Tests completos (10 preguntas cada uno) ===
    const tests = {
      postura: {
        titulo: "Higiene Postural",
        preguntas: [
          "Â¿Mantienes una postura erguida en clase, con espalda apoyada y pies en el suelo?",
          "Â¿Duermes en una posiciÃ³n que respete la curvatura natural de la espalda (ej. de lado con rodillas flexionadas)?",
          "Â¿Usas ordenadores o telÃ©fonos con la pantalla a la altura de los ojos, evitando encorvarte?",
          "Â¿Llevas la mochila correctamente, con ambas correas y ajustada a la espalda, sin exceder el 10% de tu peso?",
          "Â¿Realizas transferencias de peso seguras al levantar objetos, flexionando rodillas en lugar de la espalda?",
          "Â¿Haces pausas para estirarte durante sesiones prolongadas en clase o frente a pantallas?",
          "Â¿Monitoreas el peso de tu mochila regularmente para no sobrecargar tu espalda?",
          "Â¿Consultas carteles o panfletos sobre higiene postural para corregir hÃ¡bitos?",
          "Â¿Incorporas ejercicios de fortalecimiento postural en tu rutina semanal?",
          "Â¿Evitas posturas asimÃ©tricas, como cruzar piernas o inclinarte al usar dispositivos?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Pesa tu mochila y asegÃºrate de no exceder el 10% de tu peso; ajusta correas para distribuciÃ³n pareja. Corrige postura en clase sentÃ¡ndote recto y eleva pantallas. Consulta panfletos para tips en dormir y transferencias de peso.",
          "EnfÃ³cate en rutina: Practica transferencias seguras (flexiona rodillas al levantar). Usa ordenadores con soportes para evitar encorvamiento. Reparte carteles en tu entorno para recordatorios visuales.",
          "Avanza con hÃ¡bitos avanzados: Incorpora estiramientos posturales diarios. Explica a amigos cÃ³mo llevar mochilas correctamente. Monitorea posturas al dormir con almohadas de apoyo.",
          "Refina: Organiza sesiones de asesoramiento postural. Experimenta con dÃ­pticos para educar sobre higiene en telÃ©fonos. EnseÃ±a sobre el 10% de peso mÃ¡ximo en mochilas.",
          "MantÃ©n y expande: Lidera talleres de higiene postural. Explora variaciones como ejercicios para transferencias de peso. Comparte en comunidades sobre prevenciÃ³n de lesiones espinales."
        ]
      },
      actividad: {
        titulo: "Actividad FÃ­sica",
        preguntas: [
          "Â¿Realizas al menos 60 minutos de actividad fÃ­sica diaria (caminar, bailar, etc.)?",
          "Â¿Incorporas AF en tu rutina sin necesidad de deportes formales (ej. subir escaleras, jugar videojuegos activos)?",
          "Â¿Practicas actividades que benefician el cerebro, como AF aerÃ³bica para mejorar la concentraciÃ³n?",
          "Â¿Evitas periodos prolongados de sedentarismo, levantÃ¡ndote cada hora?",
          "Â¿Participas en juegos divertidos como Just Dance u otros para hacer AF?",
          "Â¿Monitoreas tu tiempo de AF diaria para alcanzar los 60 minutos recomendados?",
          "Â¿Incluyes variedad: fuerza, flexibilidad y cardio en tu AF semanal?",
          "Â¿Motivas a otros a unirse a AF regular para un estilo de vida saludable?",
          "Â¿Usas tecnologÃ­a (apps, videojuegos) para hacer AF mÃ¡s entretenida?",
          "Â¿Priorizas AF para mantener un cuerpo en forma y una mente calmada?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Camina 30 minutos diarios y agrega 30 mÃ¡s con actividades simples. Prueba Just Dance para diversiÃ³n. Monitorea para llegar a 60 minutos.",
          "EnfÃ³cate en rutina: Incorpora AF no deportiva como bailar o videojuegos activos. Apunta a 60 minutos diarios para un cerebro sano.",
          "Avanza con hÃ¡bitos avanzados: VarÃ­a con fuerza (pesas) y flexibilidad. Ãšnete a grupos para AF regular y motivaciÃ³n.",
          "Refina: Integra tecnologÃ­a como apps de tracking. EnseÃ±a a otros sobre beneficios de AF sin deportes.",
          "MantÃ©n y expande: Lidera sesiones de AF divertida. Explora opciones como yoga o ciclismo para variedad."
        ]
      },
      azucar: {
        titulo: "AzÃºcar y AlimentaciÃ³n",
        preguntas: [
          "Â¿Evitas bebidas azucaradas como refrescos, energÃ©ticas o jugos procesados, optando por agua o infusiones?",
          "Â¿Controlas tu ingesta diaria de azÃºcar total para no exceder las recomendaciones de la OMS (menos de 50g/dÃ­a)?",
          "Â¿Reemplazas golosinas o bebidas dulces por opciones naturales como fruta o agua con limÃ³n?",
          "Â¿Lees etiquetas de productos para verificar el contenido de azÃºcares aÃ±adidos?",
          "Â¿Consumes menos de una bebida azucarada por semana?",
          "Â¿Equilibras tu dieta con comidas reales bajas en azÃºcar procesado?",
          "Â¿Monitoreas sÃ­ntomas como fatiga o antojos que podrÃ­an indicar exceso de azÃºcar?",
          "Â¿Promueves entre familiares o amigos la reducciÃ³n de bebidas azucaradas?",
          "Â¿Incorporas alternativas saludables como tÃ© sin azÃºcar o agua infundida en tu rutina?",
          "Â¿Sigues guÃ­as como las de la OMS para limitar azÃºcares libres en tu alimentaciÃ³n?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Elimina una bebida azucarada diaria y reemplÃ¡zala por agua. Calcula tu ingesta de azÃºcar semanal y apunta a menos de 50g/dÃ­a segÃºn OMS. Usa apps para rastrear y visualiza equivalentes (ej. una Coca-Cola = 9 cucharaditas de azÃºcar).",
          "EnfÃ³cate en rutina: Limita bebidas azucaradas a una por semana. Incorpora frutas enteras en lugar de jugos. Lee sobre impactos del azÃºcar (diabetes, obesidad) para motivarte.",
          "Avanza con hÃ¡bitos avanzados: Compara etiquetas de bebidas y elige opciones con 0g azÃºcar aÃ±adido. Monitorea tu consumo para staying below 25g/dÃ­a (recomendaciÃ³n ideal OMS).",
          "Refina: Experimenta con infusiones caseras sin azÃºcar. Organiza chequeos de salud para verificar impactos del azÃºcar. EnseÃ±a a otros sobre equivalentes visuales en bebidas comunes.",
          "MantÃ©n y expande: Lidera campaÃ±as contra bebidas azucaradas. Explora variaciones como agua con hierbas. Comparte en comunidades sobre adherencia a OMS para una vida saludable."
        ]
      },
      alimentacion: {
        titulo: "HÃ¡bitos Alimenticios",
        preguntas: [
          "Â¿Consumes al menos cinco piezas de fruta o raciones de verdura/ensalada al dÃ­a?",
          "Â¿Reemplazas golosinas o snacks procesados por opciones naturales como fruta?",
          "Â¿Eliges comida real (frutas, verduras, granos integrales, proteÃ­nas frescas) sobre sustancias comestibles (bollerÃ­a, refrescos, frituras)?",
          "Â¿Sigues el Plato de Harvard: mitad vegetales/frutas, cuarto granos integrales, cuarto proteÃ­nas, con aceites saludables?",
          "Â¿Lees etiquetas para evitar productos altos en azÃºcar aÃ±adido y grasas trans?",
          "Â¿Cocinas comidas caseras con ingredientes reales en lugar de procesados?",
          "Â¿Bebes agua o infusiones en vez de bebidas azucaradas o sustancias bebibles procesadas?",
          "Â¿Equilibras tu dieta comiendo de todo, pero priorizando lo natural y bien cocinado?",
          "Â¿Evitas el exceso de azÃºcar y grasa para prevenir sÃ­ntomas como fatiga, obesidad o problemas digestivos?",
          "Â¿Incorporas frutas como postre o snack saludable en tu rutina diaria?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Cambia una golosina diaria por una pieza de fruta. Aprende sobre sÃ­ntomas del azÃºcar y grasa (fatiga, inflamaciÃ³n, riesgo de diabetes) en panfletos. Incorpora una ensalada al dÃ­a y sigue el Plato de Harvard para comidas equilibradas.",
          "EnfÃ³cate en rutina: Prepara snacks de fruta en lugar de procesados. Diferencia comida real (manzanas frescas) de sustancias comestibles (chocolatinas). Agrega verduras a cada comida principal.",
          "Avanza con hÃ¡bitos avanzados: Monitorea tu ingesta de cinco frutas/verduras diarias. Cocina platos reales bien cocinados (al vapor o asados). Evita bebidas azucaradas por completo.",
          "Refina: Experimenta con recetas basadas en el Plato de Harvard. EnseÃ±a a otros sobre comida real vs. procesados. Organiza 'dÃ­as de fruta' donde solo consumes naturales.",
          "MantÃ©n y expande: Lidera grupos de alimentaciÃ³n saludable. Explora variaciones como smoothies de fruta real. Comparte en comunidades sobre los beneficios de evitar golosinas."
        ]
      },
      composicion: {
        titulo: "ComposiciÃ³n Corporal",
        preguntas: [
          "Â¿Consumes una dieta equilibrada con al menos 5 porciones de frutas y verduras al dÃ­a?",
          "Â¿Controlas las porciones de comida y evitas comer en exceso o por aburrimiento?",
          "Â¿Realizas actividad fÃ­sica regular (al menos 150 minutos semanales de ejercicio moderado)?",
          "Â¿Mides tu peso y IMC periÃ³dicamente para monitorear cambios?",
          "Â¿Evitas alimentos procesados altos en azÃºcares, grasas saturadas y sal?",
          "Â¿Bebes suficiente agua (al menos 2 litros al dÃ­a) y limitas bebidas azucaradas?",
          "Â¿Incluyes proteÃ­nas magras, granos integrales y grasas saludables en tus comidas?",
          "Â¿Duermes entre 7-9 horas por noche, ya que el sueÃ±o afecta la composiciÃ³n corporal?",
          "Â¿Gestionas el estrÃ©s para evitar comer emocionalmente?",
          "Â¿Consultas a un nutricionista o mÃ©dico si notas cambios en tu peso o salud?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Calcula tu IMC hoy y establece metas realistas (pÃ©rdida de 0.5-1 kg/semana si es necesario). Incorpora caminatas diarias de 30 minutos y reduce porciones. Consulta un mÃ©dico para un plan personalizado, considerando el alto Ã­ndice de sobrepeso en EspaÃ±a.",
          "EnfÃ³cate en rutina: Registra tu ingesta diaria con una app. Agrega ejercicios de fuerza 2-3 veces/semana. Limita snacks procesados y prioriza comidas caseras.",
          "Avanza con hÃ¡bitos avanzados: Mide circunferencias corporales (cintura, caderas) mensualmente. Integra una dieta mediterrÃ¡nea, comÃºn en EspaÃ±a pero subutilizada. Monitorea progreso con tablas de IMC por edad.",
          "Refina: Experimenta con seguimiento de macros (proteÃ­nas, carbohidratos, grasas). Organiza chequeos anuales de salud. EnseÃ±a a otros sobre el impacto del sobrepeso en la poblaciÃ³n espaÃ±ola.",
          "MantÃ©n y expande: Lidera grupos de nutriciÃ³n. Explora variaciones como ayuno intermitente (con supervisiÃ³n). Comparte en comunidades sobre prevenciÃ³n de obesidad en la UE."
        ]
      },
      medioambiente: {
        titulo: "Cuidado Medioambiental",
        preguntas: [
          "Â¿Recoges papeles o basura del suelo y los tiras a la papelera en el patio o espacios comunes?",
          "Â¿Separas residuos reciclables (papel, plÃ¡stico) antes de desecharlos?",
          "Â¿Evitas tirar basura en el suelo, incluso si no hay una papelera cerca (llevÃ¡ndola contigo hasta encontrar una)?",
          "Â¿Participas en actividades de limpieza o brigadas verdes en tu escuela o comunidad?",
          "Â¿Recuerdas apagar luces y ahorrar agua para reducir el impacto ambiental?",
          "Â¿Usas productos reutilizables (como botellas de agua o bolsas) en lugar de desechables?",
          "Â¿Promueves entre amigos y familia el cuidado del medio ambiente, como no littering?",
          "Â¿Monitoreas y reduces tu generaciÃ³n de residuos diarios, especialmente en el patio?",
          "Â¿Incorporas hÃ¡bitos como plantar Ã¡rboles o cuidar zonas verdes en tu rutina?",
          "Â¿Sigues normas ambientales, como no pisar Ã¡reas verdes o respetar papeleras?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Siempre lleva basura a la papelera mÃ¡s cercana. Ãšnete a una Brigada Verde escolar. Recoge al menos 5 papeles del patio diariamente y motiva a un amigo a hacerlo.",
          "EnfÃ³cate en rutina: Separa reciclables en casa y escuela. Organiza limpiezas semanales en el patio. Usa recordatorios para no tirar nada al suelo.",
          "Avanza con hÃ¡bitos avanzados: Crea carteles de normas ambientales para el patio. Participa en campaÃ±as de reducciÃ³n de plÃ¡sticos. Monitorea el uso de papeleras y reporta si estÃ¡n llenas.",
          "Refina: Lidera actividades de plantaciÃ³n en zonas verdes. Experimenta con compostaje simple. EnseÃ±a a otros sobre el impacto del littering en la biodiversidad.",
          "MantÃ©n y expande: Organiza eventos de Brigada Verde mensuales. Explora voluntariados ambientales locales. Comparte en redes sobre sostenibilidad escolar."
        ]
      },
      espalda: {
        titulo: "Higiene de la Espalda",
        preguntas: [
          "Â¿Realizas estiramientos diarios para los isquiotibiales y la espalda?",
          "Â¿Mantienes una postura correcta al sentarte o estar de pie, evitando encorvarte?",
          "Â¿Practicas ejercicios de fortalecimiento muscular para la zona lumbar y abdominal al menos 3 veces por semana?",
          "Â¿Evitas cargar mochilas pesadas o distribuir el peso de manera desigual?",
          "Â¿Realizas pausas para estirarte durante periodos largos sentado (como en clases o frente a pantallas)?",
          "Â¿Duermes en una posiciÃ³n que apoye la curvatura natural de la espalda (ej. de lado con rodillas flexionadas)?",
          "Â¿Monitoreas tu flexibilidad, como midiendo el alcance de los isquiotibiales regularmente?",
          "Â¿Consultas a un profesional si sientes dolor o rigidez en la espalda?",
          "Â¿Incorporas actividades como nataciÃ³n o yoga que benefician la higiene postural?",
          "Â¿Sigues recomendaciones para estiramientos saludables, evitando rebotes o forzamientos?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Realiza estiramientos simples de isquios diarios (sentado, alcanza los pies sin forzar). Usa un cajÃ³n de flexibilidad para medir progresos. Consulta un mÃ©dico para descartar escoliosis. Evita posturas prolongadas encorvadas.",
          "EnfÃ³cate en rutina: Incorpora 10 minutos de estiramientos matutinos. Fortalece el core con planks. Monitorea tu postura con recordatorios en el telÃ©fono y ajusta segÃºn normogramas de flexibilidad (como del estudio AVENA).",
          "Avanza con hÃ¡bitos avanzados: Mide tus isquios semanalmente y compara con tablas estÃ¡ndar. Integra yoga o pilates. Corrige hiperlordosis con ejercicios de alineaciÃ³n espinal.",
          "Refina: Experimenta con estiramientos guiados y usa esterillas para sesiones cÃ³modas. Organiza chequeos posturales mensuales. EnseÃ±a a otros sobre el impacto del acortamiento de isquios en la adolescencia.",
          "MantÃ©n y expande: Lidera grupos de higiene postural. Explora variaciones como estiramientos dinÃ¡micos. Comparte en comunidades sobre prevenciÃ³n de escoliosis y hiperlordosis."
        ]
      },
      fuerza: {
        titulo: "Deporte y Fuerza",
        preguntas: [
          "Â¿Practicas ejercicios de fuerza (como flexiones, sentadillas o pesas) al menos 2-3 veces por semana?",
          "Â¿Incorporas deporte en tu rutina diaria para mejorar la fuerza y la salud cardiovascular?",
          "Â¿Mides tu fuerza periÃ³dicamente (ej. con cinta mÃ©trica para circunferencias musculares o tests de resistencia)?",
          "Â¿Evitas el sedentarismo prolongado, optando por actividades que fortalezcan el cuerpo y la mente?",
          "Â¿Sigues una dieta que apoye el desarrollo de fuerza, con proteÃ­nas y nutrientes adecuados?",
          "Â¿Participas en deportes o actividades fÃ­sicas que reduzcan el riesgo de enfermedades mentales, como el estrÃ©s?",
          "Â¿Comparas tu nivel de fuerza con normogramas o tablas estÃ¡ndar para motivarte?",
          "Â¿Consultas a profesionales si notas debilidad o riesgos cardiovasculares?",
          "Â¿Integra ejercicios de fuerza en tu vida cotidiana, como llevar cargas o subir escaleras?",
          "Â¿Promueves el deporte entre amigos para fomentar una mejor salud fÃ­sica y mental?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Realiza ejercicios simples de fuerza 2 veces/semana (ej. 10 flexiones diarias). Mide tu fuerza con cinta mÃ©trica y compara con tablas AVENA. Incorpora caminatas para base cardiovascular.",
          "EnfÃ³cate en rutina: Agrega sesiones de fuerza de 20 minutos, 3 veces/semana. Monitorea progresos para motivarte y reducir riesgos mentales como ansiedad.",
          "Avanza con hÃ¡bitos avanzados: Usa normogramas del estudio AVENA para metas personalizadas. Integra deporte variado para fuerza y salud cardiovascular.",
          "Refina: Experimenta con mediciones avanzadas y ajusta dieta para Ã³ptima recuperaciÃ³n. EnseÃ±a a otros sobre la relaciÃ³n fuerza-salud mental.",
          "MantÃ©n y expande: Lidera grupos de deporte. Explora variaciones como entrenamiento funcional para prevenciÃ³n de enfermedades."
        ]
      },
      sueno: {
        titulo: "HÃ¡bitos de SueÃ±o (Padres)",
        preguntas: [
          "Â¿Se acuesta mÃ¡s o menos a la misma hora todas las noches?",
          "Â¿Le cuesta mucho dormirse (mÃ¡s de 30 min)?",
          "Â¿Tiene una rutina tranquila antes de dormir?",
          "Â¿Su habitaciÃ³n estÃ¡ oscura, silenciosa y fresca?",
          "Â¿Duerme entre 9 y 12 horas por noche?",
          "Â¿Hace ejercicio o juega al aire libre durante el dÃ­a?",
          "Â¿Evita bebidas con cafeÃ­na (refrescos, tÃ© fuerte)?",
          "Â¿Se despierta varias veces sin razÃ³n?",
          "Â¿Se siente descansado/a al despertar?",
          "Â¿Usa pantallas (TV, tablet, celular, videojuegos) menos de 1 hora antes de dormir?"
        ],
        recomendaciones: [
          "Es urgente mejorar los hÃ¡bitos. Establece horario fijo, elimina pantallas 1 h antes de dormir y crea una rutina relajante. Si no mejora en 2 semanas, consulta al pediatra.",
          "Vas por buen camino, pero hay Ã¡reas clave: reduce pantallas nocturnas, asegura 9â€“12 h de sueÃ±o y evita cenas pesadas o cafeÃ­na.",
          "Â¡Muy bien! Solo ajusta detalles: refuerza la rutina sin pantallas y mantÃ©n el horario incluso los fines de semana.",
          "Tu hijo/a tiene hÃ¡bitos ejemplares. Â¡Sigue asÃ­! Comparte estos buenos hÃ¡bitos con otros en casa."
        ],
        tipo: "binario",
        invertidas: [1, 7, 9]
      },
      relajacion: {
        titulo: "RelajaciÃ³n",
        preguntas: [
          "Â¿Practicas tÃ©cnicas de respiraciÃ³n profunda o meditaciÃ³n diaria?",
          "Â¿Dedicas al menos 30 minutos al dÃ­a a actividades sin pantallas (como leer un libro fÃ­sico o caminar)?",
          "Â¿Evitas el uso de dispositivos electrÃ³nicos (celular, computadora, TV) al menos 1 hora antes de dormir?",
          "Â¿Realizas pausas activas durante el dÃ­a para estirarte o desconectar mentalmente?",
          "Â¿Mantienes un horario fijo para dormir y despertar, independientemente de las notificaciones en pantalla?",
          "Â¿Participas en hobbies relajantes como yoga, jardinerÃ­a o escuchar mÃºsica sin interrupciones digitales?",
          "Â¿Limita el tiempo en redes sociales o apps para evitar el estrÃ©s por sobrecarga de informaciÃ³n?",
          "Â¿Practicas el 'escaneo corporal' o mindfulness para identificar tensiones fÃ­sicas?",
          "Â¿Buscas entornos naturales o tranquilos para recargar energÃ­as, lejos de pantallas?",
          "Â¿Incorporas rutinas de gratitud o reflexiÃ³n positiva al final del dÃ­a, sin dispositivos?"
        ],
        recomendaciones: [
          "Comienza con lo bÃ¡sico: Establece un 'detox digital' diario de 30 minutos sin pantallas. Prueba apps de bloqueo como Freedom o Screen Time para limitar el uso. Incorpora caminatas al aire libre y tÃ©cnicas simples de respiraciÃ³n (inhala 4 seg, exhala 6 seg). Busca apoyo profesional si el estrÃ©s es abrumador.",
          "EnfÃ³cate en pantallas: Configura notificaciones silenciosas despuÃ©s de las 8 PM. Agrega una rutina matutina de 10 minutos de mindfulness sin telÃ©fono. Prueba journaling para reflexionar sobre tu dÃ­a, reduciendo el scroll infinito en redes.",
          "Avanza con hÃ¡bitos avanzados: Crea 'zonas sin pantallas' en casa (ej. dormitorio). Integra yoga o tai chi semanal. Monitorea tu tiempo en pantalla con herramientas integradas en tu dispositivo y apunta a menos de 2 horas recreativas al dÃ­a.",
          "Refina: Experimenta con meditaciones guiadas apps como Calm, pero Ãºsalas con moderaciÃ³n para no depender de pantallas. Organiza 'dÃ­as offline' mensuales. EnseÃ±a a otros sobre el impacto de las pantallas en el sueÃ±o (luz azul interfiere con la melatonina).",
          "MantÃ©n y expande: Lidera grupos de relajaciÃ³n. Explora variaciones como mindfulness en movimiento (caminar consciente). Comparte en comunidades sobre cÃ³mo las pantallas afectan la concentraciÃ³n y promueve alternativas analÃ³gicas."
        ]
      }
    };

    let testActual = null;

    function mostrarMenu() {
      document.getElementById('menu').style.display = 'block';
      document.getElementById('test').style.display = 'none';
    }

    function cargarTest(tipo) {
      const test = tests[tipo];
      if (!test) return;

      testActual = tipo;
      document.getElementById('titulo-test').textContent = test.titulo;
      document.getElementById('form-preguntas').innerHTML = '';

      if (test.tipo === 'binario') {
        document.querySelector('.sueno-nota')?.remove();
        const nota = document.createElement('div');
        nota.className = 'sueno-nota';
        nota.innerHTML = '<strong>Â¡Importante!</strong> En las preguntas 2, 8 y 10, la respuesta favorable es â€œNoâ€. En las demÃ¡s, es â€œSÃ­â€.';
        document.getElementById('form-datos').after(nota);
      }

      test.preguntas.forEach((pregunta, i) => {
        const div = document.createElement('div');
        div.className = 'pregunta-item';
        div.innerHTML = `<p><strong>${i + 1}.</strong> ${pregunta}</p>`;

        if (test.tipo === 'binario') {
          div.innerHTML += `
            <div class="opcion">
              <label><input type="radio" name="q${i}" value="si" required> SÃ­</label>
            </div>
            <div class="opcion">
              <label><input type="radio" name="q${i}" value="no" required> No</label>
            </div>
          `;
        } else {
          const opciones = ['Nunca', 'Rara vez', 'A veces', 'Frecuentemente', 'Siempre'];
          opciones.forEach((texto, idx) => {
            div.innerHTML += `
              <div class="opcion">
                <label><input type="radio" name="q${i}" value="${idx + 1}" required> ${idx + 1}: ${texto}</label>
              </div>
            `;
          });
        }

        document.getElementById('form-preguntas').appendChild(div);
      });

      document.getElementById('menu').style.display = 'none';
      document.getElementById('test').style.display = 'block';
      document.getElementById('resultado').style.display = 'none';
    }

    async function calcularResultado() {
      const test = tests[testActual];
      let total = 0;
      const respuestas = {};

      if (test.tipo === 'binario') {
        test.preguntas.forEach((_, i) => {
          const si = document.querySelector(`input[name="q${i}"][value="si"]:checked`);
          const no = document.querySelector(`input[name="q${i}"][value="no"]:checked`);
          if (!si && !no) {
            alert("Por favor responde todas las preguntas.");
            return;
          }
          const valor = si ? 'si' : 'no';
          respuestas[`q${i + 1}`] = valor;
          const esInvertida = test.invertidas.includes(i);
          if ((si && !esInvertida) || (no && esInvertida)) {
            total += 1;
          }
        });
        let nivel, recIndex;
        if (total <= 4) { nivel = "Mal hÃ¡bito"; recIndex = 0; }
        else if (total <= 6) { nivel = "A mejorar"; recIndex = 1; }
        else if (total <= 8) { nivel = "Bueno"; recIndex = 2; }
        else { nivel = "Excelente"; recIndex = 3; }
        document.getElementById('puntaje').textContent = `${total} / 10`;
        document.getElementById('nivel').textContent = nivel;
        document.getElementById('recomendaciones').innerHTML = `<h3>Recomendaciones:</h3><p>${test.recomendaciones[recIndex]}</p>`;
      } else {
        test.preguntas.forEach((_, i) => {
          const selected = document.querySelector(`input[name="q${i}"]:checked`);
          if (!selected) {
            alert("Por favor responde todas las preguntas.");
            return;
          }
          const valor = parseInt(selected.value);
          respuestas[`q${i + 1}`] = valor;
          total += valor;
        });
        let nivel, recIndex;
        if (total <= 15) { nivel = "Mal hÃ¡bito"; recIndex = 0; }
        else if (total <= 25) { nivel = "Regular"; recIndex = 1; }
        else if (total <= 35) { nivel = "Bueno"; recIndex = 2; }
        else if (total <= 45) { nivel = "Muy bueno"; recIndex = 3; }
        else { nivel = "Excelente"; recIndex = 4; }
        document.getElementById('puntaje').textContent = `${total} / 50`;
        document.getElementById('nivel').textContent = nivel;
        document.getElementById('recomendaciones').innerHTML = `<h3>Recomendaciones:</h3><p>${test.recomendaciones[recIndex]}</p>`;
      }

      // === Guardar en Firestore ===
      const codigoAlumno = document.getElementById('codigoAlumno').value.trim().toUpperCase();
      const curso = document.getElementById('curso').value.trim();
      const edad = parseInt(document.getElementById('edad').value);
      const sexo = document.getElementById('sexo').value;

      if (!codigoAlumno || !curso || !edad || !sexo) {
        alert("Por favor completa todos los datos.");
        return;
      }

      const resultado = {
        codigoAlumno,
        testId: testActual,
        titulo: test.titulo,
        curso,
        edad,
        sexo,
        respuestas,
        puntaje: total,
        nivel: document.getElementById('nivel').textContent,
        fecha: firebase.firestore.FieldValue.serverTimestamp()
      };

      try {
        await db.collection('resultadosHealthyFriday').add(resultado);
        console.log("âœ… Resultado guardado para:", codigoAlumno, "en test:", testActual);
      } catch (error) {
        console.error("âŒ Error al guardar:", error);
        alert("Error al guardar. Â¿Hay conexiÃ³n a internet?");
        return;
      }

      document.getElementById('resultado').style.display = 'block';
    }

    async function generarInformeGlobal() {
      try {
        const snapshot = await db.collection('resultadosHealthyFriday').get();
        if (snapshot.empty) {
          alert("No hay resultados aÃºn.");
          return;
        }

        const datos = [];
        snapshot.forEach(doc => datos.push(doc.data()));

        const agrupado = {};
        datos.forEach(d => {
          const clave = `${d.curso}-${d.sexo}`;
          if (!agrupado[clave]) agrupado[clave] = [];
          agrupado[clave].push(d);
        });

        let html = `<h2>Informe Global Healthy Friday</h2><p><em>Generado: ${new Date().toLocaleString()}</em></p><hr>`;

        for (const [clave, resultados] of Object.entries(agrupado)) {
          const [curso, sexo] = clave.split('-');
          const total = resultados.length;
          const areas = {};

          resultados.forEach(r => {
            if (!areas[r.testId]) areas[r.testId] = { malo: 0, total: 0 };
            areas[r.testId].total++;
            if (["Mal hÃ¡bito", "A mejorar", "Regular"].includes(r.nivel)) {
              areas[r.testId].malo++;
            }
          });

          html += `<h3>ğŸ“Š ${curso} - ${sexo} (${total} participantes)</h3><ul>`;
          let hayProblemas = false;

          for (const [testId, stats] of Object.entries(areas)) {
            const porc = (stats.malo / stats.total) * 100;
            if (porc >= 30) {
              hayProblemas = true;
              const titulo = tests[testId]?.titulo || testId;
              const rec = tests[testId]?.recomendaciones[0] || "Mejorar hÃ¡bitos en esta Ã¡rea.";
              html += `<li>âš ï¸ <strong>${titulo}</strong>: ${porc.toFixed(1)}% con hÃ¡bitos insuficientes.<br><small>â†’ ${rec}</small></li>`;
            }
          }

          if (!hayProblemas) {
            html += `<li>âœ… Todos los hÃ¡bitos estÃ¡n en niveles aceptables.</li>`;
          }
          html += `</ul><hr>`;
        }

        const win = window.open('', '_blank');
        win.document.write(`
          <html><head><title>Informe Global</title>
          <style>body{font-family:Arial;padding:20px;} h2{color:#2c3e50;} ul{line-height:1.6;}</style>
          </head><body>${html}</body></html>
        `);
        win.document.close();

      } catch (error) {
        console.error("Error en informe:", error);
        alert("No se pudo generar el informe. Â¿Hay conexiÃ³n?");
      }
    }
  </script>
</body>
</html>
