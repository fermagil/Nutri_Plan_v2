```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPHA Fitness Test - Sistema de Evaluación</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(90deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .nav-tabs {
            display: flex;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
        }
        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .tab-btn.active {
            background: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 30px;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-success {
            background: #27ae60;
        }
        .btn-warning {
            background: #f39c12;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .result-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
        }
        .hidden {
            display: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .login-section {
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .login-section input {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .recommendations {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .health-info {
            background: #f0f8ff;
            border: 1px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        .comparison-chart {
            height: 300px;
            margin: 20px 0;
        }
        .test-result {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #fff;
        }
        .test-info {
            flex: 1;
            padding-right: 20px;
        }
        .test-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .test-scale {
            flex: 2;
            position: relative;
            height: 20px;
            background: linear-gradient(to right, #ff4d4d, #ffcc00, #4dff4d);
            border-radius: 10px;
            overflow: hidden;
        }
        .test-pointer {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #333;
            z-index: 10;
        }
        .test-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 5px;
        }
        .zone-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .zone-green {
            background: #4dff4d;
        }
        .zone-yellow {
            background: #ffcc00;
        }
        .zone-red {
            background: #ff4d4d;
        }
        .advice-box {
            background: #fff;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .advice-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .score-box {
            display: inline-block;
            background: #eee;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ALPHA Fitness Test - Sistema de Evaluación</h1>
            <p>Sistema de evaluación de condición física para niños y adolescentes</p>
        </div>

        <div id="loginSection" class="login-section">
            <h2>Inicio de Sesión (Admin)</h2>
            <input type="password" id="adminPassword" placeholder="Contraseña de administrador">
            <button class="btn" onclick="loginAdmin()">Iniciar Sesión</button>
        </div>

        <div id="mainContent" class="hidden">
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('registro')">Registro</button>
                <button class="tab-btn" onclick="showTab('resultados')">Resultados</button>
                <button class="tab-btn" onclick="showTab('estadisticas')">Estadísticas</button>
                <button class="tab-btn" onclick="showTab('analisis')">Análisis Detallado</button>
            </div>

            <!-- Pestaña de Registro -->
            <div id="registro" class="tab-content active">
                <h2>Registro de Evaluación Física</h2>
                <form id="fitnessForm">
                    <div class="form-group">
                        <label>Nombre (ID):</label>
                        <input type="text" id="nombre" maxlength="30" placeholder="Opcional - Se generará ID automático si está vacío">
                    </div>
                    <div class="form-group">
                        <label>Fecha de Nacimiento:</label>
                        <input type="date" id="fechaNacimiento" required>
                    </div>
                    <div class="form-group">
                        <label>Género:</label>
                        <select id="genero" required>
                            <option value="">Seleccionar</option>
                            <option value="masculino">Masculino</option>
                            <option value="femenino">Femenino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de Evaluación:</label>
                        <input type="date" id="fechaEvaluacion" required>
                    </div>
                    <div class="form-group">
                        <label>Altura (cm):</label>
                        <input type="number" id="altura" step="0.1" min="80" max="220" required>
                    </div>
                    <div class="form-group">
                        <label>Peso (kg):</label>
                        <input type="number" id="peso" step="0.1" min="8" max="200" required>
                    </div>
                    <div class="form-group">
                        <label>Perímetro de Cintura (cm):</label>
                        <input type="number" id="cintura" step="0.1" min="40" max="130" required>
                    </div>
                    <div class="form-group">
                        <label>Test de 20m (etapas):</label>
                        <input type="number" id="shuttle20m" step="0.5" min="0" max="21" required>
                    </div>
                    <div class="form-group">
                        <label>Salto Horizontal (cm):</label>
                        <input type="number" id="salto" min="15" max="330" required>
                    </div>
                    <div class="form-group">
                        <label>Fuerza de Presión Manual (kg):</label>
                        <input type="number" id="fuerza" step="0.1" min="0" max="80" required>
                    </div>
                    <div class="form-group">
                        <label>4x10m Shuttle Run (seg):</label>
                        <input type="number" id="shuttle4x10m" step="0.1" min="10" max="30" required>
                    </div>
                    <button type="submit" class="btn btn-success">Guardar Evaluación</button>
                </form>
            </div>

            <!-- Pestaña de Resultados -->
            <div id="resultados" class="tab-content">
                <h2>Resultados de Evaluación</h2>
                <div id="resultadosIndividuales" class="result-card">
                    <h3>Evaluación Individual</h3>
                    <div id="resultadoDetallado"></div>
                    <div id="testResultsContainer"></div>
                    <div id="recomendaciones" class="recommendations"></div>
                    <div id="infoSalud" class="health-info"></div>
                </div>
            </div>

            <!-- Pestaña de Estadísticas -->
            <div id="estadisticas" class="tab-content">
                <h2>Estadísticas Generales</h2>
                <button class="btn btn-warning" onclick="exportToCSV()">Exportar a CSV</button>
                <div class="stats-grid" id="statsGrid"></div>
                <div class="chart-container">
                    <canvas id="distribucionEdadChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="rendimientoChart"></canvas>
                </div>
            </div>

            <!-- Pestaña de Análisis -->
            <div id="analisis" class="tab-content">
                <h2>Análisis Detallado</h2>
                <div class="form-group">
                    <label>Filtrar por Género:</label>
                    <select id="filtroGenero" onchange="actualizarAnalisis()">
                        <option value="todos">Todos</option>
                        <option value="masculino">Masculino</option>
                        <option value="femenino">Femenino</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="analisisEdadChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="comparacionGeneroChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Inicializar Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB7_2xZ9nkbXLftOoXoLoOsHMc2nikjBU8",
            authDomain: "alphatest-3ca83.firebaseapp.com",
            projectId: "alphatest-3ca83",
            storageBucket: "alphatest-3ca83.firebasestorage.app",
            messagingSenderId: "679232754727",
            appId: "1:679232754727:web:6c2a6f8ab9ad188814aa02",
            measurementId: "G-B2BC0HZ5HY"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let evaluaciones = [];
        let distribucionEdadChart, rendimientoChart, analisisEdadChart, comparacionGeneroChart, comparacionResultadosChart;
        let isAdmin = false;

        // Función de login
        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            // Contraseña de ejemplo - en producción usar autenticación segura
            if (password === 'admin123') {
                isAdmin = true;
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainContent').classList.remove('hidden');
                cargarEvaluaciones();
            } else {
                alert('Contraseña incorrecta');
            }
        }

        // Generar ID único si el nombre está vacío
        function generarID() {
            const idsExistentes = evaluaciones.map(e => e.nombre).filter(n => n && n.startsWith('0000'));
            const ultimoID = idsExistentes
                .map(id => parseInt(id.replace('0000', '')))
                .sort((a, b) => b - a)[0] || 0;
            const nuevoNumero = ultimoID + 1;
            return `0000${nuevoNumero}`.slice(-5);
        }

        // Cálculo del IMC
        function calcularIMC(peso, altura) {
            const alturaM = altura / 100;
            return peso / (alturaM * alturaM);
        }

        // Cálculo de la clasificación de IMC según el documento
        function getClasificacionIMC(imc, genero, edad) {
            const clasificaciones = {
                'masculino': {
                    13: { 'muy_bajo': 16.7, 'bajo': 18.0, 'promedio': 22.2, 'alto': 25.7 },
                    14: { 'muy_bajo': 17.5, 'bajo': 19.0, 'promedio': 23.3, 'alto': 26.5 },
                    15: { 'muy_bajo': 17.9, 'bajo': 19.5, 'promedio': 23.8, 'alto': 26.7 },
                    16: { 'muy_bajo': 18.0, 'bajo': 19.6, 'promedio': 23.7, 'alto': 26.4 },
                    17: { 'muy_bajo': 19.0, 'bajo': 20.5, 'promedio': 24.6, 'alto': 27.5 }
                },
                'femenino': {
                    13: { 'muy_bajo': 17.5, 'bajo': 19.0, 'promedio': 23.2, 'alto': 26.4 },
                    14: { 'muy_bajo': 17.6, 'bajo': 18.9, 'promedio': 22.8, 'alto': 25.6 },
                    15: { 'muy_bajo': 18.1, 'bajo': 19.4, 'promedio': 23.0, 'alto': 25.6 },
                    16: { 'muy_bajo': 18.3, 'bajo': 19.6, 'promedio': 23.1, 'alto': 25.8 },
                    17: { 'muy_bajo': 18.2, 'bajo': 19.5, 'promedio': 23.2, 'alto': 25.8 }
                }
            };

            if (!clasificaciones[genero] || !clasificaciones[genero][edad]) {
                return 'No clasificado';
            }

            const lim = clasificaciones[genero][edad];
            
            if (imc <= lim.muy_bajo) return 'Muy Bajo';
            if (imc <= lim.bajo) return 'Bajo';
            if (imc <= lim.promedio) return 'Promedio';
            if (imc <= lim.alto) return 'Alto';
            return 'Muy Alto';
        }

        // Cálculo de la clasificación del perímetro de cintura
        function getClasificacionCintura(valor, genero, edad) {
            const clasificaciones = {
                'masculino': {
                    13: { 'muy_bajo': 62, 'bajo': 66, 'promedio': 78, 'alto': 87 },
                    14: { 'muy_bajo': 65, 'bajo': 69, 'promedio': 80, 'alto': 88 },
                    15: { 'muy_bajo': 67, 'bajo': 71, 'promedio': 81, 'alto': 89 },
                    16: { 'muy_bajo': 67, 'bajo': 71, 'promedio': 81, 'alto': 88 },
                    17: { 'muy_bajo': 70, 'bajo': 73, 'promedio': 83, 'alto': 91 }
                },
                'femenino': {
                    13: { 'muy_bajo': 61, 'bajo': 65, 'promedio': 75, 'alto': 83 },
                    14: { 'muy_bajo': 61, 'bajo': 64, 'promedio': 73, 'alto': 80 },
                    15: { 'muy_bajo': 63, 'bajo': 66, 'promedio': 75, 'alto': 81 },
                    16: { 'muy_bajo': 63, 'bajo': 66, 'promedio': 75, 'alto': 81 },
                    17: { 'muy_bajo': 62, 'bajo': 65, 'promedio': 74, 'alto': 80 }
                }
            };

            if (!clasificaciones[genero] || !clasificaciones[genero][edad]) {
                return 'No clasificado';
            }

            const lim = clasificaciones[genero][edad];
            
            if (valor <= lim.muy_bajo) return 'Muy Bajo';
            if (valor <= lim.bajo) return 'Bajo';
            if (valor <= lim.promedio) return 'Promedio';
            if (valor <= lim.alto) return 'Alto';
            return 'Muy Alto';
        }

        // Cálculo de la clasificación del test de cardio
        function getClasificacionCardio(valor, genero, edad) {
            const clasificaciones = {
                'masculino': {
                    13: { 'muy_bajo': 3.0, 'bajo': 4.5, 'promedio': 6.0, 'alto': 7.5 },
                    14: { 'muy_bajo': 3.5, 'bajo': 5.5, 'promedio': 6.5, 'alto': 8.5 },
                    15: { 'muy_bajo': 4.0, 'bajo': 5.5, 'promedio': 7.0, 'alto': 8.5 },
                    16: { 'muy_bajo': 4.0, 'bajo': 5.5, 'promedio': 7.0, 'alto': 8.5 },
                    17: { 'muy_bajo': 4.5, 'bajo': 6.0, 'promedio': 7.5, 'alto': 9.0 }
                },
                'femenino': {
                    13: { 'muy_bajo': 2.0, 'bajo': 2.5, 'promedio': 3.5, 'alto': 4.5 },
                    14: { 'muy_bajo': 2.0, 'bajo': 3.0, 'promedio': 4.0, 'alto': 5.0 },
                    15: { 'muy_bajo': 2.0, 'bajo': 3.0, 'promedio': 4.0, 'alto': 5.0 },
                    16: { 'muy_bajo': 2.0, 'bajo': 3.0, 'promedio': 4.0, 'alto': 5.0 },
                    17: { 'muy_bajo': 2.0, 'bajo': 3.0, 'promedio': 4.0, 'alto': 5.0 }
                }
            };

            if (!clasificaciones[genero] || !clasificaciones[genero][edad]) {
                return 'No clasificado';
            }

            const lim = clasificaciones[genero][edad];
            
            if (valor <= lim.muy_bajo) return 'Muy Bajo';
            if (valor <= lim.bajo) return 'Bajo';
            if (valor <= lim.promedio) return 'Promedio';
            if (valor <= lim.alto) return 'Alto';
            return 'Muy Alto';
        }

        // Cálculo de la clasificación de fuerza manual
        function getClasificacionFuerza(valor, genero, edad) {
            const clasificaciones = {
                'masculino': {
                    13: { 'muy_bajo': 21.4, 'bajo': 24.7, 'promedio': 27.8, 'alto': 31.8 },
                    14: { 'muy_bajo': 26.3, 'bajo': 30.4, 'promedio': 34.0, 'alto': 38.5 },
                    15: { 'muy_bajo': 31.3, 'bajo': 35.7, 'promedio': 39.7, 'alto': 44.3 },
                    16: { 'muy_bajo': 35.9, 'bajo': 40.0, 'promedio': 43.7, 'alto': 48.1 },
                    17: { 'muy_bajo': 39.9, 'bajo': 43.5, 'promedio': 46.7, 'alto': 50.6 }
                },
                'femenino': {
                    13: { 'muy_bajo': 19.9, 'bajo': 22.5, 'promedio': 24.8, 'alto': 27.6 },
                    14: { 'muy_bajo': 21.5, 'bajo': 24.1, 'promedio': 26.4, 'alto': 29.2 },
                    15: { 'muy_bajo': 22.5, 'bajo': 25.1, 'promedio': 27.4, 'alto': 30.3 },
                    16: { 'muy_bajo': 22.9, 'bajo': 25.4, 'promedio': 27.8, 'alto': 30.8 },
                    17: { 'muy_bajo': 23.9, 'bajo': 26.4, 'promedio': 28.9, 'alto': 32.1 }
                }
            };

            if (!clasificaciones[genero] || !clasificaciones[genero][edad]) {
                return 'No clasificado';
            }

            const lim = clasificaciones[genero][edad];
            
            if (valor <= lim.muy_bajo) return 'Muy Bajo';
            if (valor <= lim.bajo) return 'Bajo';
            if (valor <= lim.promedio) return 'Promedio';
            if (valor <= lim.alto) return 'Alto';
            return 'Muy Alto';
        }

        // Cálculo de la clasificación del salto
        function getClasificacionSalto(valor, genero, edad) {
            const clasificaciones = {
                'masculino': {
                    13: { 'muy_bajo': 135, 'bajo': 152, 'promedio': 167, 'alto': 184 },
                    14: { 'muy_bajo': 151, 'bajo': 169, 'promedio': 183, 'alto': 200 },
                    15: { 'muy_bajo': 165, 'bajo': 182, 'promedio': 196, 'alto': 212 },
                    16: { 'muy_bajo': 175, 'bajo': 192, 'promedio': 206, 'alto': 221 },
                    17: { 'muy_bajo': 184, 'bajo': 201, 'promedio': 215, 'alto': 229 }
                },
                'femenino': {
                    13: { 'muy_bajo': 118, 'bajo': 133, 'promedio': 147, 'alto': 163 },
                    14: { 'muy_bajo': 121, 'bajo': 137, 'promedio': 151, 'alto': 167 },
                    15: { 'muy_bajo': 123, 'bajo': 138, 'promedio': 151, 'alto': 167 },
                    16: { 'muy_bajo': 126, 'bajo': 141, 'promedio': 154, 'alto': 169 },
                    17: { 'muy_bajo': 129, 'bajo': 144, 'promedio': 157, 'alto': 172 }
                }
            };

            if (!clasificaciones[genero] || !clasificaciones[genero][edad]) {
                return 'No clasificado';
            }

            const lim = clasificaciones[genero][edad];
            
            if (valor <= lim.muy_bajo) return 'Muy Bajo';
            if (valor <= lim.bajo) return 'Bajo';
            if (valor <= lim.promedio) return 'Promedio';
            if (valor <= lim.alto) return 'Alto';
            return 'Muy Alto';
        }

        // Cálculo de la clasificación del shuttle 4x10m (menores tiempos son mejores)
        function getClasificacionShuttle4x10(valor, genero, edad) {
            const clasificaciones = {
                'masculino': {
                    13: { 'muy_bajo': 13.0, 'bajo': 12.2, 'promedio': 11.8, 'alto': 11.1 },
                    14: { 'muy_bajo': 12.6, 'bajo': 11.8, 'promedio': 11.4, 'alto': 10.8 },
                    15: { 'muy_bajo': 12.1, 'bajo': 12.0, 'promedio': 11.4, 'alto': 10.4 },
                    16: { 'muy_bajo': 11.8, 'bajo': 11.7, 'promedio': 11.0, 'alto': 10.1 },
                    17: { 'muy_bajo': 11.8, 'bajo': 11.7, 'promedio': 11.0, 'alto': 10.1 }
                },
                'femenino': {
                    13: { 'muy_bajo': 13.9, 'bajo': 13.0, 'promedio': 12.5, 'alto': 11.8 },
                    14: { 'muy_bajo': 13.8, 'bajo': 12.9, 'promedio': 12.4, 'alto': 11.7 },
                    15: { 'muy_bajo': 13.7, 'bajo': 12.9, 'promedio': 12.4, 'alto': 11.7 },
                    16: { 'muy_bajo': 13.6, 'bajo': 12.8, 'promedio': 12.3, 'alto': 11.6 },
                    17: { 'muy_bajo': 13.5, 'bajo': 12.8, 'promedio': 12.3, 'alto': 11.7 }
                }
            };

            if (!clasificaciones[genero] || !clasificaciones[genero][edad]) {
                return 'No clasificado';
            }

            const lim = clasificaciones[genero][edad];
            
            if (valor >= lim.muy_bajo) return 'Muy Bajo';
            if (valor >= lim.bajo) return 'Bajo';
            if (valor >= lim.promedio) return 'Promedio';
            if (valor >= lim.alto) return 'Alto';
            return 'Muy Alto';
        }

        // Obtener edad a partir de fecha de nacimiento
        function getEdad(fechaNacimiento) {
            const nacimiento = new Date(fechaNacimiento);
            const hoy = new Date();
            let edad = hoy.getFullYear() - nacimiento.getFullYear();
            const mes = hoy.getMonth() - nacimiento.getMonth();
            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
                edad--;
            }
            return edad;
        }

        // Procesar y mostrar resultados
        function procesarResultados(datos) {
            const edad = getEdad(datos.fechaNacimiento);
            const imc = calcularIMC(datos.peso, datos.altura);
            const clasificacionIMC = getClasificacionIMC(imc, datos.genero, edad);
            const clasificacionCintura = getClasificacionCintura(datos.cintura, datos.genero, edad);
            const clasificacionCardio = getClasificacionCardio(datos.shuttle20m, datos.genero, edad);
            const clasificacionSalto = getClasificacionSalto(datos.salto, datos.genero, edad);
            const clasificacionFuerza = getClasificacionFuerza(datos.fuerza, datos.genero, edad);
            const clasificacionShuttle4x10 = getClasificacionShuttle4x10(datos.shuttle4x10m, datos.genero, edad);

            const resultado = `
                <h4>Evaluación de: ${datos.nombre}</h4>
                <p><strong>Edad:</strong> ${edad} años</p>
                <p><strong>Género:</strong> ${datos.genero}</p>
                
                <h4>Resultados y Clasificaciones:</h4>
                <p><strong>IMC:</strong> ${imc.toFixed(2)} - Categoría: ${clasificacionIMC}</p>
                <p><strong>Perímetro de Cintura:</strong> ${datos.cintura} cm - Categoría: ${clasificacionCintura}</p>
                <p><strong>Cardiorespiratorio:</strong> ${datos.shuttle20m} etapas - Categoría: ${clasificacionCardio}</p>
                <p><strong>Salto Horizontal:</strong> ${datos.salto} cm - Categoría: ${clasificacionSalto}</p>
                <p><strong>Fuerza Manual:</strong> ${datos.fuerza} kg - Categoría: ${clasificacionFuerza}</p>
                <p><strong>Shuttle 4x10m:</strong> ${datos.shuttle4x10m} seg - Categoría: ${clasificacionShuttle4x10}</p>
                
                <h4>Valoración General:</h4>
                <p>El estado físico general del usuario se clasifica como: <strong>${evaluarEstadoFisico(clasificacionCardio, clasificacionSalto, clasificacionFuerza, clasificacionIMC)}</strong></p>
            `;

            document.getElementById('resultadoDetallado').innerHTML = resultado;
            
            // Mostrar gráfico de comparación
            mostrarGraficoComparacion(datos, edad);
            mostrarRecomendaciones(datos, clasificacionCardio, clasificacionSalto, clasificacionFuerza, clasificacionIMC, clasificacionCintura, clasificacionShuttle4x10);
            mostrarInfoSalud(datos, clasificacionCardio, clasificacionSalto, clasificacionFuerza, clasificacionIMC, clasificacionCintura, clasificacionShuttle4x10);
            mostrarResultadosDetallados(datos, edad);
        }

        // Mostrar resultados detallados con escalas visuales
        function mostrarResultadosDetallados(datos, edad) {
            const container = document.getElementById('testResultsContainer');
            container.innerHTML = '';
            
            const genero = datos.genero;
            
            // Test de 20m Shuttle Run
            const cardioResult = crearResultadoTest(
                '20-m Shuttle run',
                '20 metros de ida y vuelta',
                datos.shuttle20m,
                'etapas',
                genero,
                edad,
                'cardio'
            );
            container.appendChild(cardioResult);
            
            // Salto Horizontal
            const saltoResult = crearResultadoTest(
                'Standing long jump',
                'Salto de longitud a pies juntos',
                datos.salto,
                'cm',
                genero,
                edad,
                'salto'
            );
            container.appendChild(saltoResult);
            
            // Fuerza de prensión manual
            const fuerzaResult = crearResultadoTest(
                'Handgrip',
                'Fuerza de presión manual',
                datos.fuerza,
                'kg',
                genero,
                edad,
                'fuerza'
            );
            container.appendChild(fuerzaResult);
            
            // Perímetro de cintura
            const cinturaResult = crearResultadoTest(
                'Waist circumference',
                'Perímetro de cintura',
                datos.cintura,
                'cm',
                genero,
                edad,
                'cintura'
            );
            container.appendChild(cinturaResult);
            
            // IMC
            const imcResult = crearResultadoTest(
                'Body Mass Index',
                'Índice de Masa Corporal',
                calcularIMC(datos.peso, datos.altura),
                '',
                genero,
                edad,
                'imc'
            );
            container.appendChild(imcResult);
            
            // Shuttle 4x10m
            const shuttle4x10Result = crearResultadoTest(
                '4x10m shuttle run',
                'Test de velocidad/agilidad',
                datos.shuttle4x10m,
                'seg',
                genero,
                edad,
                'shuttle4x10'
            );
            container.appendChild(shuttle4x10Result);
        }

        // Crear elemento de resultado de test con escala visual
        function crearResultadoTest(nombre, descripcion, valor, unidad, genero, edad, tipo) {
            const div = document.createElement('div');
            div.className = 'test-result';
            
            // Información del test
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-info';
            
            const titulo = document.createElement('h4');
            titulo.textContent = nombre;
            infoDiv.appendChild(titulo);
            
            const desc = document.createElement('p');
            desc.textContent = descripcion;
            infoDiv.appendChild(desc);
            
            const valorDiv = document.createElement('div');
            valorDiv.className = 'test-value';
            valorDiv.innerHTML = `${valor} ${unidad}`;
            infoDiv.appendChild(valorDiv);
            
            div.appendChild(infoDiv);
            
            // Escala visual
            const scaleDiv = document.createElement('div');
            scaleDiv.className = 'test-scale';
            
            // Calcular posición del puntero
            let minVal, maxVal, zona;
            let referencia = '';
            
            switch(tipo) {
                case 'cardio':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13: minVal = 0; maxVal = 21; break;
                            case 14: minVal = 0; maxVal = 21; break;
                            case 15: minVal = 0; maxVal = 21; break;
                            case 16: minVal = 0; maxVal = 21; break;
                            case 17: minVal = 0; maxVal = 21; break;
                            default: minVal = 0; maxVal = 21;
                        }
                    } else {
                        switch(edad) {
                            case 13: minVal = 0; maxVal = 21; break;
                            case 14: minVal = 0; maxVal = 21; break;
                            case 15: minVal = 0; maxVal = 21; break;
                            case 16: minVal = 0; maxVal = 21; break;
                            case 17: minVal = 0; maxVal = 21; break;
                            default: minVal = 0; maxVal = 21;
                        }
                    }
                    break;
                case 'salto':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13: minVal = 15; maxVal = 330; break;
                            case 14: minVal = 15; maxVal = 330; break;
                            case 15: minVal = 15; maxVal = 330; break;
                            case 16: minVal = 15; maxVal = 330; break;
                            case 17: minVal = 15; maxVal = 330; break;
                            default: minVal = 15; maxVal = 330;
                        }
                    } else {
                        switch(edad) {
                            case 13: minVal = 15; maxVal = 330; break;
                            case 14: minVal = 15; maxVal = 330; break;
                            case 15: minVal = 15; maxVal = 330; break;
                            case 16: minVal = 15; maxVal = 330; break;
                            case 17: minVal = 15; maxVal = 330; break;
                            default: minVal = 15; maxVal = 330;
                        }
                    }
                    break;
                case 'fuerza':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13: minVal = 0; maxVal = 80; break;
                            case 14: minVal = 0; maxVal = 80; break;
                            case 15: minVal = 0; maxVal = 80; break;
                            case 16: minVal = 0; maxVal = 80; break;
                            case 17: minVal = 0; maxVal = 80; break;
                            default: minVal = 0; maxVal = 80;
                        }
                    } else {
                        switch(edad) {
                            case 13: minVal = 0; maxVal = 80; break;
                            case 14: minVal = 0; maxVal = 80; break;
                            case 15: minVal = 0; maxVal = 80; break;
                            case 16: minVal = 0; maxVal = 80; break;
                            case 17: minVal = 0; maxVal = 80; break;
                            default: minVal = 0; maxVal = 80;
                        }
                    }
                    break;
                case 'cintura':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13: minVal = 40; maxVal = 130; break;
                            case 14: minVal = 40; maxVal = 130; break;
                            case 15: minVal = 40; maxVal = 130; break;
                            case 16: minVal = 40; maxVal = 130; break;
                            case 17: minVal = 40; maxVal = 130; break;
                            default: minVal = 40; maxVal = 130;
                        }
                    } else {
                        switch(edad) {
                            case 13: minVal = 40; maxVal = 130; break;
                            case 14: minVal = 40; maxVal = 130; break;
                            case 15: minVal = 40; maxVal = 130; break;
                            case 16: minVal = 40; maxVal = 130; break;
                            case 17: minVal = 40; maxVal = 130; break;
                            default: minVal = 40; maxVal = 130;
                        }
                    }
                    break;
                case 'imc':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13: minVal = 15; maxVal = 30; break;
                            case 14: minVal = 15; maxVal = 30; break;
                            case 15: minVal = 15; maxVal = 30; break;
                            case 16: minVal = 15; maxVal = 30; break;
                            case 17: minVal = 15; maxVal = 30; break;
                            default: minVal = 15; maxVal = 30;
                        }
                    } else {
                        switch(edad) {
                            case 13: minVal = 15; maxVal = 30; break;
                            case 14: minVal = 15; maxVal = 30; break;
                            case 15: minVal = 15; maxVal = 30; break;
                            case 16: minVal = 15; maxVal = 30; break;
                            case 17: minVal = 15; maxVal = 30; break;
                            default: minVal = 15; maxVal = 30;
                        }
                    }
                    break;
                case 'shuttle4x10':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13: minVal = 10; maxVal = 15; break;
                            case 14: minVal = 10; maxVal = 15; break;
                            case 15: minVal = 10; maxVal = 15; break;
                            case 16: minVal = 10; maxVal = 15; break;
                            case 17: minVal = 10; maxVal = 15; break;
                            default: minVal = 10; maxVal = 15;
                        }
                    } else {
                        switch(edad) {
                            case 13: minVal = 10; maxVal = 15; break;
                            case 14: minVal = 10; maxVal = 15; break;
                            case 15: minVal = 10; maxVal = 15; break;
                            case 16: minVal = 10; maxVal = 15; break;
                            case 17: minVal = 10; maxVal = 15; break;
                            default: minVal = 10; maxVal = 15;
                        }
                    }
                    break;
            }
            
            // Calcular posición del puntero (0-100%)
            const posicion = ((valor - minVal) / (maxVal - minVal)) * 100;
            const pointer = document.createElement('div');
            pointer.className = 'test-pointer';
            pointer.style.left = `${posicion}%`;
            scaleDiv.appendChild(pointer);
            
            // Etiquetas de la escala
            const labelsDiv = document.createElement('div');
            labelsDiv.className = 'test-labels';
            
            const minLabel = document.createElement('span');
            minLabel.textContent = minVal;
            labelsDiv.appendChild(minLabel);
            
            const maxLabel = document.createElement('span');
            maxLabel.textContent = maxVal;
            labelsDiv.appendChild(maxLabel);
            
            scaleDiv.appendChild(labelsDiv);
            div.appendChild(scaleDiv);
            
            // Zona de salud
            const zonaDiv = document.createElement('div');
            zonaDiv.style.display = 'flex';
            zonaDiv.style.alignItems = 'center';
            zonaDiv.style.marginTop = '10px';
            
            const zonaIndicator = document.createElement('div');
            zonaIndicator.className = 'zone-indicator';
            
            // Determinar zona de salud
            let zonaColor = 'green';
            let zonaTexto = 'Zona Verde';
            let score = 100;
            
            switch(tipo) {
                case 'cardio':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13:
                                if (valor <= 3.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 4.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 6.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 7.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor <= 3.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 5.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 6.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 8.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor <= 4.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 5.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 7.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 8.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor <= 4.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 5.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 7.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 8.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor <= 4.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 6.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 7.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 9.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor <= 4.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 5.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 7.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 8.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    } else {
                        switch(edad) {
                            case 13:
                                if (valor <= 2.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 2.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 3.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 4.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor <= 2.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 3.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 4.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 5.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor <= 2.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 3.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 4.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 5.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor <= 2.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 3.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 4.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 5.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor <= 2.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 3.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 4.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 5.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor <= 2.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 3.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 4.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 5.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    }
                    break;
                case 'salto':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13:
                                if (valor <= 135) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 152) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 167) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 184) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor <= 151) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 169) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 183) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 200) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor <= 165) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 182) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 196) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 212) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor <= 175) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 192) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 206) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 221) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor <= 184) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 201) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 215) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 229) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor <= 165) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 182) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 196) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 212) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    } else {
                        switch(edad) {
                            case 13:
                                if (valor <= 118) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 133) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 147) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 163) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor <= 121) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 137) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 151) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 167) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor <= 123) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 138) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 151) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 167) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor <= 126) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 141) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 154) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 169) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor <= 129) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 144) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 157) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 172) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor <= 123) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 138) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 151) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 167) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    }
                    break;
                case 'fuerza':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13:
                                if (valor <= 21.4) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 24.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 27.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 31.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor <= 26.3) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 30.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 34.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 38.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor <= 31.3) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 35.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 39.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 44.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor <= 35.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 40.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 43.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 48.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor <= 39.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 43.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 46.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 50.6) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor <= 31.3) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 35.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 39.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 44.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    } else {
                        switch(edad) {
                            case 13:
                                if (valor <= 19.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 22.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 24.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 27.6) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor <= 21.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 24.1) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 26.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 29.2) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor <= 22.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 25.1) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 27.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 30.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor <= 22.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 25.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 27.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 30.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor <= 23.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 26.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 28.9) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 32.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor <= 22.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 25.1) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 27.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 30.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    }
                    break;
                case 'cintura':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13:
                                if (valor <= 62) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 66) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 78) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 87) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 14:
                                if (valor <= 65) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 69) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 80) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 88) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 15:
                                if (valor <= 67) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 71) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 81) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 89) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 16:
                                if (valor <= 67) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 71) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 81) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 88) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 17:
                                if (valor <= 70) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 73) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 83) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 91) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            default:
                                if (valor <= 67) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 71) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 81) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 89) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                        }
                    } else {
                        switch(edad) {
                            case 13:
                                if (valor <= 61) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 65) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 75) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 83) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 14:
                                if (valor <= 61) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 64) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 73) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 80) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 15:
                                if (valor <= 63) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 66) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 75) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 81) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 16:
                                if (valor <= 63) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 66) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 75) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 81) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 17:
                                if (valor <= 62) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 65) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 74) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 80) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            default:
                                if (valor <= 63) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                else if (valor <= 66) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else if (valor <= 75) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 81) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                        }
                    }
                    break;
                case 'imc':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13:
                                if (valor <= 16.7) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 18.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 22.2) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 25.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 14:
                                if (valor <= 17.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 26.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 15:
                                if (valor <= 17.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 26.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 16:
                                if (valor <= 18.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.6) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 26.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 17:
                                if (valor <= 19.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 20.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 24.6) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 27.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            default:
                                if (valor <= 17.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 26.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                        }
                    } else {
                        switch(edad) {
                            case 13:
                                if (valor <= 17.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.2) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 26.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 14:
                                if (valor <= 17.6) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 18.9) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 22.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 25.6) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 15:
                                if (valor <= 18.1) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 25.6) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 16:
                                if (valor <= 18.3) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.6) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 25.8) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            case 17:
                                if (valor <= 18.2) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.5) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.2) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 25.8) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                break;
                            default:
                                if (valor <= 18.1) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor <= 19.4) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor <= 23.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor <= 25.6) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                        }
                    }
                    break;
                case 'shuttle4x10':
                    if (genero === 'masculino') {
                        switch(edad) {
                            case 13:
                                if (valor >= 13.0) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.2) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 11.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor >= 12.6) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 11.8) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 11.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 10.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor >= 12.1) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 11.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 10.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor >= 11.8) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 11.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 11.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 10.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor >= 11.8) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 11.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 11.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 10.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor >= 11.8) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 11.7) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 11.0) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 10.1) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    } else {
                        switch(edad) {
                            case 13:
                                if (valor >= 13.9) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 13.0) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 12.5) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.8) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 14:
                                if (valor >= 13.8) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.9) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 12.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 15:
                                if (valor >= 13.7) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.9) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 12.4) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 16:
                                if (valor >= 13.6) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.8) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 12.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.6) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            case 17:
                                if (valor >= 13.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.8) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 12.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                                break;
                            default:
                                if (valor >= 13.5) { zonaColor = 'red'; zonaTexto = 'Zona Roja'; score = 0; }
                                else if (valor >= 12.8) { zonaColor = 'yellow'; zonaTexto = 'Zona Amarilla'; score = 25; }
                                else if (valor >= 12.3) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 50; }
                                else if (valor >= 11.7) { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 75; }
                                else { zonaColor = 'green'; zonaTexto = 'Zona Verde'; score = 100; }
                        }
                    }
                    break;
            }
            
            zonaIndicator.className = `zone-indicator zone-${zonaColor}`;
            zonaDiv.appendChild(zonaIndicator);
            
            const zonaText = document.createElement('span');
            zonaText.textContent = zonaTexto;
            zonaDiv.appendChild(zonaText);
            
            const scoreSpan = document.createElement('span');
            scoreSpan.className = 'score-box';
            scoreSpan.textContent = `${score} Puntos`;
            zonaDiv.appendChild(scoreSpan);
            
            div.appendChild(zonaDiv);
            
            // Consejo basado en la zona
            const adviceDiv = document.createElement('div');
            adviceDiv.className = 'advice-box';
            
            const adviceTitle = document.createElement('div');
            adviceTitle.className = 'advice-title';
            adviceTitle.textContent = 'Consejo:';
            
            let adviceText = '';
            switch(zonaColor) {
                case 'green':
                    adviceText = 'Has obtenido una puntuación excelente en este componente de la condición física. ¡Sigue así! Para mantener o mejorar tu nivel, sigue practicando actividades físicas regulares que disfrutes.';
                    break;
                case 'yellow':
                    adviceText = 'Tu puntuación está en la zona de mejora. Tu objetivo debe ser progresar hacia la zona verde estableciendo pequeños objetivos, comprobándolos regularmente en tu progreso. Aprovecha todas las oportunidades que puedas para saltar más (por ejemplo, salta en las escaleras, en el patio de recreo y en la naturaleza, salta a la comba) y no olvides también otras actividades de fuerza muscular (por ejemplo, lanzando conos/arcos o bolas de nieve tanto como quieras). Habla con tu profesor/a y averigua más sobre cómo establecer objetivos personales y cómo mejorar la potencia explosiva.';
                    break;
                case 'red':
                    adviceText = 'Tu puntuación está en la zona roja, lo que indica que es necesaria una mejora significativa para prevenir riesgos sanitarios actuales o futuros. Es importante hablar con tu profesor/a de Educación Física para saber más sobre cómo mejorar tu condición física. También puedes consultar con un médico o nutricionista para obtener recomendaciones personalizadas.';
                    break;
            }
            
            const adviceContent = document.createElement('div');
            adviceContent.textContent = adviceText;
            
            adviceDiv.appendChild(adviceTitle);
            adviceDiv.appendChild(adviceContent);
            
            div.appendChild(adviceDiv);
            
            return div;
        }

        // Mostrar gráfico de comparación de resultados
        function mostrarGraficoComparacion(datos, edad) {
            const ctx = document.getElementById('comparacionResultadosChart').getContext('2d');
            if (comparacionResultadosChart) comparacionResultadosChart.destroy();
            
            const genero = datos.genero;
            const resultados = [
                calcularIMC(datos.peso, datos.altura),
                datos.cintura,
                datos.shuttle20m,
                datos.salto,
                datos.fuerza
            ];
            
            // Obtener valores de referencia para la edad y género
            let refIMC, refCintura, refCardio, refSalto, refFuerza;
            
            if (genero === 'masculino') {
                switch(edad) {
                    case 13: refIMC = 22.2; refCintura = 78; refCardio = 6.0; refSalto = 167; refFuerza = 27.8; break;
                    case 14: refIMC = 23.3; refCintura = 80; refCardio = 6.5; refSalto = 183; refFuerza = 34.0; break;
                    case 15: refIMC = 23.8; refCintura = 81; refCardio = 7.0; refSalto = 196; refFuerza = 39.7; break;
                    case 16: refIMC = 23.7; refCintura = 81; refCardio = 7.0; refSalto = 206; refFuerza = 43.7; break;
                    case 17: refIMC = 24.6; refCintura = 83; refCardio = 7.5; refSalto = 215; refFuerza = 46.7; break;
                    default: refIMC = 22.2; refCintura = 78; refCardio = 6.0; refSalto = 167; refFuerza = 27.8;
                }
            } else {
                switch(edad) {
                    case 13: refIMC = 23.2; refCintura = 75; refCardio = 3.5; refSalto = 147; refFuerza = 24.8; break;
                    case 14: refIMC = 22.8; refCintura = 73; refCardio = 4.0; refSalto = 151; refFuerza = 26.4; break;
                    case 15: refIMC = 23.0; refCintura = 75; refCardio = 4.0; refSalto = 151; refFuerza = 27.4; break;
                    case 16: refIMC = 23.1; refCintura = 75; refCardio = 4.0; refSalto = 154; refFuerza = 27.8; break;
                    case 17: refIMC = 23.2; refCintura = 74; refCardio = 4.0; refSalto = 157; refFuerza = 28.9; break;
                    default: refIMC = 23.2; refCintura = 75; refCardio = 3.5; refSalto = 147; refFuerza = 24.8;
                }
            }
            
            const valoresRef = [refIMC, refCintura, refCardio, refSalto, refFuerza];
            
            comparacionResultadosChart = new Chart(ctx, {
                type: 'bar',
                 data:{
                    labels: ['IMC', 'Perímetro Cintura', 'Cardiorespiratorio', 'Salto Horizontal', 'Fuerza Manual'],
                    datasets: [
                        {
                            label: 'Resultado del Usuario',
                             resultados,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Valor de Referencia',
                             valoresRef,
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparación de Resultados con Valores de Referencia'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });
        }

        // Mostrar recomendaciones
        function mostrarRecomendaciones(datos, cardio, salto, fuerza, imc, cintura, shuttle4x10) {
            let recomendaciones = '<h4>Recomendaciones:</h4><ul>';
            
            if (cardio.includes('Muy Bajo') || cardio.includes('Bajo')) {
                recomendaciones += '<li><strong>Capacidad Cardiorespiratoria:</strong> Realizar actividades aeróbicas como correr, nadar o andar en bicicleta 3-4 veces por semana para mejorar la resistencia cardiovascular. Un bajo nivel de capacidad aeróbica es un predictor independiente del desarrollo futuro de síndrome metabólico, diabetes tipo 2 y enfermedades cardiovasculares. Mejorar la capacidad cardiorrespiratoria te permitirá mantenerte activo todo el día sin cansarte demasiado, disfrutar más de juegos y deportes con amigos y alcanzar metas deportivas que te importan.</li>';
            }
            
            if (salto.includes('Muy Bajo') || salto.includes('Bajo')) {
                recomendaciones += '<li><strong>Potencia Muscular:</strong> Practicar ejercicios de salto y plyometría para mejorar la fuerza explosiva de las piernas. La fuerza muscular está asociada inversamente con factores de riesgo cardiovascular y dolor lumbar. Mejorar la potencia muscular te ayudará en actividades diarias como subir escaleras, correr o jugar deportes, fortalecerá huesos y músculos, y mejorará tu salud general.</li>';
            }
            
            if (fuerza.includes('Muy Bajo') || fuerza.includes('Bajo')) {
                recomendaciones += '<li><strong>Fuerza Muscular:</strong> Incluir ejercicios de fuerza con peso corporal como flexiones, dominadas y agarres para mejorar la fuerza de brazos y manos. La fuerza muscular está asociada con mejor salud cardiovascular y menor mortalidad. Entrenar fuerza regularmente te ayudará a realizar actividades de vida diaria con mayor facilidad, mejorarás el desarrollo de habilidades motrices, aumentarás tu rendimiento deportivo y evitarás lesiones.</li>';
            }
            
            if (imc.includes('Muy Alto') || imc.includes('Alto') || cintura.includes('Muy Alto') || cintura.includes('Alto')) {
                recomendaciones += '<li><strong>Composición Corporal:</strong> Mantener una dieta equilibrada y aumentar la actividad física para lograr un peso saludable. El IMC elevado junto con el perímetro de cintura indican mayor riesgo cardiometabólico. Para mejorar la composición corporal, se recomienda fijar metas realistas y pequeñas, quemar más calorías con actividad física (hacer al menos 1 hora diaria de actividad física variada), comer menos calorías y seguir una dieta saludable, reducir el tiempo frente a pantallas y dormir lo suficiente.</li>';
            }
            
            if (imc.includes('Muy Bajo') || imc.includes('Bajo')) {
                recomendaciones += '<li><strong>Composición Corporal:</strong> Consultar con un nutricionista para asegurar una nutrición adecuada y un crecimiento saludable.</li>';
            }
            
            if (shuttle4x10.includes('Muy Bajo') || shuttle4x10.includes('Bajo')) {
                recomendaciones += '<li><strong>Velocidad/Agilidad:</strong> Mejorar la velocidad y agilidad a través de ejercicios de coordinación y desplazamiento. Las mejoras en velocidad/agilidad tienen un efecto positivo en la salud esquelética. Se recomienda combinar actividades divertidas y sociales, incorporar actividad en la rutina diaria y practicar entrenamientos que incluyan intervalos de alta intensidad.</li>';
            }
            
            recomendaciones += '</ul>';
            
            document.getElementById('recomendaciones').innerHTML = recomendaciones;
        }

        // Mostrar información sobre salud
        function mostrarInfoSalud(datos, cardio, salto, fuerza, imc, cintura, shuttle4x10) {
            const info = `
                <h4>Importancia de los Tests para la Salud:</h4>
                <p><strong>Importancia General:</strong> Un bajo fitness se asocia con una peor salud cardiovascular, con una peor salud ósea y una mayor probabilidad de una enfermedad incapacitante en el futuro (Henriksson et al., 2019). Cálculos recientes revelan que los costes sanitarios directos de la inactividad física en Europa ascienden a 11.685 millones de euros al año, y que se pierden otros 3.795 millones de euros debido a la disminución de la productividad (Ding et al., 2016). La condición física es un marcador muy importante relacionado con la salud a lo largo de la vida (García-Hermoso et al., 2019). Conseguir un alto nivel de condición física es beneficioso para la salud física y mental, así como para la salud cerebral (Ortega et al., 2008).</p>
                
                <p><strong>Test de Resistencia Cardiorespiratoria:</strong> La capacidad aeróbica está fuertemente asociada con una mejor salud cardiovascular actual y futura. Niveles bajos se relacionan con riesgo aumentado de enfermedades cardiovasculares, síndrome metabólico y diabetes tipo 2. La condición física es la capacidad de llevar a cabo las tareas diarias con vigor y agilidad, sin fatiga y con energía suficiente para disfrutar de las actividades de ocio y para hacer frente a emergencias inesperadas (Clarke, 1979).</p>
                
                <p><strong>Test de Salto Horizontal:</strong> Mide la fuerza explosiva de las piernas, importante para la salud ósea y muscular. La fuerza muscular está inversamente asociada con factores de riesgo cardiovascular y dolor lumbar. La potencia muscular se define como la capacidad de generar fuerza rápidamente, y mejorarla requiere entrenamiento progresivo, técnica correcta y velocidad en los movimientos.</p>
                
                <p><strong>Test de Fuerza de Prehensión Manual:</strong> Indicador de la fuerza general y salud muscular. Se ha relacionado con mejores resultados en salud cardiovascular y menor mortalidad por todas las causas. La fuerza muscular es la capacidad de ejercer fuerza o resistir una resistencia externa, y entrenarla regularmente mejora la capacidad de realizar actividades de vida diaria.</p>
                
                <p><strong>Índice de Masa Corporal (IMC) y Perímetro de Cintura:</strong> Indicadores de composición corporal. El IMC es útil pero el perímetro de cintura es un marcador directo de grasa visceral, que es metabólicamente activa y se asocia con inflamación sistémica y resistencia a la insulina. La composición corporal está estrechamente relacionada con el rendimiento físico y la salud.</p>
                
                <p><strong>Test de Shuttle 4x10m:</strong> Evalúa velocidad, agilidad y coordinación, aspectos importantes para la salud esquelética. Las mejoras en velocidad/agilidad parecen tener un efecto positivo en la salud esquelética. Este test mide la capacidad de cambiar de dirección rápidamente, lo cual es importante para prevenir lesiones y mejorar el rendimiento deportivo.</p>
                
                <p><strong>Proyecto ALPHA:</strong> En 2003, la Comisión Europea financió el proyecto ALPHA con el objetivo de disponer de una batería de test válida y fiable para medir la condición física de forma armonizada internacionalmente. La batería final recomendaba el test de carrera de ida y vuelta de 20m, los tests de prensión manual y salto de longitud, y el IMC y perímetro de cintura como indicadores de obesidad total y central.</p>
            `;
            
            document.getElementById('infoSalud').innerHTML = info;
        }

        // Evaluar estado físico general
        function evaluarEstadoFisico(cardio, salto, fuerza, imc) {
            const clasificaciones = [cardio, salto, fuerza, imc];
            let muyBajo = 0, bajo = 0, promedio = 0, alto = 0, muyAlto = 0;
            
            clasificaciones.forEach(cat => {
                if (cat.includes('Muy Bajo')) muyBajo++;
                else if (cat.includes('Bajo')) bajo++;
                else if (cat.includes('Promedio')) promedio++;
                else if (cat.includes('Alto')) alto++;
                else if (cat.includes('Muy Alto')) muyAlto++;
            });
            
            if (muyBajo >= 2) return 'Muy Deficiente';
            if (muyBajo + bajo >= 3) return 'Deficiente';
            if (muyAlto + alto >= 3) return 'Excelente';
            if (muyAlto + alto >= 2) return 'Bueno';
            return 'Adecuado';
        }

        // Cargar evaluaciones desde Firestore
        async function cargarEvaluaciones() {
            try {
                const snapshot = await db.collection('evaluaciones').get();
                evaluaciones = [];
                snapshot.forEach(doc => {
                    evaluaciones.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error("Error al cargar evaluaciones: ", error);
            }
        }

        // Guardar evaluación en Firestore
        document.getElementById('fitnessForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Obtener el nombre o generar ID
            let nombre = document.getElementById('nombre').value.trim();
            if (!nombre) {
                nombre = generarID();
            }
            
            const datos = {
                nombre: nombre,
                fechaNacimiento: document.getElementById('fechaNacimiento').value,
                genero: document.getElementById('genero').value,
                fechaEvaluacion: document.getElementById('fechaEvaluacion').value,
                altura: parseFloat(document.getElementById('altura').value),
                peso: parseFloat(document.getElementById('peso').value),
                cintura: parseFloat(document.getElementById('cintura').value),
                shuttle20m: parseFloat(document.getElementById('shuttle20m').value),
                salto: parseInt(document.getElementById('salto').value),
                fuerza: parseFloat(document.getElementById('fuerza').value),
                shuttle4x10m: parseFloat(document.getElementById('shuttle4x10m').value)
            };

            try {
                const docRef = await db.collection('evaluaciones').add(datos);
                datos.id = docRef.id;
                evaluaciones.push(datos);
                procesarResultados(datos);
                alert(`Evaluación registrada exitosamente! ID: ${nombre}`);
            } catch (error) {
                console.error("Error al guardar evaluación: ", error);
                alert('Error al guardar la evaluación');
            }
        });

        // Mostrar pestañas
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            if (tabId === 'estadisticas') {
                actualizarEstadisticas();
            }
            if (tabId === 'analisis') {
                actualizarAnalisis();
            }
        }

        // Actualizar estadísticas
        function actualizarEstadisticas() {
            if (evaluaciones.length === 0) return;

            // Calcular estadísticas
            const total = evaluaciones.length;
            const masculino = evaluaciones.filter(e => e.genero === 'masculino').length;
            const femenino = evaluaciones.filter(e => e.genero === 'femenino').length;
            
            const promedioEdad = evaluaciones.reduce((sum, e) => sum + getEdad(e.fechaNacimiento), 0) / total;
            const promedioIMC = evaluaciones.reduce((sum, e) => sum + calcularIMC(e.peso, e.altura), 0) / total;
            const promedioCardio = evaluaciones.reduce((sum, e) => sum + e.shuttle20m, 0) / total;
            const promedioSalto = evaluaciones.reduce((sum, e) => sum + e.salto, 0) / total;
            const promedioFuerza = evaluaciones.reduce((sum, e) => sum + e.fuerza, 0) / total;
            const promedioShuttle4x10 = evaluaciones.reduce((sum, e) => sum + e.shuttle4x10m, 0) / total;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <h3>Total Evaluaciones</h3>
                    <p>${total}</p>
                </div>
                <div class="stat-card">
                    <h3>Hombres</h3>
                    <p>${masculino}</p>
                </div>
                <div class="stat-card">
                    <h3>Mujeres</h3>
                    <p>${femenino}</p>
                </div>
                <div class="stat-card">
                    <h3>Edad Promedio</h3>
                    <p>${promedioEdad.toFixed(1)} años</p>
                </div>
                <div class="stat-card">
                    <h3>IMC Promedio</h3>
                    <p>${promedioIMC.toFixed(2)}</p>
                </div>
                <div class="stat-card">
                    <h3>Cardio Promedio</h3>
                    <p>${promedioCardio.toFixed(1)} etapas</p>
                </div>
                <div class="stat-card">
                    <h3>Salto Promedio</h3>
                    <p>${promedioSalto.toFixed(1)} cm</p>
                </div>
                <div class="stat-card">
                    <h3>Fuerza Promedio</h3>
                    <p>${promedioFuerza.toFixed(1)} kg</p>
                </div>
                <div class="stat-card">
                    <h3>Shuttle 4x10m Promedio</h3>
                    <p>${promedioShuttle4x10.toFixed(1)} seg</p>
                </div>
            `;

            // Actualizar gráficos
            actualizarGraficos();
        }

        // Actualizar gráficos
        function actualizarGraficos() {
            // Gráfico de distribución por edad
            const edades = evaluaciones.map(e => getEdad(e.fechaNacimiento));
            const edadCount = {};
            edades.forEach(edad => {
                edadCount[edad] = (edadCount[edad] || 0) + 1;
            });

            const ctx1 = document.getElementById('distribucionEdadChart').getContext('2d');
            if (distribucionEdadChart) distribucionEdadChart.destroy();
            distribucionEdadChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: Object.keys(edadCount),
                    datasets: [{
                        label: 'Número de Evaluaciones',
                         Object.values(edadCount),
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribución por Edad'
                        }
                    }
                }
            });

            // Gráfico de rendimiento promedio (radar)
            const ctx2 = document.getElementById('rendimientoChart').getContext('2d');
            if (rendimientoChart) rendimientoChart.destroy();
            rendimientoChart = new Chart(ctx2, {
                type: 'radar',
                 {
                    labels: ['Cardiorespiratorio', 'Fuerza', 'Salto', 'IMC', 'Shuttle 4x10m'],
                    datasets: [{
                        label: 'Promedio General',
                         [
                            evaluaciones.reduce((sum, e) => sum + e.shuttle20m, 0) / evaluaciones.length,
                            evaluaciones.reduce((sum, e) => sum + e.fuerza, 0) / evaluaciones.length,
                            evaluaciones.reduce((sum, e) => sum + e.salto, 0) / evaluaciones.length,
                            evaluaciones.reduce((sum, e) => sum + calcularIMC(e.peso, e.altura), 0) / evaluaciones.length,
                            evaluaciones.reduce((sum, e) => sum + e.shuttle4x10m, 0) / evaluaciones.length
                        ],
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(46, 204, 113, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(46, 204, 113, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Rendimiento Promedio'
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        // Actualizar análisis detallado
        function actualizarAnalisis() {
            const filtroGenero = document.getElementById('filtroGenero').value;
            const datosFiltrados = filtroGenero === 'todos' ? 
                evaluaciones : 
                evaluaciones.filter(e => e.genero === filtroGenero);

            if (datosFiltrados.length === 0) return;

            // Gráfico por edad para todas las pruebas
            const edades = [...new Set(datosFiltrados.map(e => getEdad(e.fechaNacimiento)))].sort();
            const cardioPorEdad = edades.map(edad => {
                const datosEdad = datosFiltrados.filter(e => getEdad(e.fechaNacimiento) === edad);
                return datosEdad.reduce((sum, e) => sum + e.shuttle20m, 0) / datosEdad.length;
            });
            const saltoPorEdad = edades.map(edad => {
                const datosEdad = datosFiltrados.filter(e => getEdad(e.fechaNacimiento) === edad);
                return datosEdad.reduce((sum, e) => sum + e.salto, 0) / datosEdad.length;
            });
            const fuerzaPorEdad = edades.map(edad => {
                const datosEdad = datosFiltrados.filter(e => getEdad(e.fechaNacimiento) === edad);
                return datosEdad.reduce((sum, e) => sum + e.fuerza, 0) / datosEdad.length;
            });

            const ctx3 = document.getElementById('analisisEdadChart').getContext('2d');
            if (analisisEdadChart) analisisEdadChart.destroy();
            analisisEdadChart = new Chart(ctx3, {
                type: 'line',
                 {
                    labels: edades,
                    datasets: [
                        {
                            label: 'Rendimiento Cardiorespiratorio',
                             cardioPorEdad,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: 'Salto Horizontal',
                             saltoPorEdad,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            tension: 0.1
                        },
                        {
                            label: 'Fuerza Manual',
                             fuerzaPorEdad,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Rendimiento por Edad y Prueba'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    }
                }
            });

            // Comparación por género
            const hombres = evaluaciones.filter(e => e.genero === 'masculino');
            const mujeres = evaluaciones.filter(e => e.genero === 'femenino');

            const ctx4 = document.getElementById('comparacionGeneroChart').getContext('2d');
            if (comparacionGeneroChart) comparacionGeneroChart.destroy();
            comparacionGeneroChart = new Chart(ctx4, {
                type: 'bar',
                 {
                    labels: ['Cardio', 'Fuerza', 'Salto', 'IMC', 'Shuttle 4x10m'],
                    datasets: [
                        {
                            label: 'Hombres',
                            data: [
                                hombres.length ? hombres.reduce((sum, e) => sum + e.shuttle20m, 0) / hombres.length : 0,
                                hombres.length ? hombres.reduce((sum, e) => sum + e.fuerza, 0) / hombres.length : 0,
                                hombres.length ? hombres.reduce((sum, e) => sum + e.salto, 0) / hombres.length : 0,
                                hombres.length ? hombres.reduce((sum, e) => sum + calcularIMC(e.peso, e.altura), 0) / hombres.length : 0,
                                hombres.length ? hombres.reduce((sum, e) => sum + e.shuttle4x10m, 0) / hombres.length : 0
                            ],
                            backgroundColor: 'rgba(54, 162, 235, 0.6)'
                        },
                        {
                            label: 'Mujeres',
                             [
                                mujeres.length ? mujeres.reduce((sum, e) => sum + e.shuttle20m, 0) / mujeres.length : 0,
                                mujeres.length ? mujeres.reduce((sum, e) => sum + e.fuerza, 0) / mujeres.length : 0,
                                mujeres.length ? mujeres.reduce((sum, e) => sum + e.salto, 0) / mujeres.length : 0,
                                mujeres.length ? mujeres.reduce((sum, e) => sum + calcularIMC(e.peso, e.altura), 0) / mujeres.length : 0,
                                mujeres.length ? mujeres.reduce((sum, e) => sum + e.shuttle4x10m, 0) / mujeres.length : 0
                            ],
                            backgroundColor: 'rgba(255, 99, 132, 0.6)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparación por Género'
                        }
                    }
                }
            });
        }

        // Exportar a CSV
        function exportToCSV() {
            if (evaluaciones.length === 0) {
                alert('No hay datos para exportar');
                return;
            }

            const headers = ['ID', 'Nombre', 'Fecha Nacimiento', 'Género', 'Fecha Evaluación', 
                           'Altura', 'Peso', 'Cintura', 'Shuttle 20m', 'Salto', 'Fuerza', 'Shuttle 4x10m', 
                           'IMC', 'Edad', 'Clasificación IMC', 'Clasificación Cintura', 
                           'Clasificación Cardiorespiratorio', 'Clasificación Salto', 
                           'Clasificación Fuerza', 'Clasificación Shuttle 4x10m'];
            
            const csvContent = [
                headers.join(','),
                ...evaluaciones.map(e => {
                    const edad = getEdad(e.fechaNacimiento);
                    const imc = calcularIMC(e.peso, e.altura);
                    return [
                        e.id,
                        e.nombre,
                        e.fechaNacimiento,
                        e.genero,
                        e.fechaEvaluacion,
                        e.altura,
                        e.peso,
                        e.cintura,
                        e.shuttle20m,
                        e.salto,
                        e.fuerza,
                        e.shuttle4x10m,
                        imc.toFixed(2),
                        edad,
                        getClasificacionIMC(imc, e.genero, edad),
                        getClasificacionCintura(e.cintura, e.genero, edad),
                        getClasificacionCardio(e.shuttle20m, e.genero, edad),
                        getClasificacionSalto(e.salto, e.genero, edad),
                        getClasificacionFuerza(e.fuerza, e.genero, edad),
                        getClasificacionShuttle4x10(e.shuttle4x10m, e.genero, edad)
                    ].join(',');
                })
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'evaluaciones_fitness.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Inicializar
        actualizarGraficos();
    </script>
</body>
</html>
```

